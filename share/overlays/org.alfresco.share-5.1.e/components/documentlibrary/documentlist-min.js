(function(){var A=YAHOO.util.Dom,O=YAHOO.util.Event,M=YAHOO.util.DragDropMgr;var f=Alfresco.util.encodeHTML,ak=Alfresco.util.activateLinks,aI=Alfresco.util.combinePaths,n=Alfresco.util.userProfileLink,b=Alfresco.util.siteURL,N=function N(a2,a3){return Alfresco.util.formatDate(Alfresco.util.fromISO8601(a2),a3)},ab=Alfresco.util.relativeTime,F=Alfresco.util.isValueSet;var aT="org.alfresco.share.documentList",aE=aT+".sortAscending",d=aT+".sortField",Y=aT+".showFolders",E=aT+".hideNavBar",S=aT+".simpleView",Z=aT+".viewRendererName",au=aT+".galleryColumns";Alfresco.DnD=function(a6,a3,a2,a4){Alfresco.DnD.superclass.constructor.call(this,a6,a2,a4);var a5=this.getDragEl();A.setStyle(a5,"opacity",0.67);this.docLib=a3};YAHOO.extend(Alfresco.DnD,YAHOO.util.DDProxy,{_inFlight:false,startDrag:function p(a3,a6){var a2=this.getDragEl();var a5=this.getEl();A.setStyle(a5,"visibility","hidden");var a4=document.createElement("img");a4.src=a5.src;a2.removeChild(a2.firstChild);a2.appendChild(a4);A.setStyle(a2,"border","none")},endDrag:function ai(a4){if(!this._inFlight){var a2=this.getEl();var a3=this.getDragEl();this.animateResult(a3,a2)}},animateResult:function aq(a5,a2){A.setStyle(a5,"visibility","");var a3=new YAHOO.util.Motion(a5,{points:{to:A.getXY(a2)}},0.2,YAHOO.util.Easing.easeOut);var a4=a5.id;var a6=this.id;a3.onComplete.subscribe(function(){A.setStyle(a4,"visibility","hidden");A.setStyle(a6,"visibility","")});a3.animate()},onDragDrop:function t(a7,a4){var a2=A.get(a4);if(M.interactionInfo.drop.length>0){if(A.isAncestor(this.docLib.widgets.dataTable.getContainerEl(),a2)){var a3=this.docLib.widgets.dataTable.getRecord(A.get(a4)),a8=a3.getData();if(a8.node.isContainer){this._inFlight=true;var ba;if(a8.node.isLink){ba=new Alfresco.util.NodeRef(a8.node.linkedNode.nodeRef)}else{ba=new Alfresco.util.NodeRef(a8.node.nodeRef)}this._performMove(ba,a8.location.path+"/"+a8.location.file)}}else{if(A.hasClass(a2,"documentDroppable")){var a5=A.get("alf-filters"),a6=(a5?parseInt(a5.style.width,10):160);if(a7.clientX>a6){}else{var a9={elementId:a4,callback:this.onDropTargetOwnerCallBack,scope:this};YAHOO.Bubbling.fire("dropTargetOwnerRequest",a9)}this._inFlight=true;this._setFailureTimeout()}}}},_performMove:function ap(a7,ba){var a4=this.docLib.widgets.dataTable.getRecord(this.getEl()),a5="move-to/node/{nodeRef}",a9=[];a9.push(this.getEl().id);var a8=function a6(bd){this._inFlight=false;var bb,be=bd.json.successCount,bf=bd.json.failureCount;if(!bd.json.overallSuccess){this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});A.removeClass(this.dragFolderHighlight,"dndFolderHighlight");return}this.docLib._updateDocList.call(this.docLib);var bc=a4.getData();if(bc.node.isContainer){YAHOO.Bubbling.fire("folderMoved",{multiple:true,nodeRef:bc.nodeRef,destination:ba})}};var a3=function a2(bb){this._inFlight=false;this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});A.removeClass(this.dragFolderHighlight,"dndFolderHighlight")};this.docLib.modules.actions.genericAction({success:{callback:{fn:a8,scope:this}},failure:{callback:{fn:a3,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:a5,params:{nodeRef:a7.uri}},wait:{message:this.docLib.msg("message.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:a9,parentId:this.docLib.doclistMetadata.parent.nodeRef}}})},_currTimeoutId:null,onDropTargetOwnerCallBack:function av(a2,a4){this._clearTimeout();var a3=new Alfresco.util.NodeRef(a2);this._performMove(a3,a4)},_clearTimeout:function aj(){if(this._currTimeoutId!=null){window.clearTimeout(this._currTimeoutId);this._currTimeoutId=null;this._inFlight=false}},_setFailureTimeout:function aL(){this._clearTimeout();var a2=this;this._currTimeoutId=window.setTimeout(function(){a2.animateResult(a2.getDragEl(),a2.getEl());a2._inFlight=false;a2._currTimeoutId=null},500)},onDragOver:function aX(a4,a5){var a2=A.get(a5);if(a2.tagName=="IMG"||a2.className=="droppable"){this.dragFolderHighlight=A.getAncestorByClassName(a2,"folder");A.addClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(A.hasClass(a2,"documentDroppableHighlights")){var a3={elementId:a5,event:a4};YAHOO.Bubbling.fire("documentDragOver",a3)}}},onDragOut:function aM(a4,a5){var a2=A.get(a5);if(a2.tagName=="IMG"||a2.className=="droppable"){this.dragFolderHighlight=A.getAncestorByClassName(a2,"folder");A.removeClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(A.hasClass(a2,"documentDroppableHighlights")){var a3={elementId:a5,event:a4};YAHOO.Bubbling.fire("documentDragOut",a3)}}}});Alfresco.DocumentList=function(a2){Alfresco.DocumentList.superclass.constructor.call(this,"Alfresco.DocumentList",a2,["button","menu","container","datasource","datatable","paginator","json","history"]);this.currentPath="";this.currentPage=1;this.totalRecords=0;this.totalRecordsUpper=null;this.hideMoreActionsFn=null;this.state={actionEditOfflineActive:false};this.currentFilter={filterId:"path",filterData:""};this.actions={};this.selectedFiles={};this.afterDocListUpdate=[];this.doclistMetadata={};this.previewTooltips=[];this.insituEditors=[];this.dynamicControls=[];this.sortControls=[];this.dragAndDropAllowed=true;this.dragAndDropEnabled=false;this.dragEventRefCount=0;this.actionsView="browse";this.renderers={};this.viewRenderers={};this.dataSourceUrl=aI(Alfresco.constants.URL_SERVICECONTEXT,"components/documentlibrary/data/doclist/");YAHOO.Bubbling.on("activateDynamicControls",this.onActivateDynamicControls,this);YAHOO.Bubbling.on("activateSortControls",this.onActivateSortControls,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("deactivateSortControls",this.onDeactivateSortControls,this);YAHOO.Bubbling.on("metadataRefresh",this.onDocListRefresh,this);YAHOO.Bubbling.on("fileRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("changeFilter",this.onChangeFilter,this);YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("folderCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("nodeCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("folderRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("highlightFile",this.onHighlightFile,this);YAHOO.Bubbling.on("registerRenderer",this.onRegisterRenderer,this);YAHOO.Bubbling.on("registerViewRenderer",this.onRegisterViewRenderer,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);YAHOO.Bubbling.on("resizerChanged",this.onResizerChanged,this);YAHOO.Bubbling.on("fileCopied",this.onFileAction,this);YAHOO.Bubbling.on("fileDeleted",this.onFileAction,this);YAHOO.Bubbling.on("fileMoved",this.onFileAction,this);YAHOO.Bubbling.on("filePermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("folderCopied",this.onFileAction,this);YAHOO.Bubbling.on("folderDeleted",this.onFileAction,this);YAHOO.Bubbling.on("folderMoved",this.onFileAction,this);YAHOO.Bubbling.on("folderPermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("filesCopied",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesDeleted",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesMoved",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesPermissionsUpdated",this.onDocListRefresh,this);return this};YAHOO.extend(Alfresco.DocumentList,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocumentList,Alfresco.doclib.Actions);Alfresco.DocumentList.generateFilterMarkup=function v(a2){var a3=Alfresco.util.cleanBubblingObject(a2);return YAHOO.lang.substitute("{filterOwner}|{filterId}|{filterData}|{filterDisplay}",a3,function(a5,a6,a4){return typeof a6==="undefined"?"":window.escape(a6)})};Alfresco.DocumentList.generatePathMarkup=function al(a2){return Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:aI(a2.path,a2.file)})};Alfresco.DocumentList.generateCategoryMarkup=function k(a2){return Alfresco.DocumentList.generateFilterMarkup({filterId:"category",filterData:aI(a2[1],a2[0])})};Alfresco.DocumentList.generateFileFolderLinkMarkup=function h(a4,a2){var a6=a2.jsNode,a3;if(a6.isLink&&F(a4.options.siteId)&&a2.location.site&&a2.location.site.name!==a4.options.siteId){if(a6.isContainer){a3=b("documentlibrary?path="+encodeURIComponent(a2.location.path),{site:a2.location.site.name})}else{a3=a4.getActionUrls(a2,a2.location.site.name).documentDetailsUrl}}else{if(a6.isContainer){if(a2.parent.isContainer||a2.node.isContainer){a3='#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(a2.location)}else{if(a2.location.path==="/"){a3='#" class="filter-change" rel="'+Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:aI(a2.location.path,"")})}else{a3="#"}}}else{var a5=a4.getActionUrls(a2);if(a6.isLink&&a6.linkedNode.isContainer){a3=a5.folderDetailsUrl}else{a3=a5.documentDetailsUrl}}}return'<a href="'+a3+'">'};Alfresco.DocumentList.generateThumbnailUrl=function ad(a2,a5){var a4=a2.jsNode,a3=a4.isLink?a4.linkedNode.nodeRef:a4.nodeRef;if(a4.isLink&&!a3){return""}if(a5==null){a5="doclib"}return Alfresco.util.generateThumbnailUrl(a4,a5)};Alfresco.DocumentList.generateFavourite=function aJ(a4,a2){var a5=a2.jsNode,a6="favourite."+(a5.isContainer?"folder.":"document."),a3="";if(a2.isFavourite){a3='<a href="#" class="favourite-action enabled" title="'+a4.msg(a6+"remove.tip")+'" tabindex="0"></a>'}else{a3='<a href="#" class="favourite-action" title="'+a4.msg(a6+"add.tip")+'" tabindex="0">'+a4.msg(a6+"add.label")+"</a>"}return a3};Alfresco.DocumentList.generateLikes=function q(a5,a2){var a6=a2.node,a3=a2.likes,a7="like."+(a6.isContainer?"folder.":"document."),a4="";if(a3.isLiked){a4='<a href="#" class="like-action enabled" title="'+a5.msg(a7+"remove.tip")+'" tabindex="0"></a>'}else{a4='<a href="#" class="like-action" title="'+a5.msg(a7+"add.tip")+'" tabindex="0">'+a5.msg(a7+"add.label")+"</a>"}a4+='<span class="likes-count">'+f(a3.totalLikes)+"</span>";return a4};Alfresco.DocumentList.generateComments=function aN(a5,a2){var a8=a2.node,a7=a5.getActionUrls(a2),a3=a7[a8.isContainer?"folderDetailsUrl":"documentDetailsUrl"]+"#comment",a9="comment."+(a8.isContainer?"folder.":"document.");var a6=(a8.properties["fm:commentCount"]!==undefined);var a4='<a href="'+a3+'" class="comment'+(a6?" hasComments":"")+'" title="'+a5.msg(a9+"tip")+'" tabindex="0">'+a5.msg(a9+"label")+"</a>";if(a6){a4+='<span class="comment-count">'+f(a8.properties["fm:commentCount"])+"</span>"}return a4};Alfresco.DocumentList.generateQuickShare=function x(a3,a2){return new Alfresco.QuickShare().setOptions({nodeRef:a2.jsNode.nodeRef,displayName:a2.displayName}).display(a2.jsNode.properties.qshare_sharedId,a2.jsNode.properties.qshare_sharedBy)};Alfresco.DocumentList.generateUserLink=function aQ(a3,a2){if(a2.isDeleted===true){return"<span>"+a3.msg("details.user.deleted",f(a2.userName))+"</span>"}return n(a2.userName,YAHOO.lang.trim(a2.firstName+" "+a2.lastName))};YAHOO.lang.augmentObject(Alfresco.DocumentList.prototype,{options:{sortAscending:true,showFolders:false,simpleView:null,viewRendererName:"detailed",viewRendererNames:["simple","detailed","gallery"],viewRenderers:[],usePagination:false,siteId:"",containerId:"documentLibrary",rootNode:null,initialPage:1,pageSize:50,initialFilter:{},loadingMessageDelay:1000,highlightFile:null,previewTooltips:null,insituEditors:null,groupActivitiesAt:5,inlineEditMimetypes:{"text/plain":true,"text/html":true,"text/xml":true},replicationUrlMapping:{},listUpdated:false,repositoryBrowsing:true,useTitle:true,userIsSiteManager:false,actionsSplitAt:3},state:{actionEditOfflineActive:false},currentPath:null,currentPage:null,totalRecords:null,currentFilter:null,fileUpload:null,actions:null,selectedFiles:null,currentActionsMenu:null,hideMoreActionsFn:null,afterDocListUpdate:null,doclistMetadata:null,dynamicControls:null,sortControls:null,dragAndDropAllowed:null,dragAndDropEnabled:null,dragEventRefCount:null,dragFolderHighlight:null,renderers:null,viewRenderers:null,_userCanUpload:false,onReady:function V(){var bf=this;this.dragAndDropEnabled=this.dragAndDropAllowed&&("draggable" in document.createElement("span"))&&YAHOO.env.ua.mobile===null;var a9=false;var a5=1;for(var a7=0,bi=this.options.viewRendererNames.length;a7<bi;a7++){if(this.options.viewRendererNames[a7]===this.options.viewRendererName){a9=true;a5=a7;break}}if(!a9&&this.options.viewRendererNames.length>0){this.options.viewRendererName=this.options.viewRendererNames[0]}this.userPreferredView=this.options.viewRendererName;this._setupMetadataRenderers();this._setupHistoryManagers();if(A.get(this.id+"-doclistBar")){this.widgets.sortAscending=Alfresco.util.createYUIButton(this,"sortAscending-button",this.onSortAscending);if(this.widgets.sortAscending!==null){this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(!this.options.sortAscending){A.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.sortControls.push(this.widgets.sortAscending)}this.widgets.sortField=Alfresco.util.createYUIButton(this,"sortField-button",this.onSortField,{type:"menu",menu:"sortField-menu",lazyloadmenu:false});if(this.widgets.sortField!==null){this.sortControls.push(this.widgets.sortField);var a3=this.widgets.sortField.getMenu().getItems(),ba;for(ba in a3){if(a3.hasOwnProperty(ba)){if(a3[ba].value===this.options.sortField){this.widgets.sortField.set("label",a3[ba].cfg.getProperty("text")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);break}}}}this.widgets.showFolders=Alfresco.util.createYUIButton(this,"showFolders-button",this.onShowFolders,{type:"checkbox",checked:this.options.showFolders});if(this.widgets.showFolders!==null){this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.dynamicControls.push(this.widgets.showFolders)}if(A.get(this.id+"-simpleDetailed")){this.widgets.viewRendererSelect=new YAHOO.widget.ButtonGroup(this.id+"-simpleDetailed");if(this.widgets.viewRendererSelect!==null){this.widgets.viewRendererSelect.check(a5);this.widgets.viewRendererSelect.on("checkedButtonChange",this.onViewRendererSelect,this.widgets.viewRendererSelect,this);this.dynamicControls.push(this.widgets.viewRendererSelect)}}this.widgets.fileSelect=Alfresco.util.createYUIButton(this,"fileSelect-button",this.onFileSelect,{type:"menu",menu:"fileSelect-menu"});if(this.widgets.fileSelect!==null){this.dynamicControls.push(this.widgets.fileSelect)}if(A.get(this.id+"-options-button")){this.widgets.optionsMenu=Alfresco.util.createYUIButton(this,"options-button",this.onOptionSelect,{type:"menu",menu:"options-menu"});if(this.widgets.optionsMenu!==null){this.dynamicControls.push(this.widgets.optionsMenu)}}}this.services.preferences=new Alfresco.service.Preferences();this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);this._setupViewRenderers();this._setupDataSource();this._setupDataTable();var bh=function a4(bn,bm){if(bf.hideMoreActionsFn){bf.hideMoreActionsFn.call(bf)}var bj=YAHOO.Bubbling.getOwnerByTagName(bm[1].anchor,"div");if(bj!==null){if(typeof bf[bj.id]==="function"){bm[1].stop=true;var bl=bm[1].target;if(typeof bf.viewRenderers[bf.options.viewRendererName]==="object"){bl=bf.viewRenderers[bf.options.viewRendererName].getDataTableRecordIdFromRowElement(bf,bm[1].target)}var bk=bf.widgets.dataTable.getRecord(bl).getData();bf[bj.id].call(bf,bk,bj)}}return true};YAHOO.Bubbling.addDefaultAction("action-link",bh);YAHOO.Bubbling.addDefaultAction("show-more",bh);var bd=function bg(bl,bk){var bj=YAHOO.Bubbling.getOwnerByTagName(bk[1].anchor,"div");if(bj!==null){bf.onLikes.call(bf,bk[1].target.offsetParent,bj)}return true};YAHOO.Bubbling.addDefaultAction("like-action",bd);var bc=function a2(bl,bk){var bj=YAHOO.Bubbling.getOwnerByTagName(bk[1].anchor,"div");if(bj!==null){bf.onFavourite.call(bf,bk[1].target.offsetParent,bj)}return true};YAHOO.Bubbling.addDefaultAction("favourite-action",bc);var be=function a6(bl,bk){var bj=bk[1].anchor;if(bj!==null){var bm=bj.rel,bn,bo={};if(bm&&bm!==""){bk[1].stop=true;bn=bm.split("|");bo={filterOwner:window.unescape(bn[0]||""),filterId:window.unescape(bn[1]||""),filterData:window.unescape(bn[2]||""),filterDisplay:window.unescape(bn[3]||"")};Alfresco.logger.debug("DL_fnChangeFilterHandler","changeFilter =>",bo);YAHOO.Bubbling.fire("changeFilter",bo)}}return true};YAHOO.Bubbling.addDefaultAction("filter-change",be);this.modules.actions=new Alfresco.module.DoclibActions();O.addListener(window,"resize",this._resizeRowContainers,this,true);YAHOO.util.History.onReady(this.onHistoryManagerReady,this,true);try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(bb){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",bb);this.onHistoryManagerReady()}var a8=new Alfresco.widget.FullScreen(this.id);this.fullscreen=a8;YAHOO.util.Event.addListener(A.get(this.id+"-fullscreen-exit-button"),"click",function(bj){a8.toggleFullScreen()});YAHOO.Bubbling.on("fullScreenEnterComplete",function(bk,bj){if(bj[1]&&bj[1].eventGroup==this.id&&(typeof this.viewRenderers[this.options.viewRendererName]==="object")&&this.viewRenderers[this.options.viewRendererName].currentResizeCallback){this.viewRenderers[this.options.viewRendererName].currentResizeCallback()}},this);YAHOO.Bubbling.on("fullScreenExitComplete",function(bk,bj){if(bj[1]&&bj[1].eventGroup==this.id&&(typeof this.viewRenderers[this.options.viewRendererName]==="object")&&this.viewRenderers[this.options.viewRendererName].currentResizeCallback){this.viewRenderers[this.options.viewRendererName].currentResizeCallback()}},this);A.setStyle(this.id+"-options-menu","display","inherit");YAHOO.Bubbling.fire("postDocumentListOnReady",{scope:this,eventGroup:this.id})},_insituCallback:function an(a5,a3){var a9=a3.jsNode,a8=a9.nodeRef,a7="components/documentlibrary/data",a4="";if(F(this.options.siteId)){a7+="/site/"+encodeURIComponent(this.options.siteId)}else{a4="&libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+a7+"/node/"+a8.uri+"?filter="+encodeURIComponent(this.currentFilter.filterId)+"&view="+this.actionsView+"&noCache="+new Date().getTime()+a4,successCallback:{fn:function a2(ba){ba.json.item.jsNode=new Alfresco.util.Node(ba.json.item.node);YAHOO.Bubbling.fire(a9.isContainer?"folderRenamed":"fileRenamed",{file:ba.json.item});return false},scope:this},failureCallback:{fn:function a6(ba){},scope:this}})},fnRenderCellSelected:function aA(){var a2=this;return function a3(a5,a4,a6,a7){if(typeof a2.viewRenderers[a2.options.viewRendererName]==="object"){a2.viewRenderers[a2.options.viewRendererName].renderCellSelected(a2,a5,a4,a6,a7)}}},fnRenderCellStatus:function Q(){var a2=this;return function a3(a5,a4,a6,a7){if(typeof a2.viewRenderers[a2.options.viewRendererName]==="object"){a2.viewRenderers[a2.options.viewRendererName].renderCellStatus(a2,a5,a4,a6,a7)}}},fnRenderCellThumbnail:function aV(){var a2=this;return function a3(a5,a4,a6,a7){if(typeof a2.viewRenderers[a2.options.viewRendererName]==="object"){a2.viewRenderers[a2.options.viewRendererName].renderCellThumbnail(a2,a5,a4,a6,a7)}}},fnRenderCellDescription:function aR(){var a2=this;return function a3(a5,a4,a6,a7){if(typeof a2.viewRenderers[a2.options.viewRendererName]==="object"){a2.viewRenderers[a2.options.viewRendererName].renderCellDescription(a2,a5,a4,a6,a7)}}},fnRenderCellActions:function aW(){var a3=this;return function a2(a5,a4,a6,a7){if(typeof a3.viewRenderers[a3.options.viewRendererName]==="object"){a3.viewRenderers[a3.options.viewRendererName].renderCellActions(a3,a5,a4,a6,a7)}}},renderProperty:function(a3){if(YAHOO.lang.isString(a3)){return f(a3)}else{if(YAHOO.lang.isArray(a3)){var a2=this.renderProperty;return a3.reduce(function(a4,a5){return a2(a4)+", "+a2(a5)})}else{if(YAHOO.lang.isBoolean(a3)){return a3}else{if(YAHOO.lang.isNumber(a3)){return a3}else{if(YAHOO.lang.isObject(a3)){if(a3.hasOwnProperty("iso8601")){return N(a3.iso8601)}else{if(a3.hasOwnProperty("userName")&&a3.hasOwnProperty("displayName")){return Alfresco.util.userProfileLink(a3.userName,a3.displayName)}else{if(a3.hasOwnProperty("displayName")){return f(a3.displayName||"")}else{if(a3.hasOwnProperty("title")){return f(a3.title||"")}else{if(a3.hasOwnProperty("name")){return f(a3.name||"")}}}}}}}}}}return""},onRegisterRenderer:function R(a3,a2){var a4=a2[1];if(a4&&F(a4.propertyName)&&F(a4.renderer)){this.registerRenderer(a4.propertyName,a4.renderer)}else{Alfresco.logger.error("DL_onRegisterRenderer: Custom renderer registion invalid: "+a4)}},onRegisterViewRenderer:function m(a3,a2){var a4=a2[1];if(a4&&F(a4.renderer)){this.registerViewRenderer(a4.renderer)}else{Alfresco.logger.error("DL_onRegisterViewRenderer: Custom view renderer registion invalid: "+a4)}},registerRenderer:function aG(a2,a3){if(F(a2)&&F(a3)){this.renderers[a2]=a3;return true}return false},registerViewRenderer:function P(a2){if(F(a2)){this.viewRenderers[a2.name]=a2;this.viewRenderers[a2.name].setupRenderer(this);return true}return false},_setupMetadataRenderers:function B(){var a2={};if(this.options.suppressComponent){a2=JSON.parse(this.options.suppressComponent)}this.registerRenderer("i18nLabel",function(a3,a4){return a4.replace(/:\s$/,"")});this.registerRenderer("lockBanner",function(a3,a5){var a7=a3.jsNode.properties,ba=a7.lockOwner||a7.workingCopyOwner,a4=Alfresco.DocumentList.generateUserLink(this,ba),a9=a3.jsNode.isContainer,a8="details.banner.",a6="";if(a9){a8+="folder."}if(a3.workingCopy&&ba.userName===Alfresco.constants.USERNAME){a6=this.msg(a8+(a3.workingCopy.isWorkingCopy?"editing":"lock-owner"))}else{if(ba.userName===Alfresco.constants.USERNAME){a6=this.msg(a8+"lock-owner")}else{a6=this.msg(a8+"locked",a4)}}return a6});this.registerRenderer("syncFailed",function(a3,a4){return'<span class="banner-more-info-link">'+this.msg("details.banner.more-info")+"</span>"+this.msg("details.banner.sync-failed")});this.registerRenderer("syncTransientError",function(a3,a4){return'<span class="banner-more-info-link">'+this.msg("details.banner.more-info")+"</span>"+this.msg("details.banner.sync-transient-error")});this.registerRenderer("date",function(a3,a4){var a9=a3.jsNode,a7=a9.properties,a6="";var a5=Alfresco.util.isSuppressed(a3.node,a2.date.browse.folder);if(!a5){var a8="modified",ba=a7.modified.iso8601;if(a3.workingCopy&&a3.workingCopy.isWorkingCopy){a8="editing-started"}else{if(ba===a7.created.iso8601){a8="created"}}a6='<span class="item">'+a4+this.msg("details."+a8+"-by",ab(ba),Alfresco.DocumentList.generateUserLink(this,a7.modifier))+"</span>"}return a6});this.registerRenderer("size",function(a3,a4){var a7=a3.jsNode,a6=a7.properties,a5="";if(!a7.isContainer&&!a7.isLink){a5+='<span class="item">'+a4+Alfresco.util.formatFileSize(a7.size)+"</span>"}return a5});this.registerRenderer("name",function(a3,a4){var a7=a3.jsNode,a6=a7.properties,a5="";if(a7.hasPermission("Write")&&!a7.isLocked&&!a7.hasAspect("cm:workingcopy")){this.insituEditors.push({context:"___"+a3._filenameId,params:{type:"textBox",nodeRef:a7.nodeRef.toString(),name:"prop_cm_name",value:a3.fileName,fnSelect:function a8(ba,bb){var a9=bb.lastIndexOf(Alfresco.util.getFileExtension(bb))-1;if(a9>0){Alfresco.util.selectText(ba,0,a9)}else{ba.select()}},validations:[{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true},when:"keyup",message:this.msg("validation-hint.length.min.max",1,255)},{type:Alfresco.forms.validation.nodeName,when:"keyup",message:this.msg("validation-hint.nodeName")}],title:this.msg("tip.insitu-rename"),errorMessage:this.msg("message.insitu-edit.name.failure")},callback:{fn:this._insituCallback,scope:this,obj:a3}})}a5+='<span id="___'+a3._filenameId+'">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(this,a3);a5+=f(a3.displayName)+"</a></span>";return a5});this.registerRenderer("version",function(a3,a4){var a7=a3.jsNode,a6=a7.properties,a5="";if(!a7.isContainer&&!a7.isLink){a5+='<span class="item">'+a4+a3.version+"</span>"}return a5});this.registerRenderer("description",function(a3,a4){var a7=a3.jsNode,a6=a7.properties,a8=Alfresco.util.generateDomId(),a5='<span id="'+a8+'" class="faded">'+a4+this.msg("details.description.none")+"</span>";if(a6.description&&a6.description!==""){a5='<span id="'+a8+'" class="item">'+a4+ak(f(a6.description))+"</span>"}return a5});this.registerRenderer("mimetype",function(a3,a5){var a7=a3.jsNode,a6="",a4="";if(!a7.isContainer&&!a7.isLink){if(typeof a7.mimetypeDisplayName!=="undefined"){a4=a7.mimetypeDisplayName}else{a4=this.msg("label.mimetype.unknown")}a6+='<span class="item">'+a5+a4+"</span>"}return a6});this.registerRenderer("tags",function(a8,bb){var a4=a8.jsNode,a9=a4.properties,a3=Alfresco.util.generateDomId(),a7="";var ba=Alfresco.util.isSuppressed(a8.node,a2.tags.browse.folder);if(!ba){var bd=a4.tags,bc;if(a4.hasAspect("cm:taggable")&&bd.length>0){for(var a6=0,a5=bd.length;a6<a5;a6++){bc=f(bd[a6]);a7+='<span class="tag" style="display: inline-block"><a href="#" class="tag-link" rel="'+bc+'">'+bc+"</a></span>"}}else{a7+='<span class="faded">'+bb+this.msg("details.tags.none")+"</span>"}if(a4.hasPermission("Write")&&!a4.isLocked){this.insituEditors.push({context:a3,params:{type:"tagEditor",nodeRef:a4.nodeRef.toString(),name:"prop_cm_taggable",value:a8.node.properties["cm:taggable"],validations:[{type:Alfresco.forms.validation.nodeName,when:"keyup",message:this.msg("validation-hint.nodeName")},{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true,ignoreEmpty:true},when:"keyup",message:this.msg("validation-hint.length.min.max",1,255)}],title:this.msg("tip.insitu-tag"),errorMessage:this.msg("message.insitu-edit.tag.failure")},callback:{fn:this._insituCallback,scope:this,obj:a8}})}return'<span id="'+a3+'" class="item">'+bb+a7+"</span>"}return""});this.registerRenderer("categories",function(a9,bb){var a3=a9.jsNode,ba=a3.properties,a7="";if(a3.hasAspect("cm:generalclassifiable")){var a8=a3.categories,a4;a7+='<span class="category-item item">&nbsp;</span><span class="item">'+bb;if(a8.length>0){for(var a6=0,a5=a8.length;a6<a5;a6++){a4=a8[a6];a7+='<span class="category"><a href="#" class="filter-change" rel="'+Alfresco.DocumentList.generateCategoryMarkup(a4)+'">'+f(a4[0])+"</a></span>"+(a5-a6>1?", ":"")}}else{a7+='<span class="faded">'+bb+this.msg("details.categories.none")+"</span>"}a7+="</span>"}return a7});this.registerRenderer("social",function(a3){var a6=a3.jsNode,a4="";var a5=Alfresco.util.isSuppressed(a3.node,a2.social.browse.folder);if(!a5){a4+='<span class="item item-social">'+Alfresco.DocumentList.generateFavourite(this,a3)+"</span>";a4+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateLikes(this,a3)+"</span>";if(a6.permissions.user.CreateChildren){a4+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateComments(this,a3)+"</span>"}if(!a3.node.isContainer&&Alfresco.constants.QUICKSHARE_URL){a4+='<span class="item item-separator">'+Alfresco.DocumentList.generateQuickShare(this,a3)+"</span>"}}return a4})},_setupViewRenderers:function U(){for(var a4=0;a4<this.options.viewRenderers.length;a4++){var a5=this.options.viewRenderers[a4].widget;if(a5!=null){var a3=a5.split(".");var a6=window;for(var a2=0;a2<a3.length;a2++){a6=a6[a3[a2]]}if(typeof a6==="function"){this.registerViewRenderer(new a6(this.options.viewRenderers[a4].id,this,this.options.commonComponentStyle,this.options.viewRenderers[a4].jsonConfig))}}}YAHOO.Bubbling.fire("postSetupViewRenderers",{scope:this,eventGroup:this.id})},_setupHistoryManagers:function aw(){var a5=YAHOO.util.History.getBookmarkedState("filter");a5=a5||"path|/";try{while(a5!==(a5=decodeURIComponent(a5.replace(/%25/g,"%2525")))){}}catch(a8){}var a3=function ba(bb){var bc=bb.split("|"),bd={filterId:window.unescape(bc[0]||"")};if(typeof bc[1]!=="undefined"){bd.filterData=window.unescape(bc[1])}if(typeof bc[2]!=="undefined"){bd.filterDisplay=window.unescape(bc[2])}bd.filterOwner=Alfresco.util.FilterManager.getOwner(bd.filterId);return bd};this.options.initialFilter=a3(a5);YAHOO.util.History.register("filter",a5,function a2(bc){Alfresco.logger.debug("HistoryManager: filter changed:"+bc);var bb=YAHOO.util.History.getBookmarkedState("page")||"1";while(bb!==(bb=decodeURIComponent(bb))){}var bd=parseInt(bb||this.options.initialPage,10);if(this.currentPage!=bd){this.currentPage=bd}this._updateDocList.call(this,{filter:a3(bc),page:this.currentPage})},null,this);var a4=function a6(bc,bb){bb.widgets.paginator.setState(bc);YAHOO.util.History.navigate("page",String(bc.page))};if(this.options.usePagination){var a9=YAHOO.util.History.getBookmarkedState("page")||"1";while(a9!==(a9=decodeURIComponent(a9))){}this.currentPage=parseInt(a9||this.options.initialPage,10);YAHOO.util.History.register("page",a9,function a7(bb){Alfresco.logger.debug("HistoryManager: page changed:"+bb);if(this.currentPage!=bb){this._updateDocList.call(this,{page:bb})}else{Alfresco.logger.debug("...page changed event ignored.")}},null,this);this.widgets.paginator=new YAHOO.widget.Paginator({containers:[this.id+"-paginator",this.id+"-paginatorBottom"],rowsPerPage:this.options.pageSize,initialPage:this.currentPage,template:this.msg("pagination.template"),pageReportTemplate:this.msg("pagination.template.page-report"),previousPageLinkLabel:this.msg("pagination.previousPageLinkLabel"),nextPageLinkLabel:this.msg("pagination.nextPageLinkLabel")});this.widgets.paginator.subscribe("changeRequest",a4,this);A.setStyle(this.id+"-doclistBarBottom","display","block")}},_setupDataSource:function ac(){var a3=this;this.widgets.dataSource=new YAHOO.util.DataSource(this.dataSourceUrl,{responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{paginationRecordOffset:"startIndex",totalRecords:"totalRecords",totalRecordsUpper:"totalRecordsUpper"}}});this.widgets.dataSource.doBeforeCallback=function a2(a6,a4,a7){a3.doclistMetadata=a4.metadata;YAHOO.Bubbling.fire("doclistMetadata",{metadata:a3.doclistMetadata});var a5=null;if(a3.doclistMetadata.parent){a5=a3.doclistMetadata.parent.permissions;if(a5&&a5.user){YAHOO.Bubbling.fire("userAccess",{userAccess:a5.user})}}if(typeof a3.viewRenderers[a3.options.viewRendererName]==="object"){a3.viewRenderers[a3.options.viewRendererName].renderEmptyDataSourceHtml(a3,a5)}return a7}},_setupDataTable:function aS(){var bb=this;var a3=A.get("alf-filters"),a4=(a3?parseInt(a3.style.width,10):160)+390;var a5=[{key:"nodeRef",label:"Select",sortable:false,formatter:this.fnRenderCellSelected(),width:16},{key:"status",label:"Status",sortable:false,formatter:this.fnRenderCellStatus(),width:16},{key:"thumbnail",label:"Preview",sortable:false,formatter:this.fnRenderCellThumbnail(),width:100},{key:"fileName",label:"Description",sortable:false,formatter:this.fnRenderCellDescription(),width:(A.getViewportWidth()-a4)},{key:"actions",label:"Actions",sortable:false,formatter:this.fnRenderCellActions(),width:200}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-documents",a5,this.widgets.dataSource,{renderLoopSize:this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE,initialLoad:false,dynamicData:true,MSG_EMPTY:this.msg("message.loading")});var ba=A.getElementsByClassName("yui-dt-empty");if(ba.length>0){ba[0].colSpan=100}this.widgets.dataTable.handleDataReturnPayload=function a7(bd,bc,be){bb.totalRecords=bc.meta.totalRecords;bb.totalRecordsUpper=bc.meta.totalRecordsUpper;return bc.meta};this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.subscribe("tableMsgShowEvent",function(bh){this._elMsgTbody.parentNode.style.width="";if(bh.html&&bh.html.indexOf("docListInstructions")!==-1){var bk=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListToolbar");if(bk!==null){var bi=A.get(bb.id+"-standard-upload-link-template-instance");if(bi!==null){var bl=A.getChildren(bi);O.addListener(bl[0],"click",bk.onFileUpload,bk,true);O.addListener(A.getFirstChild(bl[1]),"click",bk.onFileUpload,bk,true)}var bg=A.get(bb.id+"-new-folder-link-template-instance");if(bg!==null){var bj=A.getChildren(bg);O.addListener(bj[0],"click",bk.onNewFolder,bk,true);O.addListener(A.getFirstChild(bj[1]),"click",bk.onNewFolder,bk,true)}}var bc=A.get(bb.id+"-show-folders-template-instance");if(bc!==null){var be=function bd(){var bm=A.getElementsByClassName("showFolders")[0];bb.options.showFolders=true;bm.innerHTML=this.msg("button.folders.hide");A.replaceClass(bm,"showFolders","hideFolders");bb.services.preferences.set(Y,bb.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")};var bf=A.getChildren(bc);O.addListener(bf[0],"click",be,bb,true);O.addListener(bf[1],"click",be,bb,true)}}});this.widgets.dataTable.sortColumn=function(bh,bf){var bc=this.getColumnSortDir(bh);var bi=this.get("sortedBy")||{};var bd=(bi.key===bh.key)?true:false;var be=this.getState();be.sortedBy={key:bh.key,dir:bc};this.set("sortedBy",be.sortedBy);var bg="ascending";if(bc!="yui-dt-asc"){bg="descending"}bb.onSortFieldEvent(bh.field,bg)};this.widgets.dataTable.doBeforeLoadData=function a2(be,bg,bi){if(bg.error){try{var bc=YAHOO.lang.JSON.parse(bg.responseText);bb.widgets.dataTable.set("MSG_ERROR",bc.message)}catch(bh){bb._setDefaultDataTableErrors(bb.widgets.dataTable)}}else{if(bg.results.length===0){A.setStyle(bb.widgets.dataTable._elThead,"display","none");this.fireEvent("renderEvent",{type:"renderEvent"})}else{for(var bd=0,bf=bg.results.length;bd<bf;bd++){bg.results[bd].jsNode=new Alfresco.util.Node(bg.results[bd].node)}}}return true};this.widgets.dataTable.subscribe("checkboxClickEvent",function a8(bc){var bd=bc.target.value;this.selectedFiles[bd]=bc.target.checked;YAHOO.Bubbling.fire("selectedFilesChanged")},this,true);this.widgets.dataTable.subscribe("renderEvent",function a9(){Alfresco.logger.debug("DataTable renderEvent");var bi=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListToolbar");if(bi&&bi.isVirtualFolder()){A.addClass(this.id+"-new-folder-link-template-instance","hidden")}if(0<YAHOO.env.ua.ie&&YAHOO.env.ua.ie<7){var bd=this.widgets.dataTable.getTableEl().parentNode;bd.className=bd.className}if(this.widgets.paginator){Alfresco.logger.debug("Setting paginator state: page="+this.currentPage+", totalRecords="+this.totalRecords);this.widgets.paginator.setState({page:this.currentPage,totalRecords:this.totalRecords});if(this.totalRecordsUpper){this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report.more"))}else{this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report"))}this.widgets.paginator.render()}if(this.options.highlightFile){YAHOO.Bubbling.fire("highlightFile",{fileName:window.unescape(this.options.highlightFile)})}else{if(this.listUpdated){var bh=A.getY(this.id+"-documents"),bc=YAHOO.env.ua.ie>0?((document.compatMode&&document.compatMode!=="BackCompat")?document.documentElement:document.body).scrollTop:window.scrollY;if(bc>bh){window.scrollTo(0,bh)}}}var bg,bf;for(bg=0,bf=this.afterDocListUpdate.length;bg<bf;bg++){this.afterDocListUpdate[bg].call(this)}this.afterDocListUpdate=[];if(typeof this.widgets.previewTooltip!=="undefined"){this.widgets.previewTooltip.cfg.setProperty("context",this.previewTooltips)}var be;for(bg=0,bf=this.insituEditors.length;bg<bf;bg++){be=this.insituEditors[bg];Alfresco.util.createInsituEditor(be.context,be.params,be.callback)}this.widgets.dataTable.set("renderLoopSize",this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE)},this,true);this.widgets.dataTable.subscribe("rowMouseoverEvent",this.onEventHighlightRow,this,true);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.onEventUnhighlightRow,this,true);O.delegate(this.id,"click",function a6(be,bg){var bf=bg.getAttribute("data-action"),bh=bb.widgets.dataTable.getRecord(bg),bc;if(bh==null){var bi=bb.currentActionsMenu.id;var bd=bb.widgets.dataTable.getRecordSet()._records;for(i=0;i<bd.length;i++){if(bi.indexOf(bd[i]._sId)>0){bh=bb.widgets.dataTable.getRecord(bd[i]._sId);bg=bh._sId}}}if(bh!=null){bc=bh.getData()}if(YAHOO.lang.isFunction(bb[bf])){bb[bf].call(bb,bc,bg)}else{if(YAHOO.lang.isFunction(window[bf])){window[bf](bc,bg)}}},"a.indicator-action");if(this.dragAndDropEnabled){O.addListener(document.body,"dragenter",this._swallowDragEnter,this,true);O.addListener(document.body,"dragover",this._swallowDragOver,this,true);O.addListener(document.body,"drop",this._swallowDragDrop,this,true);O.addListener(document.body,"dragstart",this._swallowDragStart,this,true)}},_removeDragAndDrop:function at(){if(this.dragAndDropEnabled){try{var a3=A.get(this.id+"-dl-body");O.removeListener(a3,"dragenter");O.removeListener(a3,"dragover");O.removeListener(a3,"dragleave");O.removeListener(a3,"drop")}catch(a2){Alfresco.logger.error("_removeDragAndDrop: The following exception occurred: ",a2)}}},_addDragAndDrop:function H(){if(this._userCanUpload&&this.dragAndDropEnabled){try{var a3=A.get(this.id+"-dl-body");O.addListener(a3,"dragenter",this.onDocumentListDragEnter,this,true);O.addListener(a3,"dragover",this.onDocumentListDragOver,this,true);O.addListener(a3,"dragleave",this.onDocumentListDragLeave,this,true);O.addListener(a3,"drop",this.onDocumentListDrop,this,true)}catch(a2){Alfresco.logger.error("_addDragAndDrop: The following exception occurred: ",a2)}}},_swallowDragStart:function r(a2){a2.stopPropagation();a2.preventDefault()},_swallowDragEnter:function s(a2){a2.stopPropagation();a2.preventDefault()},_swallowDragOver:function ae(a2){a2.dataTransfer.dropEffect="none";a2.stopPropagation();a2.preventDefault()},_swallowDrop:function ay(a2){a2.stopPropagation();a2.preventDefault()},onDocumentListDragEnter:function ao(a7){var a3=a7.target,a5=this.widgets.dataTable.getRecord(a3),a2=this.widgets.dataTable.getColumn(a3),a6=this.widgets.dataTable.getContainerEl(),a4;if(a5&&a2&&(a3.tagName=="IMG"||a3.className=="droppable")&&a2.getKey()=="thumbnail"){a4=a5.getData("jsNode");if(a4&&a4.isContainer){this.dragFolderHighlight=A.getAncestorByClassName(a3,"folder");A.addClass(this.dragFolderHighlight,"dndFolderHighlight");A.removeClass(a6,"dndDocListHighlight")}}else{this.dragEventRefCount=Math.min(++this.dragEventRefCount,2);A.addClass(a6,"dndDocListHighlight");if(this.dragFolderHighlight){A.removeClass(this.dragFolderHighlight,"dndFolderHighlight");this.dragFolderHighlight=null}}a7.stopPropagation();a7.preventDefault()},onDocumentListDragOver:function l(a2){a2.dataTransfer.dropEffect=Math.floor(YAHOO.env.ua.gecko)===1?"move":"copy";a2.stopPropagation();a2.preventDefault()},onDocumentListDragLeave:function aY(a6){var a3=a6.target,a4=this.widgets.dataTable.getRecord(a3),a5=this.widgets.dataTable.getColumn(a3),a2=a4?a4.getData():null;if(a4&&a5&&(a3.tagName=="IMG"||a3.className=="droppable")&&a2.node.isContainer&&a5.getKey()=="thumbnail"){}else{if(--this.dragEventRefCount===0){A.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight")}}a6.stopPropagation();a6.preventDefault()},onDocumentListDrop:function ag(bc){try{if(bc.dataTransfer.files!==undefined&&bc.dataTransfer.files!==null&&bc.dataTransfer.files.length>0){var a9=Alfresco.getDNDUploadProgressInstance();var a3=false;var bd="",a6,a5;a5=bc.dataTransfer.files.length;for(a6=0;a6<a5;a6++){if(bc.dataTransfer.files[a6].size>0){a3=true}else{bd+='"'+bc.dataTransfer.files[a6].fileName+'", '}}if(!a3){bd=bd.substring(0,bd.lastIndexOf(", "));Alfresco.util.PopupManager.displayMessage({text:a9.msg("message.zeroByteFiles",bd)})}if(a3&&a9.uploadMethod===a9.INMEMORY_UPLOAD){var bg=0;a5=bc.dataTransfer.files.length;for(a6=0;a6<a5;a6++){bg+=bc.dataTransfer.files[a6].size}if(bg>a9.getInMemoryLimit()){a3=false;Alfresco.util.PopupManager.displayPrompt({text:a9.msg("inmemory.uploadsize.exceeded",Alfresco.util.formatFileSize(a9.getInMemoryLimit()))})}}if(a3){var bb=this.currentPath,a2=bb.substring(bb.lastIndexOf("/")+1),be=this.doclistMetadata.parent?this.doclistMetadata.parent.nodeRef:null;var bh=this.widgets.dataTable.getRecord(bc.target);if(bh!==null){var ba=this.widgets.dataTable.getColumn(bc.target),a8=bh.getData();if(bc.target.tagName=="IMG"||bc.target.className=="droppable"){var bf=a8.location;a2=bf.file;bb=aI(bf.path,bf.file);be=a8.nodeRef}}A.removeClass(this.widgets.dataTable.getTrEl(bc.target),"dndFolderHighlight");A.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight");var a7={files:bc.dataTransfer.files,uploadDirectoryName:a2,filter:[],mode:a9.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};if(F(this.options.siteId)){a7.siteId=this.options.siteId;a7.containerId=this.options.containerId;a7.uploadDirectory=bb}else{a7.destination=be}a9.show(a7)}}else{Alfresco.logger.debug("DL_onDocumentListDrop: A drop event was detected, but no files were present for upload: ",bc.dataTransfer)}}catch(a4){Alfresco.logger.error("DL_onDocumentListDrop: The following error occurred when files were dropped onto the Document List: ",a4)}bc.stopPropagation();bc.preventDefault()},onHistoryManagerReady:function y(){if(this.options.initialFilter.filterId==="path"&&window.location.hash=="#upload"){window.location.hash="";var a2=function a3(){YAHOO.Bubbling.fire("showFileUploadDialog",{tooltip:this.msg("dnd.upload.tooltip")})};this.afterDocListUpdate.push(a2)}Alfresco.logger.debug("DL_onHistoryManagerReady","changeFilter =>",this.options.initialFilter);YAHOO.Bubbling.fire("changeFilter",YAHOO.lang.merge({doclistFirstTimeNav:true},this.options.initialFilter));A.setStyle(this.id+"-dl-body","visibility","visible")},getSelectedFiles:function a1(){var a6=[],a7=this.widgets.dataTable.getRecordSet(),a5,a4,a3,a2;for(a3=0,a2=a7.getLength();a3<a2;a3++){a5=a7.getRecord(a3);a4=a5.getData("node");if(this.selectedFiles[a4.nodeRef]){a6.push(a5.getData())}}return a6},selectFiles:function z(bd){var be;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){be=A.get(this.id+this.viewRenderers[this.options.viewRendererName].parentElementIdSuffix)}var a9=this.widgets.dataTable.getRecordSet(),a4=YAHOO.util.Selector.query('input[type="checkbox"]',be),a8=a4.length,bf,a6,a5,bc;switch(bd){case"selectAll":bc=function ba(bg,bh){return true};break;case"selectNone":bc=function a7(bg,bh){return false};break;case"selectInvert":bc=function a3(bg,bh){return !bh};break;case"selectDocuments":bc=function a2(bg,bh){return !(bg.node.isContainer)};break;case"selectFolders":bc=function a2(bg,bh){return bg.node.isContainer};break;default:bc=function bb(bg,bh){return bh}}for(a5=0;a5<a8;a5++){bf=a9.getRecord(a5);a6=bf.getData();this.selectedFiles[a6.nodeRef]=a4[a5].checked=bc(a6,a4[a5].checked)}YAHOO.Bubbling.fire("selectedFilesChanged")},onSortAscending:function X(a2,a3){this.widgets.dataTable.set("sortedBy",null);this.options.sortAscending=!this.options.sortAscending;this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(this.options.sortAscending){A.removeClass(this.widgets.sortAscending.get("element"),"sort-descending")}else{A.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.services.preferences.set(aE,this.options.sortAscending);YAHOO.Bubbling.fire("metadataRefresh");if(a2){O.preventDefault(a2)}},onSortEvent:function a0(a2){this.options.sortAscending=(a2!="descending");this.services.preferences.set(aE,this.options.sortAscending);YAHOO.Bubbling.fire("metadataRefresh")},onSortField:function aP(a7,a6,a5){this.widgets.dataTable.set("sortedBy",null);var a2=a6[0],a4=a6[1];if(a4){var a3=this;this.options.sortField=a4.value;this.widgets.sortField.set("label",a4.cfg.getProperty("text")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);this.services.preferences.set(d,this.options.sortField,{successCallback:{fn:function(){var a8=a4.srcElement.getAttribute("title");if(a8==="true"||a8==="false"){a3.options.sortAscending=(a8==="false");a3.onSortAscending()}else{YAHOO.Bubbling.fire("metadataRefresh")}}}})}O.preventDefault(a2)},onSortFieldEvent:function K(a4,a3){this.options.sortField=a4;var a2=this;this.services.preferences.set(d,a4,{successCallback:{fn:function(){if(a3){a2.options.sortAscending=(a3==="ascending");a2.onSortEvent(a3)}else{YAHOO.Bubbling.fire("metadataRefresh")}}}})},onShowFolders:function j(a2,a3){this.options.showFolders=this.widgets.showFolders.get("checked");this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.services.preferences.set(Y,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh");if(a2){O.preventDefault(a2)}},onShowFoldersEvent:function o(a2){this.options.showFolders=a2;this.services.preferences.set(Y,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")},onViewRendererSelect:function aZ(a2,a3){this.widgets.dataTable.set("sortedBy",null);this.options.viewRendererName=this.options.viewRendererNames[a2.newValue.index];this.userPreferredView=this.options.viewRendererName;this.services.preferences.set(Z,this.options.viewRendererName);YAHOO.Bubbling.fire("metadataRefresh");if(a2){O.preventDefault(a2)}},onViewRendererSelectEvent:function aC(a2){var a5=false;for(var a4=0;a4<this.options.viewRendererNames.length&&!a5;a4++){a5=(this.options.viewRendererNames[a4]==a2)}if(a5){this.widgets.dataTable.set("sortedBy",null);this.options.viewRendererName=a2;this.userPreferredView=this.options.viewRendererName;this.services.preferences.set(Z,this.options.viewRendererName);for(var a4=0;a4<this.options.viewRenderers.length;a4++){if(this.options.viewRenderers[a4].id==this.options.viewRendererName){var a3=A.getElementsByClassName("setDefaultView");a3[0].innerHTML=this.msg("button.setDefaultView",this.options.viewRenderers[a4].label);break}}YAHOO.Bubbling.fire("metadataRefresh")}},onFileSelect:function c(a6,a5,a4){var a2=a5[0],a3=a5[1];this.selectFiles(Alfresco.util.findEventClass(a3))},onOptionSelect:function aD(a3,a9,bf){var ba=a9[0],be=a9[1];var a5=Alfresco.util.findEventClass(be);var a4=be.element;while((a4!==null)&&((a4.tagName.toLowerCase()!="span")||(a4.className.indexOf("yui")===0))){a4=a4.firstChild}var bb=a4;if(a5=="showFolders"){this.options.showFolders=true;bb.innerHTML=this.msg("button.folders.hide");A.replaceClass(bb,"showFolders","hideFolders");this.services.preferences.set(Y,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")}else{if(a5=="hideFolders"){this.options.showFolders=false;bb.innerHTML=this.msg("button.folders.show");A.replaceClass(bb,"hideFolders","showFolders");this.services.preferences.set(Y,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")}else{if(a5=="showPath"){this.options.hideNavBar=false;bb.innerHTML=this.msg("button.navbar.hide");A.replaceClass(bb,"showPath","hidePath");this.services.preferences.set(E,this.options.hideNavBar);A.setStyle(this.options.associatedToolbar.id+"-navBar","display",this.options.hideNavBar?"none":"block")}else{if(a5=="hidePath"){this.options.hideNavBar=true;bb.innerHTML=this.msg("button.navbar.show");A.replaceClass(bb,"hidePath","showPath");this.services.preferences.set(E,this.options.hideNavBar);A.setStyle(this.options.associatedToolbar.id+"-navBar","display",this.options.hideNavBar?"none":"block")}else{if(a5=="fullWindow"){this.fullscreen.toggleFullScreen(true)}else{if(a5=="fullScreen"){this.fullscreen.toggleFullScreen(false)}else{if(a5=="rss"){window.location=this.options.associatedToolbar._getRssFeedUrl()}else{if(a5=="removeDefaultView"||a5=="setDefaultView"){if(a5=="setDefaultView"){for(var a7=0;a7<this.options.viewRenderers.length;a7++){if(this.options.viewRenderers[a7].id==this.options.viewRendererName){var bc=A.getElementsByClassName("removeDefaultView");bc[0].innerHTML=this.msg("button.removeDefaultView",this.options.viewRenderers[a7].label);break}}}var bd=this.doclistMetadata.parent.nodeRef;bd=bd.replace(/:\//g,"");var a8=this;var a2={prop_app_defaultViewId:(a5=="removeDefaultView"?"":this.options.viewRendererName)};Alfresco.util.Ajax.jsonRequest({method:"POST",url:Alfresco.constants.PROXY_URI+"api/node/"+bd+"/formprocessor",dataObj:a2,successCallback:{fn:function(){this._updateDocList.call(this)},scope:this},failure:{message:a8.msg("message.save.failure")}})}else{if(a5.indexOf=="view "!=-1){var a6=a5.substring(5);this.onViewRendererSelectEvent(a6)}}}}}}}}}O.preventDefault(ba)},onEventHighlightRow:function aa(a2){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onEventHighlightRow(this,a2)}},onEventUnhighlightRow:function J(a2){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onEventUnhighlightRow(this,a2)}},onActionShowMore:function D(a3,a2){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onActionShowMore(this,a3,a2)}},onActionEditOffline:function T(a4){if(!this.state.actionEditOfflineActive){this.state.actionEditOfflineActive=true;var a5=a4.jsNode.nodeRef,a3=a4.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},callback:{fn:function a6(a9){this.state.actionEditOfflineActive=false;this.options.highlightFile=a3;var a8=function a7(){var ba=false;YAHOO.Bubbling.on("editingCanceled",function(bf,be){if(a9.config.object.nodeRef==be[1].record.workingCopy.sourceNodeRef.replace(/:\//g,"")){ba=true}},this);var bd=Alfresco.constants.PROXY_URI+a9.json.results[0].downloadUrl;if(YAHOO.env.ua.ie>6){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-offline.success",a3),text:this.msg("message.edit-offline.success.ie7"),buttons:[{text:this.msg("button.download"),handler:function bc(){window.open(bd,"_blank");this.destroy()},isDefault:true},{text:this.msg("button.close"),handler:function bb(){this.destroy()}}]})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-offline.success",a3)});YAHOO.lang.later(3000,this,function(){if(!ba){window.location=bd}})}};this.afterDocListUpdate.push(a8)},scope:this}},failure:{callback:{fn:function a2(){this.state.actionEditOfflineActive=false},scope:this},message:this.msg("message.edit-offline.failure",a3)},webscript:{method:Alfresco.util.Ajax.POST,name:"checkout/node/{nodeRef}",params:{nodeRef:a5.uri}}})}},_checkIfUpdatedPageIsEmpty:function u(){var a2=(this.currentPage-1)*this.options.pageSize;if(a2>=this.totalRecords){this.widgets.paginator.setPage(1);this.currentPage=1}},_unselectFile:function aU(a3){var a2=a3.action;if(a2&&(a2=="fileCopied"||a2=="fileMoved"||a2=="folderCopied"||a2=="folderMoved")){if(this.selectedFiles[a3.nodeRef]){this.selectedFiles[a3.nodeRef]=false}}},onFileAction:function aB(a3,a2){var a4=a2[1];if(a4){this._unselectFile(a4);if(!a4.multiple){this._checkIfUpdatedPageIsEmpty();this._updateDocList.call(this)}}},onFileRenamed:function L(a3,a2){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onFileRenamed(this,a3,a2)}},onDocListRefresh:function af(a3,a2){var a4=a2[1];if(a4&&(a4.highlightFile!==null)){this.options.highlightFile=a4.highlightFile}this._checkIfUpdatedPageIsEmpty();this._updateDocList.call(this)},onChangeFilter:function I(a4,a3){var a7=a3[1];if((a7!==null)&&(a7.filterId!==null)){var a6=Alfresco.util.cleanBubblingObject(a7),a5=window.escape(a7.filterId)+(typeof a7.filterData!=="undefined"?"|"+window.escape(a7.filterData)+(typeof a7.filterDisplay!=="undefined"?"|"+window.escape(a7.filterDisplay):""):"");Alfresco.logger.debug("DL_onChangeFilter: ",a6);this._removeDragAndDrop();if(a7.filterId==="path"||a7.filterId==="favourites"){this._addDragAndDrop()}this.listUpdated=true;var a2={filter:a5};if(a7.doclistFirstTimeNav||a5===YAHOO.util.History.getCurrentState("filter")){this._updateDocList.call(this,{filter:a6,page:this.currentPage})}else{if(this.options.usePagination){this.currentPage=1;a2.page="1"}Alfresco.logger.debug("DL_onChangeFilter: objNav = ",a2);if(this.options.highlightFile&&a2.filter===YAHOO.util.History.getCurrentState("filter")){YAHOO.Bubbling.fire("highlightFile",{fileName:this.options.highlightFile})}YAHOO.util.History.multiNavigate(a2)}}},onFilterChanged:function w(a3,a2){var a4=a2[1];if((a4!==null)&&(a4.filterId!==null)){a4.filterOwner=a4.filterOwner||Alfresco.util.FilterManager.getOwner(a4.filterId);this.currentFilter=Alfresco.util.cleanBubblingObject(a4);Alfresco.logger.debug("DL_onFilterChanged: ",this.currentFilter)}},onHighlightFile:function ah(a3,a2){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onHighlightFile(this,a3,a2)}},onDeactivateAllControls:function W(a4,a3){var a2,a5=Alfresco.util.disableYUIButton;for(a2 in this.widgets){if(this.widgets.hasOwnProperty(a2)){a5(this.widgets[a2])}}},onDeactivateDynamicControls:function ar(a4,a3){var a2,a5=Alfresco.util.disableYUIButton;for(a2 in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(a2)){a5(this.dynamicControls[a2])}}},onDeactivateSortControls:function aF(a4,a3){var a2,a5=Alfresco.util.disableYUIButton;for(a2 in this.sortControls){if(this.sortControls.hasOwnProperty(a2)){a5(this.sortControls[a2])}}},onActivateSortControls:function g(a4,a3){var a2,a5=Alfresco.util.enableYUIButton;for(a2 in this.sortControls){if(this.sortControls.hasOwnProperty(a2)){a5(this.sortControls[a2])}}},onActivateDynamicControls:function G(a4,a3){var a2,a5=Alfresco.util.enableYUIButton;for(a2 in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(a2)){a5(this.dynamicControls[a2])}}},onLikes:function C(a8){var a5=a8;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){a5=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,a8)}var a9=this.widgets.dataTable.getRecord(a5),a6=a9.getData(),a7=a6.jsNode.nodeRef,a3=a6.likes;a3.isLiked=!a3.isLiked;a3.totalLikes+=(a3.isLiked?1:-1);var ba={successCallback:{fn:function a2(bh,be){var bi=bh.json.data;if(bi){var bg=this._findRecordByParameter(be,"nodeRef"),bb=bg.getData(),bf=bb.node,bc=bb.likes;bc.totalLikes=bi.ratingsCount;this.widgets.dataTable.updateRow(bg,bb);if(bc.isLiked){var bd={fileName:bb.fileName,nodeRef:bf.nodeRef};if(bf.isContainer){this.modules.actions.postActivity(this.options.siteId,"folder-liked","folder-details",bd)}else{this.modules.actions.postActivity(this.options.siteId,"file-liked","document-details",bd)}}}},scope:this,obj:a7.toString()},failureCallback:{fn:function a4(bf,bd){var be=this._findRecordByParameter(bd,"nodeRef"),bb=be.getData(),bc=bb.likes;bc.isLiked=!bc.isLiked;bc.totalLikes+=(bc.isLiked?1:-1);this.widgets.dataTable.updateRow(be,bb);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",bb.displayName)})},scope:this,obj:a7.toString()}};if(a3.isLiked){this.services.likes.set(a7,1,ba)}else{this.services.likes.remove(a7,ba)}this.widgets.dataTable.updateRow(a9,a6)},onFavourite:function az(a8){var a5=a8;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){a5=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,a8)}var a9=this.widgets.dataTable.getRecord(a5),a6=a9.getData(),a4=a6.node,a7=a4.nodeRef;a6.isFavourite=!a6.isFavourite;this.widgets.dataTable.updateRow(a9,a6);var a3=a6.isFavourite?"favouriteDocumentOrFolder":"unFavouriteDocumentOrFolder";var ba={failureCallback:{fn:function a2(bf,bb){var be=this.widgets.dataTable.getRecord(bb),bc=be.getData(),bd=bc.node;bc.isFavourite=!bc.isFavourite;this.widgets.dataTable.updateRow(be,bc);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",bc.displayName)})},scope:this,obj:a8}};this.services.preferences[a3].call(this.services.preferences,a4,ba)},onResizerChanged:function aO(){this._resizeRowContainers()},_resizeRowContainers:function am(a5){if(!YAHOO.lang.isNumber(a5)){var a2=A.get("alf-filters"),a6=(a2?parseInt(a2.style.width,10):160)+390,a5=(A.getViewportWidth()-a6)+"px"}else{a5=(a5-390)+"px"}var a3=YAHOO.util.Selector.query("h3.filename",this.id+"-documents");for(var a4=0;a4<a3.length;a4++){a3[a4].parentNode.style.width=a5}},_setDefaultDataTableErrors:function e(a2){var a3=Alfresco.util.message;a2.set("MSG_EMPTY",a3("message.empty","Alfresco.DocumentList"));a2.set("MSG_ERROR",a3("message.error","Alfresco.DocumentList"))},_updateDefaultViewOptions:function ax(a7){var a5=A.getElementsByClassName("removeDefaultView");var a6=null;if(a5.length>0){a6=a5[0].parentNode.parentNode}var a2=A.getElementsByClassName("setDefaultView");var a4=null;if(a2.length>0){a4=a2[0].parentNode.parentNode}if(this.options.userIsSiteManager||(this.doclistMetadata.parent.properties!=null&&this.doclistMetadata.parent.properties["cm:creator"].userName==Alfresco.constants.USERNAME)){if(this.doclistMetadata.parent.properties!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=""){for(var a3=0;a3<this.options.viewRenderers.length;a3++){if(this.options.viewRenderers[a3].id==this.doclistMetadata.parent.properties["app:defaultViewId"]){a5[0].innerHTML=this.msg("button.removeDefaultView",this.options.viewRenderers[a3].label);break}}A.removeClass(a6,"hidden");if(this.doclistMetadata.parent.properties["app:defaultViewId"]==this.options.viewRendererName){A.addClass(a4,"hidden")}else{A.removeClass(a4,"hidden")}}else{A.removeClass(a4,"hidden");A.addClass(a6,"hidden")}}else{A.addClass(a4,"hidden");A.addClass(a6,"hidden")}if(a7){if(this.doclistMetadata.parent.properties&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=""){this.options.viewRendererName=this.doclistMetadata.parent.properties["app:defaultViewId"];A.addClass(a4,"hidden")}else{if(this.userPreferredView!=this.options.viewRendererName){this.options.viewRendererName=this.userPreferredView}}}for(var a3=0;a3<this.options.viewRenderers.length;a3++){if(this.options.viewRenderers[a3].id==this.options.viewRendererName){a2[0].innerHTML=this.msg("button.setDefaultView",this.options.viewRenderers[a3].label);break}}},_updateDocList:function aH(bf){bf=bf||{};Alfresco.logger.debug("DL__updateDocList: ",bf.filter,bf.page);var bh=YAHOO.lang.merge({doclistFirstTimeNav:false},bf.filter!==undefined?bf.filter:this.currentFilter),a3=bf.page!==undefined?bf.page:this.currentPage,bb=null,a7=null,bd=this,a5={filter:bh,page:a3};var a8=function bc(){Alfresco.logger.debug("DL__uDL_fnShowLoadingMessage: slow data webscript detected.");if(a7){bb=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+f(this.msg("message.loading"))+"</span>",noEscape:true});if(YAHOO.env.ua.ie>0){this.loadingMessageShowing=true}else{bb.showEvent.subscribe(function(){this.loadingMessageShowing=true},this,true)}}};this._setDefaultDataTableErrors(this.widgets.dataTable);this.previewTooltips=[];this.insituEditors=[];this.hideMoreActionsFn=null;this.loadingMessageShowing=false;a7=YAHOO.lang.later(this.options.loadingMessageDelay,this,a8);var bg=function a9(){if(a7){a7.cancel();a7=null}if(bb){if(this.loadingMessageShowing){bb.destroy();bb=null}else{YAHOO.lang.later(100,bd,bg)}}};var ba=function a4(bl,bn,bo){bg();var bi=function bj(){YAHOO.Bubbling.fire("activateDynamicControls");YAHOO.Bubbling.fire("selectedFilesChanged");this.listUpdated=false;if(this.currentFilter.filterId=="recentlyModified"||this.currentFilter.filterId=="recentlyAdded"){YAHOO.Bubbling.fire("deactivateSortControls")}else{YAHOO.Bubbling.fire("activateSortControls")}};this.afterDocListUpdate.push(bi);Alfresco.logger.debug("currentFilter was:",this.currentFilter,"now:",bh);Alfresco.logger.debug("currentPage was ["+this.currentPage+"] now ["+a3+"]");this.currentFilter=bh;this.currentPage=a3;var bp=false;if(bh.filterId==="path"){Alfresco.logger.debug("currentPath was ["+this.currentPath+"] now ["+bh.filterData+"]");bp=(this.currentPath!=bh.filterData);this.currentPath=bh.filterData}delete bh.doclistFirstTimeNav;YAHOO.Bubbling.fire("filterChanged",bh);this._updateDefaultViewOptions(bp);for(var bk=0,bm=this.options.viewRendererNames.length;bk<bm;bk++){if(typeof this.viewRenderers[this.options.viewRendererNames[bk]]==="object"){this.viewRenderers[this.options.viewRendererNames[bk]].destroyView(this,bl,bn,bo)}}if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].renderView(this,bl,bn,bo)}else{}};var a2=function a6(bi,bj){bg();this.afterDocListUpdate=[];if(bj.status===401){window.location.reload(true)}else{try{if(bj.status===404){YAHOO.Bubbling.fire("deactivateDynamicControls");YAHOO.Bubbling.fire("deactivateSortControls")}else{YAHOO.Bubbling.fire("deactivateAllControls")}var bm=function bk(bp,bo){return function bn(){this.widgets.paginator.setState({totalRecords:0});this.widgets.paginator.render();this.widgets.dataTable.set("MSG_ERROR",bp);if(bo===410){this.widgets.dataTable.showTableMessage(bp,YAHOO.widget.DataTable.CLASS_DISABLED)}else{this.widgets.dataTable.showTableMessage(bp,YAHOO.widget.DataTable.CLASS_ERROR)}}};this.afterDocListUpdate.push(bm(YAHOO.lang.JSON.parse(bj.responseText).message,bj.status));this.widgets.dataTable.initializeTable();this.widgets.dataTable.render();this.listUpdated=false}catch(bl){Alfresco.logger.error(bl);this._setDefaultDataTableErrors(this.widgets.dataTable)}}};if(a5.filter&&a5.filter.filterId==="path"){a5.path=a5.filter.filterData;if(this.currentFilter.filterData!=a5.path){Alfresco.logger.debug("currentFilter.filterData was ["+this.currentFilter.filterData+"] now ["+a5.path+"]");this.currentFilter.filterData=a5.path}}var be=this._buildDocListParams(a5);Alfresco.logger.debug("DataSource requestParams: ",be);this.widgets.dataSource.sendRequest(be,{success:ba,failure:a2,scope:this})},_buildDocListParams:function a(a7){var a4=F(this.options.siteId),a5={path:this.currentPath,type:this.options.showFolders?"all":"documents",site:this.options.siteId,container:this.options.containerId,filter:this.currentFilter};if(this.options.usePagination){a5.page=this.widgets.paginator.getCurrentPage()||this.currentPage;a5.pageSize=this.widgets.paginator.getRowsPerPage()}if(typeof a7==="object"){a5=YAHOO.lang.merge(a5,a7)}var a3=("alfresco://company/shared"==this.options.rootNode);var a2=a4?"site/{site}/{container}":a3?"node/alfresco/company/shared":"node/alfresco/user/home",a6=YAHOO.lang.substitute("{type}/"+a2+(a5.filter.filterId==="path"?"{path}":""),{type:encodeURIComponent(a5.type),site:encodeURIComponent(a5.site),container:encodeURIComponent(a5.container),path:aI("/",Alfresco.util.encodeURIPath(a5.path))});a6+="?filter="+encodeURIComponent(a5.filter.filterId);if(a5.filter.filterData&&a5.filter.filterId!=="path"){a6+="&filterData="+encodeURIComponent(a5.filter.filterData)}if(this.options.usePagination){a6+="&size="+a5.pageSize+"&pos="+a5.page}a6+="&sortAsc="+this.options.sortAscending+"&sortField="+encodeURIComponent(this.options.sortField);if(!a4){a6+="&libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}a6+="&view="+this.actionsView+"&noCache="+new Date().getTime();return a6},_findRecordByParameter:function aK(a8,a7){var a6=this.widgets.dataTable.getRecordSet(),a5,a2,a4,a3;for(a4=0,a3=a6.getLength();a4<a3;a4++){a5=a6.getRecord(a4);a2=a5.getData();if(a2[a7]===a8||(a2.node&&a2.node[a7]===a8)){return a5}}return null}},true)})();