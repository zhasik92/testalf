(function(){var E=YAHOO.util.Dom,C=YAHOO.util.Event,g=YAHOO.util.Element;var B=Alfresco.util.encodeHTML,w=Alfresco.util.combinePaths,v=Alfresco.util.siteURL;var a="org.alfresco.share.documentList",G=a+".hideNavBar";Alfresco.DocListToolbar=function(Q,R){Alfresco.DocListToolbar.superclass.constructor.call(this,"Alfresco.DocListToolbar",Q,["button","menu","container"]);this.selectedFiles=[];this.currentFilter={};this.dynamicControls=[];this.doclistMetadata={};this.actionsView="browse";YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("selectedFilesChanged",this.onSelectedFilesChanged,this);YAHOO.Bubbling.on("userAccess",this.onUserAccess,this);YAHOO.Bubbling.on("doclistMetadata",this.onDoclistMetadata,this);YAHOO.Bubbling.on("showFileUploadDialog",this.onFileUpload,this);YAHOO.Bubbling.on("dropTargetOwnerRequest",this.onDropTargetOwnerRequest,this);YAHOO.Bubbling.on("documentDragOver",this.onDocumentDragOver,this);YAHOO.Bubbling.on("documentDragOut",this.onDocumentDragOut,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);YAHOO.Bubbling.on("docLibTreeLoadComplete",this._generateBreadcrumb,this);return this};YAHOO.extend(Alfresco.DocListToolbar,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocListToolbar,Alfresco.doclib.Actions);YAHOO.lang.augmentObject(Alfresco.DocListToolbar.prototype,{options:{siteId:null,containerId:"documentLibrary",groupActivitiesAt:5,hideNavBar:false,repositoryBrowsing:true,useTitle:true},currentPath:"",currentFilter:null,fileUpload:null,selectedFiles:null,folderDetailsUrl:null,dynamicControls:null,doclistMetadata:null,onReady:function D(){if(E.get(this.id+"-tb-body")!=null){if(E.get(this.id+"-createContent-button")){this.widgets.createContent=Alfresco.util.createYUIButton(this,"createContent-button",this.onCreateContent,{type:"menu",menu:"createContent-menu",lazyloadmenu:false,disabled:true,value:"CreateChildren"});var V=this.widgets.createContent.getMenu(),T=0;V.cfg.config.clicktohide.value=true;if(this.options.createContentActions.length!==0){var aj=[],U,af,W,ai,ab,ad,R,Q;for(var ag=0;ag<this.options.createContentActions.length;ag++){af=this.options.createContentActions[ag];ai={parent:V};W=null;if(af.type=="javascript"){ai.onclick={fn:function(al,ak,ao){var an=Alfresco.util.deepCopy(this.doclistMetadata.parent);var am={nodeRef:an.nodeRef,node:an,jsNode:new Alfresco.util.Node(an)};this[ao.params["function"]].call(this,am)},obj:af,scope:this};W="#"}else{if(af.type=="pagelink"){W=v(af.params.page)}else{if(af.type=="link"){W=af.params.href}}}ab='<a href="'+W+'" rel="'+af.permission+'"><span style="background-image:url('+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+af.icon+'-file-16.png)" class="'+af.icon+'-file">'+this.msg(af.label)+"</span></a>";ad=document.createElement("li");ad.innerHTML=ab;U=new YAHOO.widget.MenuItem(ad,ai);aj.push(U);if(af.id&&af.id==="folder"){R=U;Q=ag}}V.addItems(aj,T);T++}if(this.options.createContentByTemplateEnabled){var ad=document.createElement("li");ad.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-node")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",ad,true),"click",function(ak){C.preventDefault(ak);C.stopEvent(ak)});var ae=document.createElement("div");ae.innerHTML='<div class="bd"><ul></ul></div>';var Z=document.createElement("li");Z.innerHTML='<a href="#"><span>'+this.msg("menu.create-content.by-template-folder")+"</span></a>";YAHOO.util.Event.addListener(Selector.query("a",Z,true),"click",function(ak){C.preventDefault(ak);C.stopEvent(ak)});var S=document.createElement("div");S.innerHTML='<div class="bd"><ul></ul></div>';var Y=new YAHOO.widget.MenuItem(ad,{parent:V,submenu:ae});var ah=new YAHOO.widget.MenuItem(Z,{parent:V,submenu:S});V.addItems([Y,ah],T);T++;var X=this.widgets.createContent.getMenu().getSubmenus(),ac=X.length>0?X[0]:null;if(ac){ac.subscribe("beforeShow",this.onCreateByTemplateNodeBeforeShow,this,true);ac.subscribe("click",this.onCreateByTemplateNodeClick,this,true)}var aa=X.length>1?X[1]:null;if(aa){aa.subscribe("beforeShow",this.onCreateByTemplateFolderBeforeShow,this,true);aa.subscribe("click",this.onCreateByTemplateFolderClick,this,true)}}V.subscribe("beforeShow",this.onCreateContentMenuBeforeShow,{createContentMenu:V,folderMenuItem:R||null,folderMenuItemIndex:Q||0,createFolderByTemplateItem:ah||null,createFolderByTemplateItemIndex:1,createFolderByTemplateGroupIndex:T-1,context:this},true);V.render();this.dynamicControls.push(this.widgets.createContent)}this.widgets.newFolder=Alfresco.util.createYUIButton(this,"newFolder-button",this.onNewFolder,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.newFolder);this.widgets.fileUpload=Alfresco.util.createYUIButton(this,"fileUpload-button",this.onFileUpload,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.fileUpload);this.widgets.syncToCloud=Alfresco.util.createYUIButton(this,"syncToCloud-button",this.onSyncToCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.syncToCloud);this.widgets.unsyncFromCloud=Alfresco.util.createYUIButton(this,"unsyncFromCloud-button",this.onUnsyncFromCloud,{disabled:true,value:"CreateChildren"});this.dynamicControls.push(this.widgets.unsyncFromCloud);this.widgets.selectedItems=Alfresco.util.createYUIButton(this,"selectedItems-button",this.onSelectedItems,{type:"menu",menu:"selectedItems-menu",lazyloadmenu:false,disabled:true});this.dynamicControls.push(this.widgets.selectedItems);if(E.get(this.id+"hideNavBar-button")){this.widgets.hideNavBar=Alfresco.util.createYUIButton(this,"hideNavBar-button",this.onHideNavBar,{type:"checkbox",checked:!this.options.hideNavBar});if(this.widgets.hideNavBar!==null){this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));this.dynamicControls.push(this.widgets.hideNavBar)}}E.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.widgets.rssFeed=Alfresco.util.createYUIButton(this,"rssFeed-button",null,{type:"link"});this.dynamicControls.push(this.widgets.rssFeed);this.widgets.folderUp=Alfresco.util.createYUIButton(this,"folderUp-button",this.onFolderUp,{disabled:true,title:this.msg("button.up")});this.dynamicControls.push(this.widgets.folderUp);E.setStyle(this.id+"-tb-body","visibility","visible")}this.modules.actions=new Alfresco.module.DoclibActions();this.modules.docList=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentList");this.services.preferences=new Alfresco.service.Preferences()},onCreateContent:function z(U,T,S){var R=T[1],Q=R.element.getElementsByTagName("a")[0];if(R.parent===this.widgets.createContent.getMenu()&&Q&&Q.nodeName=="A"){Q.href=YAHOO.lang.substitute(Q.href,{nodeRef:this.doclistMetadata.parent.nodeRef})}},onCreateByTemplateNodeBeforeShow:function F(){var Q=this.widgets.createContent.getMenu().getSubmenus()[0];if(Q.getItems().length==0){Q.clearContent();Q.addItem(this.msg("label.loading"));Q.render();Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node-templates",successCallback:{fn:function(T,X){var S=T.json.data,W=[],U;for(var V=0,R=S.length;V<R;V++){node=S[V];U=B(node.name);if(node.title&&node.title!==node.name&&this.options.useTitle){U+='<span class="title">('+B(node.title)+")</span>"}W.push({text:'<span title="'+B(node.description)+'">'+U+"</span>",value:node})}if(W.length==0){W.push(this.msg("label.empty"))}Q.clearContent();Q.addItems(W);Q.render()},scope:this}})}},onCreateByTemplateNodeClick:function K(V,U,T){var R=U[1].value,Q=this.doclistMetadata.parent.nodeRef,S=this.options.siteId;if(R){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/node-templates",dataObj:{sourceNodeRef:R.nodeRef,parentNodeRef:Q},successCallback:{fn:function(W){Alfresco.Share.postActivity(S,"org.alfresco.documentlibrary.file-created","{cm:name}","document-details?nodeRef="+W.json.nodeRef,{appTool:"documentlibrary",nodeRef:W.json.nodeRef});YAHOO.Bubbling.fire("nodeCreated",{name:R.name,parentNodeRef:Q,highlightFile:W.json.name})}},successMessage:this.msg("message.create-content-by-template-node.success",R.name),failureMessage:this.msg("message.create-content-by-template-node.failure",R.name)})}},onCreateByTemplateFolderBeforeShow:function e(){var Q=this.widgets.createContent.getMenu().getSubmenus()[1];if(Q.getItems().length==0){Q.clearContent();Q.addItem(this.msg("label.loading"));Q.render();Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"slingshot/doclib/folder-templates",successCallback:{fn:function(T,X){var S=T.json.data,W=[],U;for(var V=0,R=S.length;V<R;V++){node=S[V];U=B(node.name);if(node.title&&node.title!==node.name&&this.options.useTitle){U+='<span class="title">('+B(node.title)+")</span>"}W.push({text:'<span title="'+B(node.description)+'">'+U+"</span>",value:node})}if(W.length==0){W.push(this.msg("label.empty"))}Q.clearContent();Q.addItems(W);Q.render()},scope:this}})}},onCreateByTemplateFolderClick:function L(W,V,U){var T=this.onNewFolder(null,U);T.options.doBeforeDialogShow={fn:function S(X,Y){E.get(Y.id+"-dialogTitle").innerHTML=this.title;E.get(Y.id+"-dialogHeader").innerHTML=this.header;E.get(Y.id+"_prop_cm_name").value=this.node.name;E.get(Y.id+"_prop_cm_title").value=this.node.title;E.get(Y.id+"_prop_cm_description").value=this.node.description},scope:{node:V[1].value,title:this.msg("label.new-folder-from-template.title"),header:this.msg("label.new-folder-from-template.header")}};T.options.successCallback={fn:function(X){YAHOO.Bubbling.fire("nodeCreated",{name:node.name,parentNodeRef:destination,highlightFile:X.json.name})}};T.options.successMessage=this.msg("message.create-content-by-template-node.success",node.name);T.options.failureMessage=this.msg("message.create-content-by-template-node.failure",node.name);T.options.doBeforeFormSubmit={fn:function Q(X,Y){X.attributes.action.nodeValue=Alfresco.constants.PROXY_URI+"slingshot/doclib/folder-templates"},scope:this};T.options.doBeforeAjaxRequest={fn:function R(X,Y){X.dataObj.sourceNodeRef=this.node.nodeRef;X.dataObj.parentNodeRef=this.destination;return true},scope:{node:V[1].value,destination:this.doclistMetadata.parent.nodeRef}}},onCreateContentMenuBeforeShow:function I(){if(this.createContentMenu&&this.folderMenuItem){if(this.context.isVirtualFolder()){E.addClass(this.folderMenuItem.id,"hidden");E.addClass(this.createFolderByTemplateItem.id,"hidden")}else{E.removeClass(this.folderMenuItem.id,"hidden");E.removeClass(this.createFolderByTemplateItem.id,"hidden")}}},onNewFolder:function x(U,X){var W=this.doclistMetadata.parent.nodeRef;var Y=function S(Z,aa){E.get(aa.id+"-dialogTitle").innerHTML=this.msg("label.new-folder.title");E.get(aa.id+"-dialogHeader").innerHTML=this.msg("label.new-folder.header")};var Q=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"type",itemId:"cm:folder",destination:W,mode:"create",submitType:"json",formId:"doclib-common"});var T=new Alfresco.module.SimpleDialog(this.id+"-createFolder");T.setOptions({width:"33em",templateUrl:Q,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:Y,scope:this},onSuccess:{fn:function V(aa){var ab;var ac=aa.config.dataObj.prop_cm_name;var Z=aa.json.persistedObject;ab={fileName:ac,nodeRef:Z,path:this.currentPath+(this.currentPath!=="/"?"/":"")+ac};this.modules.actions.postActivity(this.options.siteId,"folder-added","documentlibrary",ab);YAHOO.Bubbling.fire("folderCreated",{name:ac,parentNodeRef:W});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-folder.success",ac)})},scope:this},onFailure:{fn:function R(Z){if(Z){var aa=Z.config.dataObj.prop_cm_name;Alfresco.util.PopupManager.displayMessage({text:this.msg("message.new-folder.failure",aa)})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")})}T.widgets.cancelButton.set("disabled",false)},scope:this}});T.show();return T},onSyncToCloud:function q(T,U){var Q=new Object();var R=this.doclistMetadata.parent;Q.displayName=R.properties["cm:name"];Q.nodeRef=R.nodeRef;var S=new Object();S.isContainer=R.isContainer;Q.jsNode=S;this.onActionCloudSync(Q)},onUnsyncFromCloud:function u(U,V){var Q=new Object();var S=this.doclistMetadata.parent;var T=new Object();T.isContainer=S.isContainer;Q.jsNode=T;var R=new Object();R.uri=S.nodeRef.replace(":/","");T.nodeRef=R;Q.displayName=S.properties["cm:name"];this.onActionCloudUnsync(Q)},onFileUpload:function r(S,T){if(this.fileUpload===null){this.fileUpload=Alfresco.getFileUploadInstance()}var Q={siteId:this.options.siteId,containerId:this.options.containerId,uploadDirectory:this.currentPath,filter:[],mode:this.fileUpload.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};this.fileUpload.show(Q);if(YAHOO.lang.isArray(T)&&T[1].tooltip){var R=Alfresco.util.createBalloon(this.fileUpload.uploader.id+"-dialog",{html:T[1].tooltip,width:"30em"});R.show();this.fileUpload.uploader.widgets.panel.hideEvent.subscribe(function(){R.hide()})}},onFileUploadWithTooltip:function N(Q,R){this.onFileUpload(Q,R)},onFileUploadComplete:function A(Q){var U=Q.successful.length,R,T;if(U>0){if(U<(this.options.groupActivitiesAt||5)){for(var S=0;S<U;S++){T=Q.successful[S];R={fileName:T.fileName,nodeRef:T.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-added","document-details",R)}}else{R={fileCount:U,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-added","documentlibrary",R)}}},onSelectedItems:function s(V,U,T){var R=U[0],S=U[1];if(this.modules.docList){var Q=Alfresco.util.findEventClass(S);if(Q&&(typeof this[Q]=="function")){this[Q].call(this,this.modules.docList.getSelectedFiles())}}C.preventDefault(R)},onActionDelete:function t(Q){var V=this,R=[];if(typeof Q.length==="undefined"){Q=[Q]}for(var U=0,S=Q.length;U<S;U++){R.push('<span class="'+(Q[U].jsNode.isContainer?"folder":"document")+'">'+B(Q[U].displayName)+"</span>")}var Y=this.msg("title.multiple-delete.confirm"),T=this.msg("message.multiple-delete.confirm",Q.length);T+='<div class="toolbar-file-list">'+R.join("")+"</div>";Alfresco.util.PopupManager.displayPrompt({title:Y,text:T,noEscape:true,modal:true,buttons:[{text:this.msg("button.delete"),handler:function X(){this.destroy();V._onActionDeleteConfirm.call(V,Q)}},{text:this.msg("button.cancel"),handler:function W(){this.destroy()},isDefault:true}]})},_onActionDeleteConfirm:function m(Q){var V=[],R,U;for(R=0,U=Q.length;R<U;R++){V.push(Q[R].jsNode.nodeRef.nodeRef)}var T=function S(ac,X){var W;var ab=0;var Z=0;if(!ac.json.overallSuccess){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.multiple-delete.failure")});return}this.modules.docList.totalRecords-=ac.json.totalResults;YAHOO.Bubbling.fire("filesDeleted");for(R=0,U=ac.json.totalResults;R<U;R++){W=ac.json.results[R];if(W.success){if(W.type=="folder"){Z++}else{ab++}YAHOO.Bubbling.fire(W.type=="folder"?"folderDeleted":"fileDeleted",{multiple:true,nodeRef:W.nodeRef})}}var aa=Z+ab;if(Alfresco.util.isValueSet(this.options.siteId)){var Y;if(aa>0){if(aa<this.options.groupActivitiesAt){for(R=0;R<aa;R++){Y={fileName:ac.json.results[R].id,nodeRef:ac.json.results[R].nodeRef,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};if(ac.json.results[R].type=="folder"){this.modules.actions.postActivity(this.options.siteId,"folder-deleted","documentlibrary",Y)}else{this.modules.actions.postActivity(this.options.siteId,"file-deleted","documentlibrary",Y)}}}else{if(ab>0){Y={fileCount:ab,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-deleted","documentlibrary",Y)}if(Z>0){Y={fileCount:Z,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"folders-deleted","documentlibrary",Y)}}}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.multiple-delete.success",aa)})};this.modules.actions.genericAction({success:{callback:{fn:T,scope:this,obj:Q}},failure:{message:this.msg("message.multiple-delete.failure")},webscript:{method:Alfresco.util.Ajax.DELETE,name:"files"},wait:{message:this.msg("message.multiple-delete.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:V}}})},onActionDeselectAll:function O(){if(this.modules.docList){this.modules.docList.selectFiles("selectNone")}},onHideNavBar:function P(Q,R){this.options.hideNavBar=!this.widgets.hideNavBar.get("checked");this.widgets.hideNavBar.set("title",this.msg(this.options.hideNavBar?"button.navbar.show":"button.navbar.hide"));E.setStyle(this.id+"-navBar","display",this.options.hideNavBar?"none":"block");this.services.preferences.set(G,this.options.hideNavBar);if(Q){C.preventDefault(Q)}},onFolderUp:function j(S,T){var R=this.currentPath.substring(0,this.currentPath.lastIndexOf("/")),Q=this.currentFilter;Q.filterData=R;YAHOO.Bubbling.fire("changeFilter",Q);C.preventDefault(S)},onFilterChanged:function H(U,V){this._handleSyncButtons();var S=V[1];if(S&&(typeof S.filterId!=="undefined")){S.filterOwner=S.filterOwner||Alfresco.util.FilterManager.getOwner(S.filterId);if(S.filterOwner){if(this.currentFilter.filterOwner!=S.filterOwner||this.currentFilter.filterId!=S.filterId){var Z=S.filterOwner.split(".")[1],Y=Z+"_"+S.filterId;var W=YAHOO.util.Selector.query("div.hideable",E.get(this.id)),Q;for(var T=0,R=W.length;T<R;T++){Q=W[T];if(E.hasClass(Q,Z)||E.hasClass(Q,Y)){E.removeClass(Q,"toolbar-hidden")}else{E.addClass(Q,"toolbar-hidden")}}}}Alfresco.logger.debug("DLTB_onFilterChanged","Old Filter",this.currentFilter);this.currentFilter=Alfresco.util.cleanBubblingObject(S);Alfresco.logger.debug("DLTB_onFilterChanged","New Filter",this.currentFilter);if(this.currentFilter.filterId=="path"||this.currentFilter.filterId=="category"){this.currentPath=w("/",this.currentFilter.filterData);this._generateBreadcrumb();var X=this.currentPath.split("/");if(this.currentPath==="/"){X=["/"]}if(this.widgets.folderUp){this.widgets.folderUp.set("disabled",X.length<2)}}else{this._generateDescription()}this._generateRSSFeedUrl()}},_handleSyncButtons:function h(){var Q=E.get(this.id+"-syncToCloud-button");var U=E.get(this.id+"-unsyncFromCloud-button");var S=this.doclistMetadata.parent;if(S){var T=S.aspects;if(T){if(Alfresco.util.arrayContains(T,"sync:syncSetMemberNode")){E.removeClass(U,"hidden");E.addClass(Q,"hidden")}else{E.removeClass(Q,"hidden");E.addClass(U,"hidden")}if(Alfresco.util.arrayContains(T,"smf:smartFolder")){E.addClass(U,"hidden");E.addClass(Q,"hidden")}}var R=S.properties;if(R&&(R["cm:name"]==="documentLibrary"||R["sync:directSync"]==="false")||this.options.syncMode!=="ON_PREMISE"){E.addClass(U,"hidden");E.addClass(Q,"hidden")}}},onDeactivateAllControls:function n(S,R){var Q,T=Alfresco.util.disableYUIButton;for(Q in this.widgets){if(this.widgets.hasOwnProperty(Q)){T(this.widgets[Q])}}},onDeactivateDynamicControls:function M(S,R){var Q,T=Alfresco.util.disableYUIButton;for(Q in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(Q)){T(this.dynamicControls[Q])}}},onUserAccess:function b(W,Y){var R=function Z(al,ab){var ak,ap,an,ac,ao,ag,aj=false,aa,ae,ai;if(al instanceof YAHOO.widget.MenuItem&&al.element.firstChild){aj=true;ak=al.element.firstChild.rel;aa=Alfresco.util.bind(al.cfg.setProperty,al.cfg,"className","");ae=Alfresco.util.bind(al.cfg.setProperty,al.cfg,"className","hidden")}else{ak=al.get("value");aa=Alfresco.util.bind(al.set,al,"disabled",false);ae=Alfresco.util.bind(al.set,al,"disabled",true)}aa();if(typeof ak=="string"&&ak!==""){ap=ak.split(",");for(var af=0,am=ap.length;af<am;af++){if(ap[af].indexOf("|")!==-1){ag=false;an=ap[af].split("|");for(var ad=0,ah=an.length;ad<ah;ad++){ac=an[ad].split(":");ao=ac[0];ai=ac.length==2?ac[1]=="true":true;if((ab[ao]&&ai)||(!ab[ao]&&!ai)){ag=true;if(!aj){al.set("activePermission",an[ad],true)}break}}if(!ag){ae();break}}else{ac=ap[af].split(":");ao=ac[0];ai=ac.length==2?ac[1]=="true":true;if((ab[ao]&&!ai)||(!ab[ao]&&ai)){ae();break}}}}};var T=Y[1];if(T&&T.userAccess){var U,X,Q;for(X in this.widgets){if(this.widgets.hasOwnProperty(X)){U=this.widgets[X];if(U&&U.get("srcelement").className!="no-access-check"&&(!(U._button!=null&&U._button.className=="no-access-check"))){R(U,T.userAccess);if(U.getMenu()!==null){Q=U.getMenu().getItems();for(var S=0,V=Q.length;S<V;S++){R(Q[S],T.userAccess)}}}}}}},onSelectedFilesChanged:function J(am,T){if(this.modules.docList){var X=this.modules.docList.getSelectedFiles(),S=[],aj,U,ak={},ai,Y,an=this.widgets.selectedItems==null?null:this.widgets.selectedItems.getMenu().getItems(),W,R,aa,ad,V,Z=[],al=[],af,ab,ae,ah;var ag=function ag(ao){return(ao.node.isContainer?"folder":"document")};for(af=0,ab=X.length;af<ab;af++){aj=X[af];ai=aj.node.permissions.user;for(Y in ai){if(ai.hasOwnProperty(Y)){ak[Y]=(ak[Y]===undefined?ai[Y]:ak[Y]&&ai[Y])}}U=ag(aj);if(!(U in S)){S[U]=true;S.push(U)}if(af===0){Z=Alfresco.util.deepCopy(aj.node.aspects)}else{for(ae=0,ah=Z.length;ae<ah;ae++){if(!Alfresco.util.arrayContains(aj.node.aspects,Z[ae])){Alfresco.util.arrayRemove(Z,Z[ae])}}}for(ae=0,ah=aj.node.aspects.length;ae<ah;ae++){if(!Alfresco.util.arrayContains(al,aj.node.aspects[ae])){al.push(aj.node.aspects[ae])}}}for(Y in an){if(an.hasOwnProperty(Y)){W=an[Y];V=false;if(W.element.firstChild){if(W.element.firstChild.rel&&W.element.firstChild.rel!==""){R=W.element.firstChild.rel.split(",");for(af=0,ab=R.length;af<ab;af++){if(!ak[R[af]]){V=true;break}}}var Q=E.getAttribute(W.element.firstChild,"data-has-aspects");if(Q&&Q!==""){Q=Q.split(",");for(af=0,ab=Q.length;af<ab;af++){if(!Alfresco.util.arrayContains(Z,Q[af])){V=true;break}}}var ac=E.getAttribute(W.element.firstChild,"data-not-aspects");if(ac&&ac!==""){ac=ac.split(",");for(af=0,ab=ac.length;af<ab;af++){if(Alfresco.util.arrayContains(al,ac[af])){V=true;break}}}if(!V){if(W.element.firstChild.type&&W.element.firstChild.type!==""){aa=W.element.firstChild.type.split("|");for(af=0;af<aa.length;af++){ad=Alfresco.util.arrayToObject(aa[af].split(","));for(ae=0,ah=S.length;ae<ah;ae++){if(!(S[ae] in ad)){aa.splice(af,1);--af;break}}}V=(aa.length===0)}}W.cfg.setProperty("disabled",V)}}}if(this.widgets.selectedItems!=null){this.widgets.selectedItems.set("disabled",(X.length===0))}}},onDoclistMetadata:function y(R,Q){var S=Q[1];this.folderDetailsUrl=null;if(S&&S.metadata){this.doclistMetadata=Alfresco.util.deepCopy(S.metadata);if(S.metadata.parent&&S.metadata.parent.nodeRef){this.folderDetailsUrl=v("folder-details?nodeRef="+S.metadata.parent.nodeRef)}}},onDropTargetOwnerRequest:function d(U,V){if(V&&V[1]&&V[1].elementId){var X=E.get(V[1].elementId);var Q=E.get(this.id+"-breadcrumb");if(E.isAncestor(Q,X)){var R="";var Y=this.currentPath.split("/");for(var T=0,S=Q.children.length;T<S;T++){if(T%2==0){R=R+"/"+Y[T/2]}if(X==Q.children[T]){break}}var W=this.doclistMetadata.container+R;V[1].callback.call(V[1].scope,W,R)}}},onDocumentDragOver:function c(T,S){if(S&&S[1]&&S[1].elementId){var R=E.get(S[1].elementId);var Q=E.get(this.id+"-breadcrumb");if(E.isAncestor(Q,R)){E.addClass(R,"documentDragOverHighlight");var V=E.getFirstChild(R);if(V!=null&&V.tagName!="SPAN"){var U=document.createElement("span");E.addClass(U,"documentDragOverArrow");E.insertBefore(U,V)}}}},onDocumentDragOut:function o(T,S){if(S&&S[1]&&S[1].elementId){var R=E.get(S[1].elementId);var Q=E.get(this.id+"-breadcrumb");if(E.isAncestor(Q,R)){E.removeClass(R,"documentDragOverHighlight");var U=E.getFirstChild(R);if(U!=null&&U.tagName=="SPAN"){R.removeChild(U)}}}},_generateBreadcrumb:function p(){var ae=E.get(this.id+"-breadcrumb");if(ae===null){return}ae.innerHTML="";var af=this.currentPath.split("/");if(this.currentPath==="/"){af=["/"]}var ak=this,Z=af.concat();Z[0]=Alfresco.util.message("node.root",this.currentFilter.filterOwner);var aa=function Y(am,al){E.addClass(am.target.parentNode,"highlighted");C.stopEvent(am)};var T=function V(an,am){var al=ak.currentFilter;al.filterData=am;YAHOO.Bubbling.fire("changeFilter",al);C.stopEvent(an)};var Q=new g(ae),R,ac,ad,W,U=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListTree"),aj;if(U&&U.selectedNode){aj=U.selectedNode}var S=function X(an){if(!aj){return}var al=aj;if(an){for(var am=an;am>1;am--){if(al.parent){al=al.parent}}}return al.customCls};for(var ai=0,ag=af.length;ai<ag;++ai){R=af.slice(0,ai+1).join("/");ac=new g(document.createElement("div"));ac.addClass("crumb");ac.addClass("documentDroppable");ac.addClass("documentDroppableHighlights");if(ai>0){ad=new g(document.createElement("a"),{href:"#",innerHTML:"&nbsp;"});ad.on("click",T,R);ad.addClass("icon");ad.addClass("filter-"+B(this.currentFilter.filterId));ad.addClass(S(ag-ai));ac.appendChild(ad)}if(ag-ai<2){W=new g(document.createElement("span"),{innerHTML:(this.folderDetailsUrl)?'<a href="'+this.folderDetailsUrl+'">'+B(Z[ai])+"</a>":B(Z[ai])});W.addClass("label");ac.appendChild(W);Q.appendChild(ac)}else{W=new g(document.createElement("a"),{href:"",innerHTML:B(Z[ai])});W.addClass("folder");W.on("click",T,R);ac.appendChild(W);Q.appendChild(ac);Q.appendChild(new g(document.createElement("div"),{innerHTML:"&gt;",className:"separator"}))}}var ab=E.get(this.id+"-breadcrumb");var ah=E.getElementsByClassName("crumb","div",ab);for(var ai=0,ag=ah.length;ai<ag;ai++){new YAHOO.util.DDTarget(ah[ai])}},_generateDescription:function f(){var S,V,R,Q,T;S=E.get(this.id+"-description");if(S===null){return}while(S.hasChildNodes()){S.removeChild(S.lastChild)}T=typeof this.currentFilter.filterDisplay!=="undefined"?this.currentFilter.filterDisplay:(this.currentFilter.filterData||"");R=new g(document.createElement("div"),{innerHTML:this.msg("description."+this.currentFilter.filterId,T)});R.addClass("message");var W="description."+this.currentFilter.filterId+".more",U=W+".filterDisplay";if(T!==""&&this.msg(U)!==U){W=U}Q=new g(document.createElement("span"),{innerHTML:this.msg(W,B(T))});Q.addClass("more");R.appendChild(Q);V=new g(S);V.appendChild(R)},_getRssFeedUrl:function l(){var Q=YAHOO.lang.substitute("{type}/site/{site}/{container}"+(this.currentFilter.filterId==="path"?(this.currentPath!=="/"?"{path}":""):""),{type:this.modules.docList.options.showFolders?"all":"documents",site:encodeURIComponent(this.options.siteId),container:encodeURIComponent(this.options.containerId),path:Alfresco.util.encodeURIPath(this.currentPath)});Q+="?filter="+encodeURIComponent(this.currentFilter.filterId);if(this.currentFilter.filterData){Q+="&filterData="+encodeURIComponent(this.currentFilter.filterData)}Q+="&format=rss";return Alfresco.constants.URL_FEEDSERVICECONTEXT+"components/documentlibrary/feed/"+Q},_generateRSSFeedUrl:function k(){if(this.widgets.rssFeed&&this.modules.docList){var Q=this._getRssFeedUrl();this.widgets.rssFeed.set("href",Q);Alfresco.util.enableYUIButton(this.widgets.rssFeed)}},isVirtualFolder:function i(){var R=Alfresco.util.findValueByDotNotation(this,"doclistMetadata.parent.aspects"),Q=Alfresco.util.arrayContains(R,"smf:smartFolder");return Q}},true)})();