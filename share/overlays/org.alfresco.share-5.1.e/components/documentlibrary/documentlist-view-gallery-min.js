(function(){var K=YAHOO.util.Dom,I=YAHOO.util.Event,v=YAHOO.util.Anim;var F=Alfresco.util.encodeHTML;var Z="org.alfresco.share.documentList",r=Z+".galleryColumns",w="ygddfdiv";var t=7,H="397px",p=[-40,-20],m=700,M=20,x=100,P=false,N=true;Alfresco.DocumentListGalleryViewRenderer=function(af,ah,ai,ag){Alfresco.DocumentListGalleryViewRenderer.superclass.constructor.call(this,af,ah,ai);this.parentElementIdSuffix="-gallery";this.parentElementEmptytIdSuffix="-gallery-empty";this.rowClassName="alf-gallery-item";this.infoPanelClassName="alf-detail";this.metadataBannerViewName="detailed";this.metadataLineViewName="detailed";this.galleryColumns=ag;this.infoPanelPopupTimeout=m;this.windowResizeCheckTime=M;this.windowResizeMinTime=x;this.documentList=null;return this};YAHOO.extend(Alfresco.DocumentListGalleryViewRenderer,Alfresco.DocumentListViewRenderer);Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemId=function e(af){if(this.documentList!=null&&af!=null){return this.documentList.id+"-gallery-item-"+af.getId()}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItem=function k(ah,aj){if(this.documentList!=null&&ah!=null){var ai=this.getRowItemId(ah);var ak=document.getElementById(ai);if(ak===null&&aj!=null){var ag=K.getAncestorByTagName(aj,"tr");var af=this.documentList.id+"-gallery-item-"+ag.id;ak=document.getElementById(af);if(ak!==null){ak.setAttribute("id",ai)}}return ak}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemSelectId=function j(af){if(af!=null){return"checkbox-"+af.getId()+"-gallery-item"}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemDetailElement=function ac(ag){if(ag!=null){var af=K.getChildren(ag)[1];if(K.hasClass(af,"yui-panel-container")){af=K.getFirstChild(af)}return af}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemDetailDescriptionElement=function f(af){if(af!=null){var ag=this.getRowItemDetailElement(af);return K.getChildren(K.getFirstChild(ag))[3]}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemDetailThumbnailElement=function a(af){if(af!=null){var ag=this.getRowItemDetailElement(af);return K.getFirstChild(K.getFirstChild(ag))}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemThumbnailElement=function s(af){if(af!=null){return K.getFirstChild(af)}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemHeaderElement=function T(ag){if(ag!=null){var af=this.getRowItemThumbnailElement(ag);return K.getFirstChild(af)}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemSelectElement=function V(ag){if(ag!=null){var af=this.getRowItemHeaderElement(ag);return K.getFirstChild(af)}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemLabelElement=function B(ag){if(ag!=null){var af=this.getRowItemThumbnailElement(ag);return K.getChildren(af)[1]}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemStatusElement=function S(af){if(af!=null){var ag=this.getRowItemDetailElement(af);return K.getChildren(K.getFirstChild(ag))[1]}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowItemActionsElement=function ad(af){if(af!=null){var ag=this.getRowItemDetailElement(af);return K.getChildren(K.getFirstChild(ag))[2]}};Alfresco.DocumentListGalleryViewRenderer.prototype.getDataTableRecordIdFromRowElement=function J(ag,ah){var af=Alfresco.DocumentListGalleryViewRenderer.superclass.getDataTableRecordIdFromRowElement.call(this,ag,ah);if(af!=null){return af.replace(ag.id+"-gallery-item-","")}};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowElementFromDataTableRecord=function ab(af,ag){var ah=this.getRowItemId(ag);return document.getElementById(ah)};Alfresco.DocumentListGalleryViewRenderer.prototype.getRowSelectElementFromDataTableRecord=function R(ag,ah){var af=this.getRowItemSelectId(ah);return K.get(af)};Alfresco.DocumentListGalleryViewRenderer.prototype.setupItemHovers=function n(ag){var af=K.get(ag.id+this.parentElementIdSuffix);I.delegate(af,"mouseover",Alfresco.DocumentListGalleryViewRenderer.onMouseOverItem,"div."+this.rowClassName,this);I.delegate(af,"mouseout",Alfresco.DocumentListGalleryViewRenderer.onMouseOutItem,"div."+this.rowClassName,this)};Alfresco.DocumentListGalleryViewRenderer.prototype.destroyItemHovers=function U(ag){var af=K.get(ag.id+this.parentElementIdSuffix);I.removeDelegate(af,"mouseover",Alfresco.DocumentListGalleryViewRenderer.onMouseOverItem);I.removeDelegate(af,"mouseout",Alfresco.DocumentListGalleryViewRenderer.onMouseOutItem)};Alfresco.DocumentListGalleryViewRenderer.prototype.setupRenderer=function O(aj){Alfresco.DocumentListGalleryViewRenderer.superclass.setupRenderer.call(this,aj);this.documentList=aj;var ah=K.get(aj.id+this.parentElementIdSuffix);this.galleryColumnsChangedEvent=new YAHOO.util.CustomEvent("galleryViewColumnsChangedCE");YAHOO.Bubbling.subscribe("galleryViewColumnsChanged",function(al,ak){this.galleryColumnsChangedEvent.fire()},this);this.setupItemHovers(aj);var ai=this;I.delegate(ah,"click",function ag(am,al,ak){ai.onShowGalleryItemDetail(aj,ai,am,al,ak)},".alf-show-detail",this);I.delegate(ah,"click",function af(am,al,ak){var an=I.getTarget(am);aj.selectedFiles[an.value]=an.checked;YAHOO.Bubbling.fire("selectedFilesChanged")},".alf-select input",this);YAHOO.Bubbling.on("selectedFilesChanged",function(al,ak){this.onSelectedFilesChanged(aj)},this);this.galleryColumns=Alfresco.util.findValueByDotNotation(aj.services.preferences.get(),r);if(!this.galleryColumns){this.galleryColumns=t}this.setupGalleryColumnsSlider(aj,this)};Alfresco.DocumentListGalleryViewRenderer.prototype.overrideDataTable=function y(ah){var ag=this;if(ah.widgets.dataTable){if(ah.widgets.dataTable.getRecord!=ah.widgets.dataTable.getHiddenRecord){ah.widgets.dataTable.getVisibleRecord=ah.widgets.dataTable.getRecord;ah.widgets.dataTable.getHiddenRecord=function ai(ak){var aj=ah.widgets.dataTable.getVisibleRecord(ak);if(aj==null){if(typeof ak==="string"){aj=ah.widgets.dataTable.getVisibleRecord(ak+"-hidden")}else{if(ak){aj=ah.widgets.dataTable.getVisibleRecord(ak.id+"-hidden")}}}return aj};ah.widgets.dataTable.getRecord=ah.widgets.dataTable.getHiddenRecord}if(ah.widgets.dataTable.getContainerEl!=ah.widgets.dataTable.getGalleryContainerEl){ah.widgets.dataTable.origGetContainerEl=ah.widgets.dataTable.getContainerEl;ah.widgets.dataTable.getGalleryContainerEl=function af(){return K.get(ah.id+ag.parentElementIdSuffix)};ah.widgets.dataTable.getContainerEl=ah.widgets.dataTable.getGalleryContainerEl}}};Alfresco.DocumentListGalleryViewRenderer.prototype.restoreDataTable=function q(af){if(af.widgets.dataTable.getContainerEl==af.widgets.dataTable.getGalleryContainerEl){af.widgets.dataTable.getContainerEl=af.widgets.dataTable.origGetContainerEl}};Alfresco.DocumentListGalleryViewRenderer.prototype.renderView=function aa(ah,al,ao,aj){this.overrideDataTable(ah);var an=this;ah.widgets.dataTable.onDataReturnInitializeTable.call(ah.widgets.dataTable,al,ao,aj);var aq=K.get(ah.id+this.parentElementIdSuffix);var ag=ah.widgets.dataTable.getRecordSet();if(ag.getLength()==0){var af=K.get(ah.id+this.parentElementEmptytIdSuffix);aq.innerHTML=af.innerHTML;K.getFirstChild(af).innerHTML="";ah.widgets.dataTable.fireEvent("tableMsgShowEvent",{html:aq.innerHTML});K.removeClass(aq,"alf-gallery");K.removeClass(aq,"hidden");K.setStyle(aq,"height","auto");return}aq.innerHTML="";K.setStyle(aq,"opacity",0);K.addClass(aq,"alf-gallery");K.removeClass(aq,"hidden");var ar=K.get(ah.id+"-gallery-item-template"),au=null;var aA,ak,az,ax;for(az=0,ax=ag.getLength();az<ax;az++){aA=ag.getRecord(az);ak=aA.getData();var ap=this.getRowItemId(aA);au=ar.cloneNode(true);K.removeClass(au,"hidden");au.setAttribute("id",ap);aq.appendChild(au);var ai=this.getRowItemThumbnailElement(au);var aw=this.getRowItemHeaderElement(au);var am=this.getRowItemDetailElement(au);var ay=this.getRowItemActionsElement(au);aw.setAttribute("id",ah.id+"-item-header-"+aA.getId());ay.setAttribute("id",ah.id+"-actions-"+ap);this.renderCellThumbnail(ah,ai,aA,au,null,"");var av=ak.jsNode.nodeRef.nodeRef;var at=new Alfresco.DnD(av,ah);am.panel=new YAHOO.widget.Panel(am,{visible:false,draggable:false,close:false,constraintoviewport:true,underlay:"none",width:H,context:[au,"tl","tl",[this.galleryColumnsChangedEvent],p]})}ah.widgets.galleryColumnsSlider.initialize();this.currentResizeCallback=function(aB){an.resizeView(ah,al,ao,aj)};this.setupWindowResizeListener()};Alfresco.DocumentListGalleryViewRenderer.prototype.destroyView=function Y(aj,ah,ai,ak){this.restoreDataTable(aj);K.get(aj.id+this.parentElementIdSuffix).innerHTML="";K.addClass(K.get(aj.id+this.parentElementIdSuffix),"hidden");K.addClass(K.get(aj.id+"-gallery-slider"),"hidden");var af=K.get(w);columnOptions=[3,4,7,10];for(var ag=0;ag<columnOptions.length;ag++){K.removeClass(af,"alf-gallery-columns-"+columnOptions[ag])}if(this.windowResizeCallback){I.removeListener(window,"resize",this.windowResizeCallback)}};Alfresco.DocumentListGalleryViewRenderer.onSelectModeImgClicked=function Q(aj,ah,ag,ai){var al=K.getAncestorByClassName(ah,ai.rowClassName);var af=K.getElementsByClassName("alf-select","div",al)[0];var ak=K.getFirstChild(af);ak.checked=!ak.checked;ai.documentList.selectedFiles[ak.value]=ak.checked;YAHOO.Bubbling.fire("selectedFilesChanged")};Alfresco.DocumentListGalleryViewRenderer.onMouseOverItem=function ae(ai,ah,af,ag){K.addClass(ah,"alf-hover");ag.onEventHighlightRow(ag.documentList,ai,ah)};Alfresco.DocumentListGalleryViewRenderer.onMouseOutItem=function b(ai,ah,af,ag){K.removeClass(ah,"alf-hover")};Alfresco.DocumentListGalleryViewRenderer.prototype.onActionShowMore=function h(ah,ag,af){Alfresco.DocumentListGalleryViewRenderer.superclass.onActionShowMore.call(this,ah,ag,af);var aj=function ai(){if(ah.hideMoreActionsFn){ah.hideMoreActionsFn.call(this)}};var ak=K.getNextSibling(af);I.on(ak,"mouseleave",aj,ak)};Alfresco.DocumentListGalleryViewRenderer.prototype.onSelectedFilesChanged=function c(ao){var am=ao.widgets.dataTable.getRecordSet(),ap,ak,ag,an,al,aj,ai;var ah=false;for(aj=0,ai=am.getLength();aj<ai;aj++){ap=am.getRecord(aj);ag=ap.getData("jsNode");an=ag.nodeRef;al=this.getRowElementFromDataTableRecord(ao,ap);isChecked=ao.selectedFiles[an];if(isChecked){K.addClass(al,"alf-selected");ah=true}else{K.removeClass(al,"alf-selected")}}var af=K.get(ao.id+this.parentElementIdSuffix);if(ah){if(!K.hasClass(af,"alf-selected")){K.addClass(af,"alf-selected")}}else{K.removeClass(af,"alf-selected")}};Alfresco.DocumentListGalleryViewRenderer.prototype.renderCellSelected=function A(aq,ao,ar,aj,ag){var al=this.getRowItem(ar,ao);if(al!=null){var ak=this.getRowItemSelectElement(al);var ah=ar.getData("jsNode"),an=ah.nodeRef,af=ar.getData("displayName"),ai=document.createElement("input"),am=document.createElement("label");var ap=this.getRowItemSelectId(ar);ai.id=ap;ai.type="checkbox";ai.name="fileChecked";ai.value=an;ai.checked=aq.selectedFiles[an]?true:false;am.id="label_for_"+ai.id;am.style.fontSize="0em";am.innerHTML=(ai.checked?aq.msg("checkbox.uncheck"):aq.msg("checkbox.check"))+" "+af;am.setAttribute("for",ai.id);ak.innerHTML="";ak.appendChild(am);ak.appendChild(ai);YAHOO.Bubbling.on("selectedFilesChanged",function(at){if(K.get(am.id)){K.get(am.id).innerHTML=(aq.selectedFiles[an]?aq.msg("checkbox.uncheck"):aq.msg("checkbox.check"))+" "+af}})}};Alfresco.DocumentListGalleryViewRenderer.prototype.getThumbnail=function u(au,at,av,ap,ai,ak,ao){if(ak==null){ak="-hidden"}if(ao==null){ao="imgpreview"}var an=av.getData(),al=an.jsNode,ar=al.properties,ag=an.displayName,ah=al.isContainer,am=al.isLink,aq=ag.substring(ag.lastIndexOf(".")),af=al.nodeRef.nodeRef+ak,aj;if(ah){aj='<img id="'+af+'" class="alf-gallery-item-thumbnail-img" src="'+this.getFolderIcon(an.node)+'" />'}else{aj='<img id="'+af+'" class="alf-gallery-item-thumbnail-img" src="'+Alfresco.DocumentList.generateThumbnailUrl(an,ao)+'" alt="'+F(aq)+'" title="'+F(ag)+'" />'}return{id:af,html:aj,isContainer:ah,isLink:am}};Alfresco.DocumentListGalleryViewRenderer.prototype.getDefaultFolderIcon=function z(){return"components/documentlibrary/images/folder-256.png"};Alfresco.DocumentListGalleryViewRenderer.prototype.getIconSize=function l(){return"256x256"};Alfresco.DocumentListGalleryViewRenderer.prototype.renderCellThumbnail=function i(ap,ao,aq,ak,ag,ah,aj){var am;var af=this.getThumbnail(ap,ao,aq,ak,ag,ah,aj);var ai=aq.getData();if(!document.getElementById(af.id)){if(af.isContainer){ao.innerHTML+='<span class="folder">'+(af.isLink?'<span class="link"></span>':"")+(ap.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(ap,ai)+af.html+"</a>";am=new YAHOO.util.DDTarget(af.id)}else{ao.innerHTML+=(af.isLink?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(ap,ai)+af.html+"</a>"}var al=document.getElementById(af.id);if(al){var an=new Image();an.onload=function(){if(an.width>an.height){K.addClass(al,"alf-landscape")}};an.src=al.src}}};Alfresco.DocumentListGalleryViewRenderer.prototype.renderCellStatus=function X(af,ai,ah,aj,al){Alfresco.DocumentListGalleryViewRenderer.superclass.renderCellStatus.call(this,af,ai,ah,aj,al);var ak=this.getRowItem(ah,ai);if(ak!=null){var ag=this.getRowItemStatusElement(ak).innerHTML=ai.innerHTML;ai.innerHTML=""}};Alfresco.DocumentListGalleryViewRenderer.prototype.renderCellDescription=function L(am,al,an,aj,ag){Alfresco.DocumentListGalleryViewRenderer.superclass.renderCellDescription.call(this,am,al,an,aj,ag);var ak=this.getRowItem(an,al);if(ak!=null){var ah=this.getRowItemDetailDescriptionElement(ak).innerHTML=al.innerHTML;al.innerHTML="";this.getRowItemLabelElement(ak).innerHTML=Alfresco.DocumentList.generateFileFolderLinkMarkup(am,an.getData())+F(an.getData().displayName)+"</a>";var ai=this.getRowItemDetailThumbnailElement(ak);if(ai.innerHTML==""){var af=this.getThumbnail(am,al,an,aj,ag,"-detail");this.getRowItemDetailThumbnailElement(ak).innerHTML=af.html}}};Alfresco.DocumentListGalleryViewRenderer.prototype.onFileRenamed=function G(ah,ag,af){var ak=af[1];if(ak&&(ak.file!==null)){var ai=ah._findRecordByParameter(ak.file.node.nodeRef,"nodeRef");if(ai!==null){ah.widgets.dataTable.updateRow(ai,ak.file);var aj=this.getRowItemId(ai);Alfresco.util.Anim.pulse(aj)}}};Alfresco.DocumentListGalleryViewRenderer.prototype.resizeView=function E(aj,ah,ai,ak){var af=K.get(aj.id+this.parentElementIdSuffix);var ag=aj.widgets.galleryColumnsSlider.getColumnValue();aj.widgets.galleryColumnsSlider.setGalleryViewColumns(af,ag,P)};Alfresco.DocumentListGalleryViewRenderer.prototype.checkWindowResizeTime=function d(){var af=this;var ag=Date.now();if(ag-this.lastResize<af.windowResizeMinTime){this.resizeTimer=setTimeout(function(){af.checkWindowResizeTime()},af.windowResizeCheckTime)}else{clearTimeout(this.resizeTimer);this.resizeTimer=this.lastResize=0;if(this.currentViewportWidth!=K.getViewportWidth()){this.currentResizeCallback();this.currentViewportWidth=K.getViewportWidth()}}};Alfresco.DocumentListGalleryViewRenderer.prototype.onWindowResize=function C(){var af=this;this.lastResize=Date.now();this.resizeTimer=this.resizeTimer||setTimeout(function(){af.checkWindowResizeTime()},af.windowResizeCheckTime)};Alfresco.DocumentListGalleryViewRenderer.prototype.setupWindowResizeListener=function g(){var af=(navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?true:false);if(!af){var ag=this;this.currentViewportWidth=K.getViewportWidth();if(ag.windowResizeCallback){I.removeListener(window,"resize",ag.windowResizeCallback)}ag.windowResizeCallback=function(ah){ag.onWindowResize()};I.addListener(window,"resize",ag.windowResizeCallback)}};Alfresco.DocumentListGalleryViewRenderer.prototype._setEmptyDataSourceMessage=function W(ah,af){var ag=K.get(ah.id+this.parentElementEmptytIdSuffix);K.getFirstChild(ag).innerHTML=af};YAHOO.lang.augmentObject(Alfresco.DocumentListGalleryViewRenderer.prototype,{setupGalleryColumnsSlider:function o(ai,ak){var ag=K.get(ai.id+this.parentElementIdSuffix);ai.widgets.galleryColumnsSlider=YAHOO.widget.Slider.getHorizSlider(ai.id+"-gallery-slider-bg",ai.id+"-gallery-slider-thumb",0,60,20);ai.widgets.galleryColumnsSlider.animate=true;ai.widgets.galleryColumnsSlider.subscribe("change",function(am){var al=ai.widgets.galleryColumnsSlider.getColumnValue();ai.widgets.galleryColumnsSlider.setGalleryViewColumns(ag,al,true);ai.widgets.galleryColumnsSlider.setColumnsPreference(al)});ai.widgets.galleryColumnsSlider.initialize=function(){K.removeClass(K.get(ai.id+"-gallery-slider"),"hidden");var al=ai.widgets.galleryColumnsSlider.getPixelValue(ak.galleryColumns);ai.widgets.galleryColumnsSlider.setValue(al,true,true,true);ai.widgets.galleryColumnsSlider.setGalleryItemDimensions(ag,ak.galleryColumns,true)};ai.widgets.galleryColumnsSlider.getColumnValue=function(){switch(ai.widgets.galleryColumnsSlider.getValue()){case 0:return 10;case 20:return 7;case 40:return 4;case 60:return 3}};ai.widgets.galleryColumnsSlider.getPixelValue=function(al){switch(al){case 10:return 0;case 7:return 20;case 4:return 40;case 3:return 60}};ai.widgets.galleryColumnsSlider.setGalleryItemDimensions=function aj(am,ap,ao){if(ap==null){ap=ai.widgets.galleryColumnsSlider.getColumnValue()}var aw=ai.widgets.dataTable.getRecordSet().getLength();var au=Math.ceil(aw/ap);var at=parseInt(K.getComputedStyle(am,"width"));var ar=Math.floor(at/ap)*0.92;var av=ar*au*1.13;K.setStyle(am,"opacity",0);K.setStyle(am,"height",av+"px");var an=K.get(w);columnOptions=[3,4,7,10];for(var aq=0;aq<columnOptions.length;aq++){K.removeClass(am,"alf-gallery-columns-"+columnOptions[aq]);K.removeClass(an,"alf-gallery-columns-"+columnOptions[aq])}K.addClass(am,"alf-gallery-columns-"+ap);K.addClass(an,"alf-gallery-columns-"+ap);var al=K.getChildren(am);K.batch(al,function(ax){K.setStyle(ax,"height",ar+"px")});if(ao){if(!ai.widgets.galleryColumnsSlider.fadeInAnimation){ai.widgets.galleryColumnsSlider.fadeInAnimation=new YAHOO.util.Anim(am,{opacity:{from:0,to:1}},0.4,YAHOO.util.Easing.easeOut)}ai.widgets.galleryColumnsSlider.fadeInAnimation.animate()}else{K.setStyle(am,"opacity",1)}};ai.widgets.galleryColumnsSlider.setGalleryViewColumns=function af(al,an,am){ai.widgets.galleryColumnsSlider.setGalleryItemDimensions(al,an,am);YAHOO.Bubbling.fire("galleryViewColumnsChanged")};ai.widgets.galleryColumnsSlider.setColumnsPreference=function ah(al){if(al==null){al=ai.widgets.galleryColumnsSlider.getColumnValue()}ak.galleryColumns=al;ai.services.preferences.set(r,al)}},onShowGalleryItemDetail:function D(au,at,ah,aq,ai){var ap=K.getAncestorByClassName(aq,at.rowClassName);var ar=K.getElementsByClassName(at.infoPanelClassName,null,ap)[0];K.setStyle(ar,"display","");var af=ar.panel.cfg.getProperty("zIndex"),aj=3;ar.panel.cfg.setProperty("zIndex",aj);ar.panel.render();ar.panel.show(ar.panel);var ak=function ag(){at.onEventUnhighlightRow(au,ah,ap);ar.panel.hide(ar.panel);K.setStyle(ar,"display","none");ar.panel.cfg.setProperty("zIndex",af)};if(ar.hideTimerId){window.clearTimeout(ar.hideTimerId)}ar.hideTimerId=window.setTimeout(ak,at.infoPanelPopupTimeout*4);var am=function al(aw,av){if(av.hideTimerId){window.clearTimeout(av.hideTimerId);av.hideTimerId=null}};var ao=function an(ax,aw){var ay=I.getTarget(ax);var av=ay.relatedTarget;if((av!==aw)&&(!K.isAncestor(aw,av))){if(aw.hideTimerId){window.clearTimeout(aw.hideTimerId)}aw.hideTimerId=window.setTimeout(ak,at.infoPanelPopupTimeout/100)}};I.on(ar,"mouseover",am,ar);I.on(ar,"mouseout",ao,ar)}})})();