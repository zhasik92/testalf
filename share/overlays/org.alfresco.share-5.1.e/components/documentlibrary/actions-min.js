(function(){var U=YAHOO.util.Dom,S=YAHOO.util.Event;var Q=Alfresco.util.encodeHTML,K=Alfresco.util.combinePaths,J=Alfresco.util.siteURL,Y=Alfresco.util.isValueSet;var k;Alfresco.doclib.Actions={};Alfresco.doclib.Actions.prototype={actionsView:null,onRegisterAction:function C(ai,ah){var aj=ah[1];if(aj&&Y(aj.actionName)&&Y(aj.fn)){this.registerAction(aj.actionName,aj.fn)}else{Alfresco.logger.error("DL_onRegisterAction: Custom action registion invalid: "+aj)}},registerAction:function d(ah,ai){if(Y(ah)&&Y(ai)){this.constructor.prototype[ah]=ai;return true}return false},renderAction:function X(ai,al){var ah=Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/actions/",an='style="background-image:url('+ah+'{icon}-16.png)" ',ak={link:'<div class="{id}{additionalCssClasses}"><a title="{label}" class="simple-link" href="{href}" '+an+"{target}><span>{label}</span></a></div>",pagelink:'<div class="{id}{additionalCssClasses}"><a title="{label}" class="simple-link" href="{pageUrl}" '+an+"><span>{label}</span></a></div>",javascript:'<div class="{id}{additionalCssClasses}" id="{jsfunction}"><a title="{label}" class="action-link" href="#"'+an+"><span>{label}</span></a></div>"};al.actionParams[ai.id]=ai.params;var aj={id:ai.id,icon:ai.icon,label:Q(Alfresco.util.substituteDotNotation(this.msg(ai.label),al)),additionalCssClasses:ai.additionalCssClasses?" "+ai.additionalCssClasses:""};if(ai.lastActionInSubgroup){aj.additionalCssClasses=" alf-action-group-end"}if(ai.type==="link"){if(ai.params.href){aj.href=Alfresco.util.substituteDotNotation(ai.params.href,al);aj.target=ai.params.target?'target="'+ai.params.target+'"':""}else{Alfresco.logger.warn("Action configuration error: Missing 'href' parameter for actionId: ",ai.id)}}else{if(ai.type==="pagelink"){if(ai.params.page){aj.pageUrl=Alfresco.util.substituteDotNotation(ai.params.page,al);if(ai.params.page.charAt(0)!=="{"){var am=Y(al.location.site)?al.location.site.name:null;aj.pageUrl=J(aj.pageUrl,{site:am})}}else{Alfresco.logger.warn("Action configuration error: Missing 'page' parameter for actionId: ",ai.id)}}else{if(ai.type==="javascript"){if(ai.params["function"]){aj.jsfunction=ai.params["function"]}else{Alfresco.logger.warn("Action configuration error: Missing 'function' parameter for actionId: ",ai.id)}}}}return YAHOO.lang.substitute(ak[ai.type],aj)},getActionUrls:function v(an,ai){var ak=an.jsNode,aq=ak.isLink?ak.linkedNode.nodeRef:ak.nodeRef,aq=ak.isLink&&!Y(aq)?"invalidlink":aq,ao=aq.toString(),ah=aq.uri,am=ak.contentURL,ar=an.workingCopy||{},aj=Y(an.location.site)?an.location.site.name:null,ap=Alfresco.util.bind(function(at){return Alfresco.util.siteURL(at,{site:YAHOO.lang.isString(ai)?ai:aj})},this),al={downloadUrl:K(Alfresco.constants.PROXY_URI,am)+"?a=true",viewUrl:K(Alfresco.constants.PROXY_URI,am)+'" target="_blank',documentDetailsUrl:ap("document-details?nodeRef="+ao),folderDetailsUrl:ap("folder-details?nodeRef="+ao),editMetadataUrl:ap("edit-metadata?nodeRef="+ao),inlineEditUrl:ap("inline-edit?nodeRef="+ao),managePermissionsUrl:ap("manage-permissions?nodeRef="+ao),manageTranslationsUrl:ap("manage-translations?nodeRef="+ao),workingCopyUrl:ap("document-details?nodeRef="+(ar.workingCopyNodeRef||ao)),workingCopySourceUrl:ap("document-details?nodeRef="+(ar.sourceNodeRef||ao)),cloudViewUrl:K(Alfresco.constants.URL_SERVICECONTEXT,"cloud/cloudUrl?nodeRef="+ao)};al.sourceRepositoryUrl=this.viewInSourceRepositoryURL(an,al)+'" target="_blank';return al},getAction:function ag(ai,ah,am){var ao=ah.className.match(/([^\s])*/)[0];var al=Alfresco.util.findInArray(ai.actions,ao,"id")||{};if(am===false){return al}else{al=Alfresco.util.deepCopy(al);var an=al.params||{};for(var aj in an){an[aj]=YAHOO.lang.substitute(an[aj],ai,function ak(aq,ar,ap){return Alfresco.util.findValueByDotNotation(ai,aq)})}return al}},getParentNodeRef:function af(ai){var al=null;if(YAHOO.lang.isArray(ai)){try{al=this.doclistMetadata.parent.nodeRef}catch(am){al=null}if(al===null){for(var ak=1,aj=ai.length,ah=true;ak<aj&&ah;ak++){ah=(ai[ak].parent.nodeRef==ai[ak-1].parent.nodeRef)}al=ah?ai[0].parent.nodeRef:this.doclistMetadata.container}}else{al=ai.parent.nodeRef}return al},onActionDetails:function L(ak){var aq=this,am=ak.nodeRef,aj=ak.jsNode;var ao=function ah(at,au){var ar='<span class="light">'+Q(ak.displayName)+"</span>";Alfresco.util.populateHTML([au.id+"-dialogTitle",aq.msg("edit-details.title",ar)]);this.widgets.editMetadata=Alfresco.util.createYUIButton(au,"editMetadata",null,{type:"link",label:aq.msg("edit-details.label.edit-metadata"),href:J("edit-metadata?nodeRef="+am)})};var ai=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"node",itemId:am,mode:"edit",submitType:"json",formId:"doclib-simple-metadata"});var ap=new Alfresco.module.SimpleDialog(this.id+"-editDetails-"+Alfresco.util.generateDomId());ap.setOptions({width:"auto",zIndex:1001,templateUrl:ai,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:ao,scope:this},onSuccess:{fn:function al(at){var av="components/documentlibrary/data";if(Y(this.options.siteId)){av+="/site/"+encodeURIComponent(this.options.siteId)}Alfresco.util.Ajax.request({url:K(Alfresco.constants.URL_SERVICECONTEXT,av,"/node/",aj.nodeRef.uri)+"?view="+this.actionsView,successCallback:{fn:function au(ax){var aw=ax.json.item;aw.jsNode=new Alfresco.util.Node(ax.json.item.node);YAHOO.Bubbling.fire(aw.node.isContainer?"folderRenamed":"fileRenamed",{file:aw});YAHOO.Bubbling.fire("tagRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")});this._updateDocList.call(this)},scope:this},failureCallback:{fn:function ar(aw){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function an(ar){var at=this.msg("message.details.failure");if(ar.json&&ar.json.message.indexOf("Failed to persist field 'prop_cm_name'")!==-1){at=this.msg("message.details.failure.name")}Alfresco.util.PopupManager.displayMessage({text:at})},scope:this}}).show()},onActionLocate:function ad(ah){var aj=ah.jsNode,al=ah.location.path,ai,ak=Y(ah.location.site)?ah.location.site.name:null;if(aj.isLink){ai=Y(aj.linkedNode.properties)?aj.linkedNode.properties.name:null;if(ai===null){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.actions.failure.locate")})}}else{ai=ah.displayName}if(Y(this.options.siteId)&&ak!==this.options.siteId){window.location=J((ak===null?"repository":"documentlibrary")+"?file="+encodeURIComponent(ai)+"&path="+encodeURIComponent(al),{site:ak})}else{this.options.highlightFile=ai;YAHOO.Bubbling.fire("changeFilter",{filterId:"path",filterData:al})}},onActionDelete:function V(aj){var ao=this,ah=aj.jsNode,am=ah.isContainer?"folder":"document",aq=aj.displayName,ai=(this.options.syncMode==="CLOUD"),ap=0;var au=this.msg("message.confirm.delete",aq);if(ah.hasAspect("sync:syncSetMemberNode")){if(ai){if(ah.hasAspect("sync:deleteOnPrem")){au+=this.msg("actions.synced.cloud."+am+".delete.on.prem",aq)}else{au+=this.msg("actions.synced.cloud."+am+".delete",aq)}}else{au+=this.msg("actions.synced."+am+".delete",aq)}}if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||U.hasClass(this.id,"alf-fullscreen"))){ap=1000}var ar=undefined;if(U.hasClass(this.id,"alf-true-fullscreen")){ar=U.get(this.id)}var an=[{text:this.msg("button.delete"),handler:function al(){this.destroy();ao._onActionDeleteConfirm.call(ao,aj)}},{text:this.msg("button.cancel"),handler:function ak(){this.destroy()},isDefault:true}];if(ah.hasAspect("sync:syncSetMemberNode")){au+=this.msg("actions.synced.remove-sync");an.unshift({text:this.msg("button.unsync"),handler:function at(){var aw=ai?false:U.getAttribute("requestDeleteRemote","checked");try{Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetmembers/"+aj.jsNode.nodeRef.uri+"?requestDeleteRemote="+aw,method:Alfresco.util.Ajax.DELETE,successCallback:{fn:function ax(){var ay=U.get("prompt");var az=ay.getElementsByTagName("button")[0];az.style.display="none";YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:ao.msg("message.unsync.success")})},scope:ao},failureMessage:ao.msg("message.unsync.failure")})}catch(av){}}})}Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+am+".delete"),text:au,noEscape:true,buttons:an,zIndex:ap},ar)},_onActionDeleteConfirm:function ab(ak){var ah=ak.jsNode,aq=ak.location.path,aj=ak.location.file,ai=K(aq,aj),an=ak.displayName,ao=ah.nodeRef,al=this.getParentNodeRef(ak);var am={zIndex:this.fullscreen!==undefined&&(U.hasClass(this.id,"alf-true-fullscreen")||U.hasClass(this.id,"alf-fullscreen"))?1000:0,parentElement:U.hasClass(this.id,"alf-true-fullscreen")?U.get(this.id):undefined};this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:ah.isContainer?"folder-deleted":"file-deleted",page:"documentlibrary",activityData:{fileName:aj,path:aq,nodeRef:ao.toString(),parentNodeRef:al.toString()}},event:{name:ah.isContainer?"folderDeleted":"fileDeleted",obj:{path:ai}},display:am,message:this.msg("message.delete.success",an),callback:{fn:function ap(ar,at){if(this.totalRecords){this.totalRecords-=ar.json.successCount}},scope:this}},failure:{display:am,message:this.msg("message.delete.failure",an)},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:ao.uri}},wait:{message:this.msg("message.multiple-delete.please-wait")}})},onActionEditOffline:function b(ah){Alfresco.logger.error("onActionEditOffline","Abstract implementation not overridden")},onlineEditMimetypes:{"application/msword":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word.Document","application/vnd.ms-word.document.macroenabled.12":"Word.Document","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"Word.Document","application/vnd.ms-word.template.macroenabled.12":"Word.Document","application/vnd.ms-powerpoint":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPoint.Slide","application/vnd.ms-powerpoint.presentation.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"PowerPoint.Slide","application/vnd.ms-powerpoint.slideshow.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.template":"PowerPoint.Slide","application/vnd.ms-powerpoint.template.macroenabled.12":"PowerPoint.Slide","application/vnd.ms-powerpoint.addin.macroenabled.12":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.presentationml.slide":"PowerPoint.Slide","application/vnd.ms-powerpoint.slide.macroEnabled.12":"PowerPoint.Slide","application/vnd.ms-excel":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel.Sheet","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"Excel.Sheet","application/vnd.ms-excel.sheet.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.template.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.addin.macroenabled.12":"Excel.Sheet","application/vnd.ms-excel.sheet.binary.macroenabled.12":"Excel.Sheet","application/vnd.visio":"Visio.Drawing"},onActionEditOnline:function o(ah){if(!Y(ah.onlineEditUrl)){ah.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,ah.location)}if(ah.onlineEditUrl.length>256||(encodeURI(ah.onlineEditUrl)).length>256){Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.GET,url:Alfresco.constants.PROXY_URI+"/api/sites/"+ah.location.site.name,successCallback:{fn:function(ai){var am=ai.json.node.split("/").pop();var ak=ah.nodeRef.split("/").pop();ah.onlineEditUrl=ah.onlineEditUrl.split(ah.location.site.name)[0]+"_IDX_SITE_"+am+"/_IDX_NODE_"+ak+"/"+ah.displayName;if(ah.onlineEditUrl.length>256){var aj=ah.displayName.split(".").pop();var al=ah.displayName.split(".")[0];var ao=ah.onlineEditUrl.length-256;ah.onlineEditUrl=ah.onlineEditUrl.replace(ah.displayName,al.substring(0,al.length-ao-1)+"."+aj)}if(encodeURI(ah.onlineEditUrl).length>256){var aj=ah.displayName.split(".").pop();var al=ah.onlineEditUrl.split("/").pop();var an=al.split(".")[0].substring(0,5)+"."+aj;ah.onlineEditUrl=ah.onlineEditUrl.replace(al,an)}this.actionEditOnlineInternal(ah)},scope:this},failureCallback:{fn:function(ai){this.actionEditOnlineInternal(ah)},scope:this}})}else{this.actionEditOnlineInternal(ah)}},actionEditOnlineInternal:function o(ah){if(ah.onlineEditUrl.length>256||encodeURI(ah.onlineEditUrl).length>256){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.path.failure")})}else{if(this._launchOnlineEditor(ah)){YAHOO.Bubbling.fire("metadataRefresh")}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.office.failure")})}}},_launchOnlineEditor:function E(al){var ao="SharePoint.OpenDocuments",ai=al.jsNode,am=al.location,aq=ai.mimetype,aj=null,ak=null,ah={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",docm:"application/vnd.ms-word.document.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dotm:"application/vnd.ms-word.template.macroenabled.12",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",sldm:"application/vnd.ms-powerpoint.slide.macroEnabled.12",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12"};if(!Alfresco.util.validLocationForOnlineEdit(am)){Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.invalid",am.file)});return true}if(this.onlineEditMimetypes.hasOwnProperty(aq)){aj=this.onlineEditMimetypes[aq]}else{var an=Alfresco.util.getFileExtension(al.location.file);if(an!==null){an=an.toLowerCase();if(ah.hasOwnProperty(an)){aq=ah[an];if(this.onlineEditMimetypes.hasOwnProperty(aq)){aj=this.onlineEditMimetypes[aq]}}}}if(aj!==null){if(!Y(al.onlineEditUrl)){al.onlineEditUrl=Alfresco.util.onlineEditUrl(this.doclistMetadata.custom.vtiServer,am)}if(YAHOO.env.ua.ie>0){return this._launchOnlineEditorIE(ao,al,aj)}if((YAHOO.env.ua.chrome>0)&&!Alfresco.util.isSharePointPluginInstalled()){var an=Alfresco.util.getFileExtension(am.file);if(null!==an){var ap=this.getProtocolForFileExtension(an.toLowerCase());return this._launchOnlineEditorChrome(ap,al.onlineEditUrl)}}if(Alfresco.util.isSharePointPluginInstalled()){return this._launchOnlineEditorPlugin(al,aj)}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("actions.editOnline.failure",am.file)});return false}}return window.open(al.onlineEditUrl,"_blank")},_launchOnlineEditorChrome:function j(al,ak){var ah=al+":ofe%7Cu%7C"+ak;var am=false;var ai=document.createElement("input");var aj=document.body.scrollTop+10;ai.setAttribute("style","z-index: 1000; background-color: rgba(0, 0, 0, 0); border: none; outline: none; position: absolute; left: 10px; top: "+aj+"px;");document.getElementsByTagName("body")[0].appendChild(ai);ai.focus();ai.onblur=function(){am=true};location.href=ah;setTimeout(function(){ai.onblur=null;ai.remove();if(!am){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online.supported_office_version_required")})}},500)},getProtocolForFileExtension:function(ai){var ah={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint"};return ah[ai]},_launchOnlineEditorIE:function M(aj,ah,ai){try{if(ai==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}activeXControl=new ActiveXObject(aj+".3");return activeXControl.EditDocument3(window,ah.onlineEditUrl,true,ai)}catch(al){try{activeXControl=new ActiveXObject(aj+".2");return activeXControl.EditDocument2(window,ah.onlineEditUrl,ai)}catch(am){try{activeXControl=new ActiveXObject(aj+".1");return activeXControl.EditDocument(ah.onlineEditUrl,ai)}catch(ak){}}}return false},_launchOnlineEditorPlugin:function i(ai,aj){var ak=document.getElementById("SharePointPlugin");if(ak==null&&Alfresco.util.isSharePointPluginInstalled()){var ah=null;if(YAHOO.env.ua.webkit&&Alfresco.util.isBrowserPluginInstalled("application/x-sharepoint-webkit")){ah="application/x-sharepoint-webkit"}else{ah="application/x-sharepoint"}var ao=document.createElement("object");ao.id="SharePointPlugin";ao.type=ah;ao.width=0;ao.height=0;ao.style.setProperty("visibility","hidden","");document.body.appendChild(ao);ak=document.getElementById("SharePointPlugin");if(!ak){return false}}try{if(aj==="Visio.Drawing"){throw ("Visio should be invoked using activeXControl.EditDocument2.")}return ak.EditDocument3(window,ai.onlineEditUrl,true,aj)}catch(am){try{return ak.EditDocument2(window,ai.onlineEditUrl,aj)}catch(an){try{return ak.EditDocument(ai.onlineEditUrl,aj)}catch(al){return false}}}},onActionEditOnlineAos:function P(ai){var ah=function aj(am){var an=JSON.parse(am.serverResponse.responseText);if(an){var ao=an.item.node;if(ao.isLocked){var ak=Alfresco.util.arrayContains(ao.aspects,"cm:checkedOut");var ap=ao.properties["cm:lockOwner"];var al=ap.userName!==Alfresco.constants.USERNAME;if(ak&&al){this._onAlreadyLockedConfirmation(ai,ap)}else{this._triggerEditOnlineAos(ai)}}else{this._triggerEditOnlineAos(ai)}}};Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+ai.nodeRef.replace("://","/"),successCallback:{fn:ah,scope:this}})},_onAlreadyLockedConfirmation:function W(ah,al){var ak=this;Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-online-aos.edit_offline_locked.title",al.displayName.length>0?al.displayName:al.userName),text:this.msg("message.edit-online-aos.edit_offline_locked.message"),buttons:[{text:this.msg("message.edit-online-aos.edit_offline_locked.confirm"),handler:function aj(){this.destroy();ak._triggerEditOnlineAos(ah)}},{text:this.msg("message.edit-online-aos.edit_offline_locked.cancel"),handler:function ai(){this.destroy()},isDefault:true}]})},_triggerEditOnlineAos:function R(ah){if(!Y(ah.onlineEditUrlAos)){ah.onlineEditUrlAos=Alfresco.util.onlineEditUrlAos(this.doclistMetadata.custom.aos,ah)}var ak=Alfresco.util.getFileExtension(ah.location.file);var ai=this.getProtocolForFileExtension(ak);if(ai===undefined){Alfresco.logger.error("onActionEditOnlineAos","No protocol handler available for file extension.");return}var aj=new EmbeddedOfficeLauncher();if(aj.isIOS()){this._aos_launchOfficeOnIos(aj,ai,ah.onlineEditUrlAos);return}if(!aj.isWin()&&!aj.isMac()){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.no_supported_environment")});return}if(aj.isAvailable()){this._aos_launchOfficeByPlugin(aj,ah.onlineEditUrlAos)}else{this._aos_tryToLaunchOfficeByMsProtocolHandler(aj,ai,ah.onlineEditUrlAos)}return},_aos_launchOfficeByPlugin:function z(al,aj){var ai,an;var ak=(al.isFirefox()||al.isChrome()||al.isSafari());if(!al.EditDocument(aj)){if(al.isControlNotActivated()&&ak){ai=window.setInterval(function(){if(al.isControlActivated()){window.clearInterval(ai);an.destroy();window.setTimeout(function(){if(!al.EditDocument(aj)){if(al.getLastControlResult()!==-2){var ao=al.getLastControlResult()!==false?" (Error code: "+al.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+ao})}}else{YAHOO.Bubbling.fire("metadataRefresh")}},50)}},250);var an=new YAHOO.widget.SimpleDialog("prompt",{close:false,constraintoviewport:true,draggable:false,effect:null,modal:true,visible:true,zIndex:9999});var am="message.edit-online-aos.plugin_blocked.body.firefox";if(al.isFirefox()){am="message.edit-online-aos.plugin_blocked.body.firefox"}else{if(al.isChrome()){am="message.edit-online-aos.plugin_blocked.body.chrome"}else{if(al.isSafari()){am="message.edit-online-aos.plugin_blocked.body.safari"}}}an.setHeader(this.msg("message.edit-online-aos.plugin_blocked.caption"));an.setBody(this.msg(am));an.cfg.queueProperty("buttons",[{text:this.msg("message.edit-online-aos.plugin_blocked.button_dismiss"),handler:function(){window.clearInterval(ai);this.destroy()},isDefault:true}]);an.render(document.body);an.center();an.show()}else{if(al.getLastControlResult()!==-2){var ah=al.getLastControlResult()!==false?" (Error code: "+al.getLastControlResult()+")":"";Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-online-aos.starting_office_failed")+ah})}}}else{YAHOO.Bubbling.fire("metadataRefresh")}},_aos_tryToLaunchOfficeByMsProtocolHandler:function Z(an,al,ak){var ah=al+":ofe%7Cu%7C"+ak;var am=false;var ai=document.createElement("input");var aj=document.body.scrollTop+10;ai.setAttribute("style","z-index: 1000; background-color: rgba(0, 0, 0, 0); border: none; outline: none; position: absolute; left: 10px; top: "+aj+"px;");document.getElementsByTagName("body")[0].appendChild(ai);ai.focus();ai.onblur=function(){am=true};ai.context=this;location.href=ah;setTimeout(function(){ai.onblur=null;ai.remove();if(!am){Alfresco.util.PopupManager.displayMessage({text:ai.context.msg("message.edit-online-aos.supported_office_version_required")})}},500)},_aos_launchOfficeOnIos:function x(al,aj,ai){var ah=aj+":ofe%7Cu%7C"+al.encodeUrl(ai);var ak=document.createElement("iframe");ak.setAttribute("style","display: none; height: 0; width: 0;");document.getElementsByTagName("body")[0].appendChild(ak);ak.src=ah},getProtocolForFileExtension:function(ai){var ah={doc:"ms-word",docx:"ms-word",docm:"ms-word",dot:"ms-word",dotx:"ms-word",dotm:"ms-word",xls:"ms-excel",xlsx:"ms-excel",xlsb:"ms-excel",xlsm:"ms-excel",xlt:"ms-excel",xltx:"ms-excel",xltm:"ms-excel",xlsm:"ms-excel",ppt:"ms-powerpoint",pptx:"ms-powerpoint",pot:"ms-powerpoint",potx:"ms-powerpoint",potm:"ms-powerpoint",pptm:"ms-powerpoint",potm:"ms-powerpoint",pps:"ms-powerpoint",ppsx:"ms-powerpoint",ppam:"ms-powerpoint",ppsm:"ms-powerpoint",sldx:"ms-powerpoint",sldm:"ms-powerpoint"};return ah[ai]},onActionSimpleRepoAction:function g(an,ai){if(ai.title.indexOf("_deactivated")==-1){var al=this.getAction(an,ai).params,ar=an.displayName,aq=["function","action","success","successMessage","failure","failureMessage","async"],ao={};for(var ah in al){if(al.hasOwnProperty(ah)&&!Alfresco.util.arrayContains(aq,ah)){ao[ah]=al[ah]}}var ap=ai.title;ai.title=ai.title+"_deactivated";var ak=al.async?"async="+al.async:null;var aj={success:{event:{name:"metadataRefresh",obj:an}},failure:{message:this.msg(al.failureMessage,ar),fn:function am(){ai.title=ap},scope:this},webscript:{method:Alfresco.util.Ajax.POST,stem:Alfresco.constants.PROXY_URI+"api/",name:"actionQueue",queryString:ak},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{actionedUponNode:an.nodeRef,actionDefinitionName:al.action,parameterValues:ao}}};if(YAHOO.lang.isFunction(this[al.success])){aj.success.callback={fn:this[al.success],obj:an,scope:this}}if(al.successMessage){aj.success.message=this.msg(al.successMessage,ar)}if(YAHOO.lang.isFunction(this[al.failure])){aj.failure.callback={fn:this[al.failure],obj:an,scope:this}}if(al.failureMessage){aj.failure.message=this.msg(al.failureMessage,ar)}this.modules.actions.genericAction(aj)}},onActionFormDialog:function q(ai,ah){var aj=this.generateConfigForFormDialogAction(ai,ah);Alfresco.util.PopupManager.displayForm(aj)},onActionFormDialogWithSubmitDisable:function A(ai,ah){var aj=this.generateConfigForFormDialogAction(ai,ah);aj.properties.disableSubmitButton=true;Alfresco.util.PopupManager.displayForm(aj)},generateConfigForFormDialogAction:function F(aj,ah){var al=this.getAction(aj,ah),an=al.params,ak={title:this.msg(al.label)},ai=aj.displayName;delete an["function"];var am=an.success;delete an.success;ak.success={fn:function(ao,ap){if(YAHOO.lang.isFunction(this[am])){this[am].call(this,ao,ap)}YAHOO.Bubbling.fire("metadataRefresh",ap)},obj:aj,scope:this};if(an.successMessage){ak.successMessage=this.msg(an.successMessage,ai);delete an.successMessage}if(YAHOO.lang.isFunction(this[an.failure])){ak.failure={fn:this[an.failure],obj:aj,scope:this};delete an.failure}if(an.failureMessage){ak.failureMessage=this.msg(an.failureMessage,ai);delete an.failureMessage}ak.properties=an;return ak},onActionUploadNewVersion:function n(aj){var ai=aj.jsNode,an=aj.displayName,ao=ai.nodeRef,ak=aj.version;if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var ap=this.msg("label.filter-description",an),al="*";if(an&&new RegExp(/[^\.]+\.[^\.]+/).exec(an)){al="*"+an.substring(an.lastIndexOf("."))}if(aj.workingCopy&&aj.workingCopy.workingCopyVersion){ak=aj.workingCopy.workingCopyVersion}var am=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||U.hasClass(this.id,"alf-fullscreen"))){am=1000}var ah={updateNodeRef:ao.toString(),updateFilename:an,updateVersion:ak,overwrite:true,filter:[{description:ap,extensions:al}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:this.onNewVersionUploadComplete,scope:this}};this.fileUpload.options.zIndex=am;if(Y(this.options.siteId)){ah.siteId=this.options.siteId;ah.containerId=this.options.containerId}this.fileUpload.show(ah)},_uploadComplete:function T(ah,al){var am=ah.successful.length,ai,ak;if(am>0){if(am<(this.options.groupActivitiesAt||5)){for(var aj=0;aj<am;aj++){ak=ah.successful[aj];ai={fileName:ak.fileName,nodeRef:ak.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-"+al,"document-details",ai)}}else{ai={fileCount:am,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-"+al,"documentlibrary",ai)}}},onFileUploadComplete:function s(ah){this._uploadComplete(ah,"added")},onNewVersionUploadComplete:function B(ah){this._uploadComplete(ah,"updated")},onActionCancelEditing:function m(ai){var ah=ai.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.edit-cancel.success",ah)},failure:{message:this.msg("message.edit-cancel.failure",ah)},webscript:{method:Alfresco.util.Ajax.POST,name:"cancel-checkout/node/{nodeRef}",params:{nodeRef:ai.jsNode.nodeRef.uri}}});YAHOO.Bubbling.fire("editingCanceled",{record:ai})},onActionUnlockDocument:function ae(ai){var ah=ai.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.unlock-document.success",ah)},failure:{message:this.msg("message.unlock-document.failure",ah)},webscript:{method:Alfresco.util.Ajax.POST,name:"unlock-document/node/{nodeRef}",params:{nodeRef:ai.jsNode.nodeRef.uri}}})},onActionCopyTo:function l(ah){this._copyMoveTo("copy",ah)},onActionMoveTo:function h(ah){this._copyMoveTo("move",ah)},onActionUnzipTo:function c(ah){this._copyMoveTo("unzip",ah)},_copyMoveTo:function I(am,ak){if(!am in {copy:true,move:true,unzip:true}){throw new Error("'"+am+"' is not a valid Copy/Move to mode.")}if(!this.modules.copyMoveTo){this.modules.copyMoveTo=new Alfresco.module.DoclibCopyMoveTo(this.id+"-copyMoveTo")}var al=Alfresco.module.DoclibGlobalFolder;var ai=[al.VIEW_MODE_RECENT_SITES,al.VIEW_MODE_FAVOURITE_SITES,al.VIEW_MODE_SITE,al.VIEW_MODE_SHARED];if(this.options.repositoryBrowsing===true){ai.push(al.VIEW_MODE_REPOSITORY)}ai.push(al.VIEW_MODE_USERHOME);var an=0;if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||U.hasClass(this.id,"alf-fullscreen"))){an=1000}var aj=undefined;if(U.hasClass(this.id,"alf-true-fullscreen")){aj=U.get(this.id)}var ah=ak[0]?ak[0].location.repoPath:ak.location.repoPath;this.modules.copyMoveTo.setOptions({allowedViewModes:ai,mode:am,siteId:this.options.siteId,containerId:this.options.containerId,path:this.options.repositoryBrowsing?ah:this.currentPath,files:ak,rootNode:this.options.repositoryBrowsing?this.modules.copyMoveTo.options.rootNode:this.options.rootNode,parentId:this.getParentNodeRef(ak),zIndex:an,parentElement:aj?aj:undefined}).showDialog()},onActionAssignWorkflow:function e(ai){var am="",ah=this.getParentNodeRef(ai);if(YAHOO.lang.isArray(ai)){for(var ak=0,aj=ai.length;ak<aj;ak++){am+=(ak===0?"":",")+ai[ak].nodeRef}}else{am=ai.nodeRef}var al={selectedItems:am};if(ah){al.destination=ah}Alfresco.util.navigateTo(J("start-workflow"),"POST",al)},onActionManagePermissions:function O(ah){if(!this.modules.permissions){this.modules.permissions=new Alfresco.module.DoclibPermissions(this.id+"-permissions")}this.modules.permissions.setOptions({siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:ah}).showDialog()},onActionTakeOwnership:function f(al,ak){var ao=this,aj=al.jsNode,am=aj.isContainer?"folder":"document",ar=al.displayName,ap=0;var av=this.msg("message.confirm.take-ownership",ar);if(this.fullscreen!==undefined&&(this.fullscreen.isWindowOnly||U.hasClass(this.id,"alf-fullscreen"))){ap=1000}var at=undefined;var ai=U.get(this.id);var ah=navigator.userAgent.toLowerCase();if((ah.indexOf("gecko")!=-1||ah.indexOf("safari")!=-1)&&ah.indexOf("chrome")==-1){at=ai}var an=[{text:this.msg("button.take-ownership"),handler:function aq(){this.destroy();ao.onActionSimpleRepoAction.call(ao,al,ak)}},{text:this.msg("button.cancel"),handler:function au(){this.destroy()},isDefault:true}];Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.confirm.take-ownership.title"),text:av,noEscape:true,buttons:an})},onActionManageAspects:function u(ah){if(!this.modules.aspects){this.modules.aspects=new Alfresco.module.DoclibAspects(this.id+"-aspects")}this.modules.aspects.setOptions({file:ah}).show()},onActionChangeType:function t(al){var ah=al.jsNode,am=ah.type,ao=al.displayName,ai=Alfresco.constants.PROXY_URI+K("slingshot/doclib/type/node",ah.nodeRef.uri);var ap=function ak(ar){ar.addValidation(this.id+"-changeType-type",function aq(ay,au,ax,aw,at,av){return ay.options[ay.selectedIndex].value!=="-"},null,"change",null,{validationType:"mandatory"})};this.modules.changeType=new Alfresco.module.SimpleDialog(this.id+"-changeType").setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/change-type?currentType="+encodeURIComponent(am),actionUrl:ai,doSetupFormsValidation:{fn:ap,scope:this},firstFocus:this.id+"-changeType-type",onSuccess:{fn:function an(aq){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:ao});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.success",ao)})},scope:this},onFailure:{fn:function aj(aq){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.failure",ao)})},scope:this}});this.modules.changeType.show()},viewInSourceRepositoryURL:function r(aj,al){var ak=aj.node,ai=aj.location.repositoryId,ah=this.options.replicationUrlMapping,am;if(!ai||!ah||!ah[ai]){return"#"}am=ak.isContainer?al.folderDetailsUrl:al.documentDetailsUrl;am=am.substring(Alfresco.constants.URL_CONTEXT.length);return K(ah[ai],"/",am)},onActionCloudSync:function aa(ah){if(k){k.destroy()}k=new Alfresco.module.DoclibCloudFolder(this.id+"-cloud-folder");var ai=this;YAHOO.Bubbling.on("folderSelected",function aj(al,ak){this.updateSyncOptions();Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetdefinitions",dataObj:YAHOO.lang.merge(this.options.syncOptions,{memberNodeRefs:ai.getMemberNodeRefs(this.options.files),remoteTenantId:this.options.targetNetwork,targetFolderNodeRef:ak[1].selectedFolder.nodeRef}),successCallback:{fn:function am(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.sync.success")})},scope:this},failureMessage:this.msg("message.sync.failure")})},k);if(!this.modules.cloudAuth){this.modules.cloudAuth=new Alfresco.module.CloudAuth(this.id+"cloudAuth")}k.setOptions({files:ah});this.modules.cloudAuth.setOptions({authCallback:k.showDialog,authCallbackContext:k}).checkAuth()},onActionCloudUnsync:function H(aj){var ao=this,an=aj.jsNode.isContainer?"folder":"document",ai=aj.displayName,am=(this.options.syncMode==="CLOUD"),ah=am?"":'<div><input type="checkbox" id="requestDeleteRemote" class="requestDeleteRemote-checkBox"><span class="requestDeleteRemote-text">'+this.msg("sync.remove."+an+".from.cloud",ai)+"</span></div>";Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+an+".cloud-unsync"),noEscape:true,text:this.msg("message.unsync.confirm",ai)+ah,buttons:[{text:this.msg("button.unsync"),handler:function ak(){var ap=am?false:U.getAttribute("requestDeleteRemote","checked");this.destroy();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncsetmembers/"+aj.jsNode.nodeRef.uri+"?requestDeleteRemote="+ap,method:Alfresco.util.Ajax.DELETE,successCallback:{fn:function aq(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:ao.msg("message.unsync.success")})},scope:ao},failureMessage:ao.msg("message.unsync.failure")})}},{text:this.msg("button.cancel"),handler:function al(){this.destroy()},isDefault:true}]})},onCloudSyncIndicatorAction:function D(ah,al){var aj=new Alfresco.util.createInfoBalloon(this.widgets.dataTable.getTrEl(al),{text:this.msg("label.loading"),width:"455px"});aj.show();Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/node/"+ah.nodeRef.replace("://","/"),successCallback:{fn:function ak(an){var ao=this,am={showTitle:true,showRequestSyncButton:true,showUnsyncButton:true,showMoreInfoLink:true};Alfresco.util.getSyncStatus(this,ah,an.json,am,function(aq){if(aq!=null){aj.html(aq.html);aj.requestsync=Alfresco.util.createYUIButton(ao,"button-requestsyn",function(){ao.onActionCloudSyncRequest(ah);aj.hide()},{id:ao.id});if(!aq.showRequestSyncButton&&aj.requestsync!=null){aj.requestsync.setStyle("display","none")}aj.unsync=Alfresco.util.createYUIButton(ao,"button-unsync",function(){ao.onActionCloudUnsync(ah);aj.hide()},{id:ao.id});if(!aq.showUnsyncButton&&aj.unsync!=null){aj.unsync.setStyle("display","none")}var ap=aj.content;Alfresco.util.syncClickOnShowDetailsLinkEvent(ao,ap);Alfresco.util.syncClickOnHideLinkEvent(ao,ap);Alfresco.util.syncClickOnTransientErrorShowDetailsLinkEvent(ao,ap);Alfresco.util.syncClickOnTransientErrorHideLinkEvent(ao,ap)}else{aj.hide()}})},scope:this},failureCallback:{fn:function ai(am){Alfresco.util.PopupManager.displayMessage({text:this.msg("sync.unable.get.details")})},scope:this}})},onActionCloudSyncRequest:function y(ah,aj){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"enterprise/sync/syncrequest",dataObj:{memberNodeRefs:this.getMemberNodeRefs(ah)},successCallback:{fn:function ai(){YAHOO.Bubbling.fire("metadataRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request.sync.success")})},scope:this},failureMessage:this.msg("message.request.sync.failure")})},getMemberNodeRefs:function a(ah){var aj=new Array();if(YAHOO.lang.isArray(ah)){for(var ai in ah){aj.push(ah[ai].nodeRef)}}else{aj.push(ah.nodeRef)}return aj},onCloudSyncFailedIndicatorAction:function G(ah,ai){this.onCloudSyncIndicatorAction(ah,ai)},onCloudIndirectSyncIndicatorAction:function ac(ah,ai){this.onCloudSyncIndicatorAction(ah,ai)},onCloudIndirectSyncFailedIndicatorAction:function N(ah,ai){this.onCloudSyncIndicatorAction(ah,ai)},onActionFolderDownload:function w(ah){var ai=Alfresco.getArchiveAndDownloadInstance(),aj={nodesToArchive:[{nodeRef:ah.nodeRef}],archiveName:ah.fileName};ai.show(aj)},onActionDownload:function p(ah){var ai=Alfresco.getArchiveAndDownloadInstance(),aj={nodesToArchive:[]};if(ah.length==1){aj.nodesToArchive.push({nodeRef:ah[0].nodeRef});aj.archiveName=ah[0].fileName}else{for(var ak=0;ak<ah.length;ak++){aj.nodesToArchive.push({nodeRef:ah[ak].nodeRef})}}ai.show(aj)}}})();