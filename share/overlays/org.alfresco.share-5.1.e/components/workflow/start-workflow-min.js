(function(){var c=YAHOO.util.Dom,i=YAHOO.util.Event;Alfresco.component.StartWorkflow=function b(k){Alfresco.component.StartWorkflow.superclass.constructor.call(this,k,["button"]);this.name="Alfresco.component.StartWorkflow";Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,Alfresco.component.StartWorkflow.superclass.options);this.selectedItems="";this.destination="";this.workflowTypes=[];YAHOO.Bubbling.on("objectFinderReady",this.onObjectFinderReady,this);YAHOO.Bubbling.on("formContentReady",this.onStartWorkflowFormContentReady,this);YAHOO.Bubbling.on("afterFormRuntimeInit",this.onStartWorkflowAfterFormRuntimeInit,this);return this};YAHOO.extend(Alfresco.component.StartWorkflow,Alfresco.component.ShareFormManager,{options:{selectedItems:"",destination:"",workflowDefinitions:[]},onReady:function d(){this.widgets.workflowDefinitionMenuButton=Alfresco.util.createYUIButton(this,"workflow-definition-button",this.onWorkflowSelectChange,{label:this.msg("label.selectWorkflowDefinition")+" "+Alfresco.constants.MENU_ARROW_SYMBOL,title:this.msg("title.selectWorkflowDefinition"),type:"menu",menu:"workflow-definition-menu"});return Alfresco.component.StartWorkflow.superclass.onReady.call(this)},onObjectFinderReady:function e(l,k){var m=k[1].eventGroup;if(m.options.field=="assoc_packageItems"&&m.eventGroup.indexOf(this.id)==0){m.selectItems(this.options.selectedItems)}},onWorkflowSelectChange:function j(m,l){var n=l[1].index;if(n>=0){var k=this.options.workflowDefinitions[n];this.widgets.workflowDefinitionMenuButton.set("label",k.title+" "+Alfresco.constants.MENU_ARROW_SYMBOL);this.widgets.workflowDefinitionMenuButton.set("title",k.description);Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/form",dataObj:{htmlid:this.id+"-startWorkflowForm-"+Alfresco.util.generateDomId(),itemKind:"workflow",itemId:k.name,mode:"create",submitType:"json",showCaption:true,formUI:true,showCancelButton:true,destination:this.options.destination},successCallback:{fn:this.onWorkflowFormLoaded,scope:this},failureMessage:this.msg("message.failure"),scope:this,execScripts:true})}},onWorkflowFormLoaded:function a(k){var l=c.get(this.id+"-workflowFormContainer");c.addClass(l,"hidden");l.innerHTML=k.serverResponse.responseText},onStartWorkflowFormContentReady:function h(m,k){var l=c.get(this.id+"-workflowFormContainer");c.removeClass(l,"hidden")},onStartWorkflowAfterFormRuntimeInit:function g(l,k){this.formruntime=k[1].runtime;this.formruntime.setAsReusable(false)},onFormSubmitFailure:function f(k){var l=(k.json&&k.json.message?k.json.message:this.msg(this.options.failureMessageKey));l=l.replace("org.alfresco.service.cmr.workflow.WorkflowException:","");Alfresco.util.PopupManager.displayPrompt({title:this.msg(this.options.failureMessageKey),text:(l)})}})})();