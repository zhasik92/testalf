define(["dojo/_base/declare","alfresco/core/Core","dojo/_base/lang","cmm/layout/TitlePane","dojo/dom"],function(f,b,a,c,e){return f([b],{clearAllTopic:null,defaultFormTitlePaneConfig:{titlePaneTitle:"",titlePaneOpen:true,titlePaneToggleable:false,titlePaneMoveable:false},constructor:function h(l){a.mixin(this,l);this.alfSubscribe("ALF_CREATE_FORM_TITLE_PANE_REQUEST",a.hitch(this,this.onCreateFormTitlePaneRequest));if(this.clearAllTopic!=null){this.alfSubscribe(this.clearAllTopic,a.hitch(this,this.cleanUpAllPreviousTitlePanes))}this.idToTitlePaneMap={}},mapRequestedIdToTitlePane:function k(m,l){if(m.titlePaneId){this.idToTitlePaneMap[m.titlePaneId]=l}else{this.idToTitlePaneMap[null]=l}},cleanUpAnyPreviousTitlePane:function j(l){if(this.idToTitlePaneMap[l.titlePaneId]){this.idToTitlePaneMap[l.titlePaneId].onClose();delete this.idToTitlePaneMap[l.titlePaneId]}else{if(this.idToTitlePaneMap[null]){this.idToTitlePaneMap[null].onClose();delete this.idToTitlePaneMap[null]}}},cleanUpAllPreviousTitlePanes:function d(){for(var l in this.idToTitlePaneMap){this.cleanUpAnyPreviousTitlePane({titlePaneId:l})}},onCreateFormTitlePaneRequest:function i(p){this.cleanUpAnyPreviousTitlePane(p);if(!p.widgets){this.alfLog("warn","A request was made to display a TitlePane but no 'widgets' attribute has been defined",p,this)}else{if(!p.titlePaneContainer){this.alfLog("warn","A request was made to display a TitlePane but no 'titlePaneContainer' attribute has been defined",p,this)}else{if(!p.formSubmissionTopic){this.alfLog("warn","A request was made to display a TitlePane but no 'formSubmissionTopic' attribute has been defined",p,this)}else{try{var l=this.generateUuid();var m=a.clone(this.defaultFormTitlePaneConfig);a.mixin(m,a.clone(p));m.pubSubScope=l;m.parentPubSubScope=this.parentPubSubScope;var n=m.formValue?m.formValue:{};var r=this.createFormConfig(m.widgets,n,m);var q=new c({id:m.titlePaneId,title:m.titlePaneTitle,open:m.titlePaneOpen,toggleable:m.titlePaneToggleable,moveable:m.titlePaneMoveable,widgetsContent:[r]});e.byId(m.titlePaneContainer).appendChild(q.domNode);q.startup();this.mapRequestedIdToTitlePane(p,q);q.autoPosition(p.titlePanePositionContainer)}catch(o){this.alfLog("error","The following error occurred creating a TitlePane for defined configuration",o,this.titlePaneConfig,this)}}}}},createFormConfig:function g(m,n,l){var o={name:"alfresco/forms/Form",config:{widgets:m,value:n,waitForPageWidgets:false,autoSavePublishTopic:l.formSubmissionTopic,autoSavePublishGlobal:true,autoSaveOnInvalid:false}};return o}})});