define(["dojo/_base/declare","alfresco/core/Core","alfresco/core/CoreXhr","dojo/request/xhr","dojo/json","dojo/_base/lang","dojo/_base/array","dojox/uuid","dojo/on","dojo/query","dojo/dom-class","alfresco/buttons/AlfButton","service/constants/Default","cmm/CMMConstants"],function(i,A,G,af,o,j,k,n,N,ad,B,u,F,X){return i([A,G],{typesBlackList:{},aspectsBlackList:{},i18nRequirements:[{i18nFile:"./i18n/CMMService.properties"}],serviceUrl:{modelServiceUri:F.URL_CONTEXT+"service/cmm/model-service",getModels:{method:"GET",uri:F.URL_CONTEXT+"proxy/alfresco-api/-default-/private/alfresco/versions/1/cmm"},getModel:{method:"GET",uri:F.URL_CONTEXT+"proxy/alfresco-api/-default-/private/alfresco/versions/1/cmm/{name}"},exportModel:{method:"POST",uri:F.URL_CONTEXT+"proxy/alfresco-api/-default-/private/alfresco/versions/1/cmm/{name}/download?extModule=true"},exportModelStatus:{method:"GET",uri:F.PROXY_URI+"api/internal/downloads/{nodeRef}/status"},exportModelDownload:{method:"GET",uri:F.PROXY_URI+"api/node/content/{nodeRef}/{fileName}.zip"},importModel:{method:"POST",uri:F.PROXY_URI+"api/cmm/upload"},getModelForms:{method:"GET",uri:F.URL_CONTEXT+"service/cmm/model-service/{name}/forms"},getTypes:{method:"GET",uri:F.URL_CONTEXT+"proxy/alfresco-api/-default-/private/alfresco/versions/1/cmm/{name}/types"},getParentTypes:{method:"GET",uri:F.PROXY_URI+"api/classes/cm_content/subclasses"},getParentFolderTypes:{method:"GET",uri:F.PROXY_URI+"api/classes/cm_folder/subclasses"},getPropertyGroups:{method:"GET",uri:F.URL_CONTEXT+"proxy/alfresco-api/-default-/private/alfresco/versions/1/cmm/{name}/aspects"},getParentPropertyGroups:{method:"GET",uri:F.URL_CONTEXT+"service/cmm/dictionary/aspects"},getEditorData:{method:"GET",uri:F.URL_CONTEXT+"service/cmm/model-service/{name}/{entityName}"},getProperties:{method:"GET",uri:F.URL_CONTEXT+"proxy/alfresco-api/-default-/private/alfresco/versions/1/cmm/{name}/{entityClass}/{entityName}"},getEditorProperties:{method:"GET",uri:F.URL_CONTEXT+"proxy/alfresco-api/-default-/private/alfresco/versions/1/cmm/{name}/{entityClass}/{entityName}?select=allProps"}},standardProperties:[{id:"cm:name",label:"cmm.cm_name",dataType:"d:text"},{id:"cm:title",label:"cmm.cm_title",dataType:"d:text",config:{force:true}},{id:"cm:description",label:"cmm.cm_description",dataType:"d:text",config:{force:true}},{id:"cm:creator",label:"cmm.cm_creator",dataType:"d:text",config:{"for-mode":"view"}},{id:"cm:created",label:"cmm.cm_created",dataType:"d:datetime",config:{"for-mode":"view"}},{id:"cm:modifier",label:"cmm.cm_modifier",dataType:"d:text",config:{"for-mode":"view"}},{id:"cm:modified",label:"cmm.cm_modified",dataType:"d:datetime",config:{"for-mode":"view"}},{id:"size",label:"cmm.cm_size",dataType:"size",config:{"for-mode":"view",controlType:"size"}},{id:"mimetype",label:"cmm.cm_mimetype",dataType:"mimetype",config:{controlType:"mimetype"}},{id:"cm:author",label:"cmm.cm_author",dataType:"d:text",config:{force:true}},{id:"cm:taggable",label:"cmm.cm_taggable",dataType:"taggable",config:{"for-mode":"edit",force:true,controlType:"taggable"}},{id:"cm:categories",label:"cmm.cm_categories",dataType:"categories",config:{controlType:"categories"}}],blackListProperties:{"cm:content":true,"cm:name":true},propertyIndexingOptions:{"nontxt-none":{type:"nontxt",indexed:false,facetable:"UNSET",indexTokenisationMode:"TRUE"},"nontxt-standard":{type:"nontxt",indexed:true,facetable:"UNSET",indexTokenisationMode:"TRUE"},"nontxt-enhanced":{type:"nontxt",indexed:true,facetable:"TRUE",indexTokenisationMode:"TRUE"},"boolean-none":{type:"boolean",indexed:false,facetable:"UNSET",indexTokenisationMode:"TRUE"},"boolean-standard":{type:"boolean",indexed:true,facetable:"UNSET",indexTokenisationMode:"TRUE"},"txt-none":{type:"txt",indexed:false,facetable:"UNSET",indexTokenisationMode:"TRUE"},"txt-standard":{type:"txt",indexed:true,facetable:"UNSET",indexTokenisationMode:"TRUE"},"txt-free":{type:"txt",indexed:true,facetable:"FALSE",indexTokenisationMode:"TRUE"},"txt-list-whole":{type:"txt",indexed:true,facetable:"TRUE",indexTokenisationMode:"FALSE"},"txt-list-partial":{type:"txt",indexed:true,facetable:"TRUE",indexTokenisationMode:"BOTH"},"txt-pattern-unique":{type:"txt",indexed:true,facetable:"FALSE",indexTokenisationMode:"FALSE"},"txt-pattern-many":{type:"txt",indexed:true,facetable:"FALSE",indexTokenisationMode:"BOTH"}},errorResponse:{handler:"json",msgKey:"response.data.error.briefSummary"},constructor:function s(aj){j.mixin(this,aj);this.alfSubscribe(X.GET_MODELS_TOPIC,j.hitch(this,this.getModels));this.alfSubscribe(X.CREATE_MODEL,j.hitch(this,this.createModel));this.alfSubscribe(X.EDIT_MODEL,j.hitch(this,this.editModel));this.alfSubscribe(X.ACTIVATE_MODEL,j.hitch(this,this.activateModel));this.alfSubscribe(X.DEACTIVATE_MODEL,j.hitch(this,this.deactivateModel));this.alfSubscribe(X.DELETE_MODEL,j.hitch(this,this.deleteModelAction));this.alfSubscribe(X.EXPORT_MODEL,j.hitch(this,this.exportModelAction));this.alfSubscribe(X.IMPORT_MODEL,j.hitch(this,this.importModel));this.alfSubscribe(X.GET_TYPES_TOPIC,j.hitch(this,this.getTypes));this.alfSubscribe(X.GET_PARENT_TYPES,j.hitch(this,this.getParentTypes));this.alfSubscribe(X.CREATE_CUSTOMTYPE,j.hitch(this,this.createCustomType));this.alfSubscribe(X.EDIT_CUSTOMTYPE,j.hitch(this,this.editCustomType));this.alfSubscribe(X.DELETE_TYPE,j.hitch(this,this.deleteTypeAction));this.alfSubscribe(X.FIND_TYPES,j.hitch(this,this.findTypesAction));this.alfSubscribe(X.GET_PROPERTYGROUPS_TOPIC,j.hitch(this,this.getPropertyGroups));this.alfSubscribe(X.GET_PARENT_PROPERTYGROUPS,j.hitch(this,this.getParentPropertyGroups));this.alfSubscribe(X.CREATE_PROPERTYGROUP,j.hitch(this,this.createPropertyGroup));this.alfSubscribe(X.EDIT_PROPERTYGROUP,j.hitch(this,this.editPropertyGroup));this.alfSubscribe(X.DELETE_PROPERTYGROUP,j.hitch(this,this.deletePropertyGroupAction));this.alfSubscribe(X.FIND_PROPERTYGROUPS,j.hitch(this,this.findPropertyGroupsAction));this.alfSubscribe(X.GET_PROPERTIES_TOPIC,j.hitch(this,this.getProperties));this.alfSubscribe(X.GET_EDITOR_PROPERTIES_TOPIC,j.hitch(this,this.getEditorProperties));this.alfSubscribe(X.CREATE_PROPERTY,j.hitch(this,this.createProperty));this.alfSubscribe(X.EDIT_PROPERTY,j.hitch(this,this.editProperty));this.alfSubscribe(X.DELETE_PROPERTY,j.hitch(this,this.deletePropertyAction));this.alfSubscribe(X.FORM_EDITOR_SAVE_TOPIC,j.hitch(this,this.saveFormAction));this.alfSubscribe(X.FORM_EDITOR_GET_VALUE,j.hitch(this,this.getEditorValue));this.alfSubscribe(X.FORM_EDITOR_CLEAR_TO_PALETTE_ACTION,j.hitch(this,this.clearToPaletteAction));this.alfSubscribe(X.FORM_EDITOR_DEFAULT_LAYOUT_ACTION,j.hitch(this,this.defaultLayoutAction));this.alfSubscribe(X.FORM_EDITOR_CANVAS_VALUE_CHANGED,j.hitch(this,this.canvasValueChanged))},getModels:function P(aj){this.serviceXhr({url:this.serviceUrl.getModels.uri,method:this.serviceUrl.getModels.method,callbackScope:this,successCallback:function(am){var an=am.list.entries;for(var al=0;al<an.length;al++){an[al].entry.statusLabel=this.message(an[al].entry.status==="ACTIVE"?"cmm.label.status.grid.active":"cmm.label.status.grid.draft")}var ak=aj.alfResponseTopic||aj.responseTopic;if(ak!=null){this.alfPublish(ak+"_SUCCESS",am)}}})},getTypes:function x(ak){var aj=j.getObject("name",false,ak);if(aj!=null){this.serviceXhr({url:j.replace(this.serviceUrl.getModel.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.getModel.method,callbackScope:this,successCallback:function(an){var am=an.entry.status,al=this.message(am==="ACTIVE"?"cmm.label.status.active":"cmm.label.status.draft");this.alfPublish(X.TYPES_LIST_SCOPE+X.UPDATE_MODEL_HEADING_STATUS,{status:am,label:al});this.serviceXhr({url:j.replace(this.serviceUrl.getTypes.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.getTypes.method,callbackScope:this,successCallback:function(ao){this.serviceXhr({url:j.replace(this.serviceUrl.getModelForms.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.getModelForms.method,successCallback:function(at){var ar=ao.list.entries;for(var aq=0;aq<ar.length;aq++){ar[aq].modelName=aj;ar[aq].status=am;ar[aq].layout=(at.forms[ar[aq].entry.name]===true)}var ap=ak.alfResponseTopic||ak.responseTopic;if(ap!=null){this.alfPublish(ap+"_SUCCESS",ao)}},callbackScope:this})}})}})}else{this.alfLog("warn","A request was made to get types for a model but no 'name' attribute was provided",ak,this)}},getPropertyGroups:function K(ak){var aj=j.getObject("name",false,ak);if(aj!=null){this.serviceXhr({url:j.replace(this.serviceUrl.getModel.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.getModel.method,callbackScope:this,successCallback:function(am){var al=am.entry.status;this.serviceXhr({url:j.replace(this.serviceUrl.getPropertyGroups.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.getPropertyGroups.method,callbackScope:this,successCallback:function(an){this.serviceXhr({url:j.replace(this.serviceUrl.getModelForms.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.getModelForms.method,successCallback:function(ar){var aq=an.list.entries;for(var ap=0;ap<aq.length;ap++){aq[ap].modelName=aj;aq[ap].status=al;aq[ap].layout=(ar.forms[aq[ap].entry.name]===true)}var ao=ak.alfResponseTopic||ak.responseTopic;if(ao!=null){this.alfPublish(ao+"_SUCCESS",an)}},callbackScope:this})}})}})}else{this.alfLog("warn","A request was made to get property groups for a model but no 'name' attribute was provided",ak,this)}},createModel:function ab(ak){var aj={status:"DRAFT",namespaceUri:ak.namespace,namespacePrefix:ak.prefix,name:ak.name,description:ak.description,author:ak.author};this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"POST",data:{modelName:ak.name,operation:"createModel",data:aj},handleAs:this.errorResponse.handler,successCallback:function(al){this.alfPublish(X.CREATE_MODEL+"_SUCCESS");this._reloadModelList()},failureCallback:function(al){console.log("FAILURE: "+al);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,al))||this.message("cmm.message.unknown-error")})},callbackScope:this})},editModel:function p(al){var ak=j.getObject("name",false,al);if(ak!=null){var aj={namespaceUri:al.namespace,namespacePrefix:al.prefix,description:al.description,author:al.author};this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"PUT",data:{modelName:ak,operation:"editModel",arguments:{name:ak},data:aj},handleAs:this.errorResponse.handler,successCallback:function(am){this.alfPublish(X.EDIT_MODEL+"_SUCCESS");this._reloadModelList()},failureCallback:function(am){console.log("FAILURE: "+am);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,am))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to edit a model but no 'name' attribute was provided",al,this)}},activateModel:function D(ak){var aj=j.getObject("name",false,ak);if(aj!=null){this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"PUT",data:{modelName:aj,operation:"activateModel",data:{status:"ACTIVE"},arguments:{name:aj}},handleAs:this.errorResponse.handler,alfTopic:ak.alfResponseTopic||ak.responseTopic,successCallback:function(al){this._reloadModelList()},failureCallback:function(al){console.log("FAILURE: "+al);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,al))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to activate a model but no 'name' attribute was provided",ak,this)}},deactivateModel:function r(ak){var aj=j.getObject("name",false,ak);if(aj!=null){this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"PUT",data:{modelName:aj,operation:"deactivateModel",data:{status:"DRAFT"},arguments:{name:aj}},handleAs:this.errorResponse.handler,alfTopic:ak.alfResponseTopic||ak.responseTopic,successCallback:function(al){this._reloadModelList()},failureCallback:function(al){console.log("FAILURE: "+al);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,al))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to deactivate a model but no 'name' attribute was provided",ak,this)}},deleteModelAction:function e(al){var ak=j.getObject("name",false,al);if(ak!=null){var aj=this.generateUuid();this._deleteHandle=this.alfSubscribe(aj,j.hitch(this,this.deleteModel));this.alfPublish("ALF_CREATE_DIALOG_REQUEST",{dialogId:"CMM_DELETE_MODEL_DIALOG",dialogTitle:this.message("cmm.model.delete-title"),textContent:this.message("cmm.model.delete-message",{"0":ak}),widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.model.delete-button.confirm-label"),publishTopic:this.pubSubScope+aj,publishPayload:al}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.model.delete-button.cancel-label"),publishTopic:"close"}}]})}else{this.alfLog("warn","A request was made to delete a model but no 'name' attribute was provided",al,this)}},importModel:function a(ao){if(ao.file&&ao.file.length===1){var an=new FormData();an.append("file",ao.file[0]);var al=new XMLHttpRequest(),aj=this.serviceUrl.importModel.uri;if(this.isCsrfFilterEnabled()){aj+="?"+this.getCsrfParameter()+"="+encodeURIComponent(this.getCsrfToken())}N(al.upload,"load",j.hitch(this,function am(ap){var ar=this;al.onreadystatechange=function aq(){if(al.readyState===4){var at=o.parse(al.response);switch(al.status){case 200:ar.serviceXhr({url:ar.serviceUrl.modelServiceUri,method:"POST",data:{modelName:at.modelName,forms:at.shareExtModule}});ar._reloadModelList();break;case 400:ar.alfPublish(X.NOTIFICATION_TOPIC,{message:ar.message("cmm.message.error-import")+" "+at.message.substring(8)});break;case 409:ar.alfPublish(X.NOTIFICATION_TOPIC,{message:ar.message("cmm.message.error-conflict")+" "+at.message.substring(8)});break;default:ar.alfPublish(X.NOTIFICATION_TOPIC,{message:ar.message("cmm.message.unknown-error")+" "+at.message.substring(8)});break}}}}));N(al.upload,"error",j.hitch(this,function ak(){console.log("FAILURE: "+al.state);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this.message("cmm.message.error-import")})}));al.open(this.serviceUrl.importModel.method,aj,true);al.send(an);this.alfPublish(X.IMPORT_MODEL+"_SUCCESS")}else{this.alfPublish(X.IMPORT_MODEL+"_SUCCESS");this._reloadModelList()}},exportModelAction:function J(ak){var aj=j.getObject("name",false,ak);if(aj!=null){this.serviceXhr({url:j.replace(this.serviceUrl.exportModel.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.exportModel.method,data:{},callbackScope:this,successCallback:function(am){var an=am.entry.nodeRef;var ao=10;var al=function(){this.serviceXhr({url:j.replace(this.serviceUrl.exportModelStatus.uri,{nodeRef:an.replace(":/","")}),method:this.serviceUrl.exportModelStatus.method,callbackScope:this,successCallback:function(ap){if(ap.status==="DONE"){window.open(j.replace(this.serviceUrl.exportModelDownload.uri,{nodeRef:an.replace(":/",""),fileName:encodeURIComponent(aj)}),"_blank")}else{if(--ao){window.setTimeout(al,1000)}else{this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,ap))||this.message("cmm.message.download-status-error")})}}},failureCallback:function(ap){console.log("FAILURE: "+ap);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,ap))||this.message("cmm.message.download-status-error")})}})};window.setTimeout(j.hitch(this,al),1000)},failureCallback:function(al){console.log("FAILURE: "+al);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,al))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to export a model but no 'name' attribute was provided",ak,this)}},deleteModel:function ag(ak){var aj=j.getObject("name",false,ak);if(aj!=null){this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"DELETE",data:{modelName:aj,operation:"deleteModel",arguments:{name:aj}},handleAs:this.errorResponse.handler,alfTopic:ak.alfResponseTopic||ak.responseTopic,successCallback:function(al){var am=j.getObject("requestConfig.subscriptionHandle",false,ak);if(am!=null){this.alfUnsubscribe(am)}this._reloadModelList()},failureCallback:function(al){console.log("FAILURE: "+al);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,al))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to delete a model but no 'name' attribute was provided",ak,this)}},getParentTypes:function y(ak){var aj=[];this.serviceXhr({url:this.serviceUrl.getParentTypes.uri,method:this.serviceUrl.getParentTypes.method,successCallback:function(an){if(an){for(var am=0;am<an.length;am++){var al=an[am].name;if(!this.typesBlackList[al.split(":")[0]]){var ao=an[am].title;aj.push({value:al,label:al+(ao?" ("+ao+")":"")})}}}this.serviceXhr({url:this.serviceUrl.getParentFolderTypes.uri,method:this.serviceUrl.getParentFolderTypes.method,successCallback:function(at){if(at){for(var ar=0;ar<at.length;ar++){var aq=at[ar].name;if(!this.typesBlackList[aq.split(":")[0]]){var au=at[ar].title;aj.push({value:aq,label:aq+(au?" ("+au+")":"")})}}}aj.sort(function(aw,av){return(aw.label<av.label)?-1:1});var ap=ak.alfResponseTopic||ak.responseTopic;if(ap!=null){this.alfPublish(ap,{options:aj})}}})}})},createCustomType:function T(al){var aj=j.getObject("model_name",false,al);if(aj!=null){var ak={name:al.name,description:al.description,title:al.title,parentName:al.parent};this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"POST",data:{modelName:aj,operation:"createType",data:ak,arguments:{name:aj}},handleAs:this.errorResponse.handler,successCallback:function(am){this.alfPublish(X.CREATE_CUSTOMTYPE+"_SUCCESS");this._reloadTypesList()},failureCallback:function(am){console.log("FAILURE: "+am);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,am))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to create a custom type but no 'model_name' attribute was provided",al,this)}},editCustomType:function ai(am){var aj=j.getObject("model_name",false,am),ak=j.getObject("name",false,am);if(aj!=null&&ak!=null){var al={name:am.name,description:am.description,title:am.title,parentName:am.parent};this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"PUT",data:{modelName:aj,operation:"editType",arguments:{name:aj,typeName:ak},data:al},handleAs:this.errorResponse.handler,successCallback:function(an){this.alfPublish(X.EDIT_CUSTOMTYPE+"_SUCCESS");this._reloadTypesList()},failureCallback:function(an){console.log("FAILURE: "+an);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,an))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to edit a custom type but no 'model_name' or 'name' attribute was provided",am,this)}},findTypesAction:function O(al){var aj=j.getObject("name",false,al);if(aj!=null){var ak=aj.split(":");this.alfPublish("ALF_NAVIGATE_TO_PAGE",{type:"SHARE_PAGE_RELATIVE",url:"dp/ws/faceted-search#searchTerm=TYPE%3A%22"+encodeURIComponent(ak[0])+"%3A"+encodeURIComponent(ak[1])+"%22&scope=repo"})}},findPropertyGroupsAction:function v(ak){var aj=j.getObject("name",false,ak);if(aj!=null){var al=aj.split(":");this.alfPublish("ALF_NAVIGATE_TO_PAGE",{type:"SHARE_PAGE_RELATIVE",url:"dp/ws/faceted-search#searchTerm=ASPECT%3A%22"+encodeURIComponent(al[0])+"%3A"+encodeURIComponent(al[1])+"%22&scope=repo"})}},deleteTypeAction:function W(al){var ak=j.getObject("name",false,al);if(ak!=null){var aj=this.generateUuid();this._deleteHandle=this.alfSubscribe(aj,j.hitch(this,this.deleteType));this.alfPublish("ALF_CREATE_DIALOG_REQUEST",{dialogId:"CMM_DELETE_TYPE_DIALOG",dialogTitle:this.message("cmm.type.delete-title"),textContent:this.message("cmm.type.delete-message",{"0":ak}),widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.model.delete-button.confirm-label"),publishTopic:this.pubSubScope+aj,publishPayload:al}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.model.delete-button.cancel-label"),publishTopic:"close"}}]})}else{this.alfLog("warn","A request was made to delete a type but no 'name' attribute was provided",al,this)}},deleteType:function b(al){var ak=j.getObject("name",false,al),aj=j.getObject("modelName",false,al);if(ak!=null&&aj!=null){this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"DELETE",data:{modelName:aj,operation:"deleteType",arguments:{name:aj,typeName:ak}},handleAs:this.errorResponse.handler,alfTopic:al.alfResponseTopic||al.responseTopic,successCallback:function(am){var an=j.getObject("requestConfig.subscriptionHandle",false,al);if(an!=null){this.alfUnsubscribe(an)}this._reloadTypesList()},failureCallback:function(am){console.log("FAILURE: "+am);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,am))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to delete a type but no 'name' attribute was provided",al,this)}},getParentPropertyGroups:function Z(aj){this.serviceXhr({url:this.serviceUrl.getParentPropertyGroups.uri,method:this.serviceUrl.getParentPropertyGroups.method,successCallback:function(an){if(an&&an.entities){var ap=[];for(var am=0;am<an.entities.length;am++){var al=an.entities[am].name;if(!this.aspectsBlackList[al.split(":")[0]]){var ao=an.entities[am].title;ap.push({value:al,label:al+(ao?" ("+ao+")":"")})}}ap.sort(function(ar,aq){return(ar.label<aq.label)?-1:1});ap.unshift({value:" ",label:this.message("cmm.message.none")});var ak=aj.alfResponseTopic||aj.responseTopic;if(ak!=null){this.alfPublish(ak,{options:ap})}}}})},createPropertyGroup:function Y(al){var aj=j.getObject("model_name",false,al);if(aj!=null){var ak={name:al.name,description:al.description,title:al.title,parentName:al.parent.trim()};this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"POST",data:{modelName:aj,operation:"createPropertyGroup",data:ak,arguments:{name:aj}},handleAs:this.errorResponse.handler,successCallback:function(am){this.alfPublish(X.CREATE_PROPERTYGROUP+"_SUCCESS");this._reloadPropertyGroupsList()},failureCallback:function(am){console.log("FAILURE: "+am);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,am))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to create a property group but no 'model_name' attribute was provided",al,this)}},editPropertyGroup:function z(am){var aj=j.getObject("model_name",false,am),al=j.getObject("name",false,am);if(aj!=null&&al!=null){var ak={name:am.name,description:am.description,title:am.title,parentName:am.parent.trim()};this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"PUT",data:{modelName:aj,operation:"editPropertyGroup",arguments:{name:aj,aspectName:al},data:ak},handleAs:this.errorResponse.handler,successCallback:function(an){this.alfPublish(X.EDIT_PROPERTYGROUP+"_SUCCESS");this._reloadPropertyGroupsList()},failureCallback:function(an){console.log("FAILURE: "+an);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,an))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to edit a property group but no 'model_name' or 'name' attribute was provided",am,this)}},deletePropertyGroupAction:function U(al){var ak=j.getObject("name",false,al);if(ak!=null){var aj=this.generateUuid();this._deleteHandle=this.alfSubscribe(aj,j.hitch(this,this.deletePropertyGroup));this.alfPublish("ALF_CREATE_DIALOG_REQUEST",{dialogId:"CMM_DELETE_PROPERTYGROUP_DIALOG",dialogTitle:this.message("cmm.propertygroup.delete-title"),textContent:this.message("cmm.propertygroup.delete-message",{"0":ak}),widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.model.delete-button.confirm-label"),publishTopic:this.pubSubScope+aj,publishPayload:al}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.model.delete-button.cancel-label"),publishTopic:"close"}}]})}else{this.alfLog("warn","A request was made to delete a property group but no 'name' attribute was provided",al,this)}},deletePropertyGroup:function g(al){var ak=j.getObject("name",false,al),aj=j.getObject("modelName",false,al);if(ak!=null&&aj!=null){this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"DELETE",data:{modelName:aj,operation:"deletePropertyGroup",arguments:{name:aj,aspectName:ak}},handleAs:this.errorResponse.handler,alfTopic:al.alfResponseTopic||al.responseTopic,successCallback:function(am){var an=j.getObject("requestConfig.subscriptionHandle",false,al);if(an!=null){this.alfUnsubscribe(an)}this._reloadPropertyGroupsList()},failureCallback:function(am){console.log("FAILURE: "+am);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,am))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to delete a property group but no 'name' attribute was provided",al,this)}},getProperties:function m(am){var aj=j.getObject("name",false,am),ak=j.getObject("type",false,am),al=j.getObject("propertygroup",false,am);if(aj!=null&&(ak!=null||al!=null)){this.serviceXhr({url:j.replace(this.serviceUrl.getModel.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.getModel.method,callbackScope:this,successCallback:function(ap){var ao=ap.entry.status,an=this.message(ao==="ACTIVE"?"cmm.label.status.active":"cmm.label.status.draft");this.alfPublish(X.PROPERTIES_LIST_SCOPE+X.UPDATE_TPG_HEADING_STATUS,{status:ao,label:an});this.serviceXhr({url:j.replace(this.serviceUrl.getProperties.uri,{name:encodeURIComponent(aj),entityClass:encodeURIComponent(ak!=null?"types":"aspects"),entityName:encodeURIComponent(ak||al)}),method:this.serviceUrl.getProperties.method,successCallback:function(aw){var ax=aw.entry.properties;for(var au=0;au<ax.length;au++){var ay=ax[au];ay.modelName=aj,ay.status=ao;ay.type_name=ak;ay.propertygroup_name=al;if(ay.mandatory){ay.mandatoryDsp=this.message("cmm.property.mandatory.mandatory-not-enforced");ay.mandatoryEdit="mandatory"}else{ay.mandatoryDsp=this.message("cmm.property.mandatory.optional");ay.mandatoryEdit="optional"}if(ay.constraints&&ay.constraints instanceof Array){var aq=ay.constraints[0];ay.constraint=aq.type;if(aq.name.substring(0,5)==="CLASS"){ay.constraint="CLASS";ay.constraintClass=aq.type}if(aq.parameters&&aq.parameters instanceof Array){for(var at=0;at<aq.parameters.length;at++){var ar=aq.parameters[at];switch(ar.name){case"expression":ay.constraintExpression=ar.simpleValue;break;case"minLength":ay.constraintMinLength=ar.simpleValue;break;case"maxLength":ay.constraintMaxLength=ar.simpleValue;break;case"minValue":ay.constraintMinValue=Number(ar.simpleValue).noExponents();break;case"maxValue":ay.constraintMaxValue=Number(ar.simpleValue).noExponents();break;case"allowedValues":ay.constraintAllowedValues=(ar.listValue).join("\n");break;case"sorted":ay.constraintSorted=(ar.simpleValue=="true");break}}}}else{ay.constraint="NONE"}var az=this._parsePropertyIndexing(ay);ay.indexing_txt=az.idxtxt;ay.indexing_nontxt=az.idxnontxt;ay.indexing_boolean=az.idxboolean}var av=am.alfResponseTopic||am.responseTopic;if(av!=null){this.alfPublish(av+"_SUCCESS",aw)}},callbackScope:this})}})}else{this.alfLog("warn","A request was made to get properties but no model 'name' or 'type' or 'propertygroup' attributes were provided",am,this)}},getEditorProperties:function Q(am){var aj=j.getObject("name",false,am),ak=j.getObject("type",false,am),al=j.getObject("propertygroup",false,am);if(aj!=null&&(ak!=null||al!=null)){this.serviceXhr({url:j.replace(this.serviceUrl.getModel.uri,{name:encodeURIComponent(aj)}),method:this.serviceUrl.getModel.method,callbackScope:this,successCallback:function(ap){var ao=ap.entry.status,an=this.message(ao==="ACTIVE"?"cmm.label.status.active":"cmm.label.status.draft");this.alfPublish(X.UPDATE_TPG_HEADING_STATUS,{status:ao,label:an});this.serviceXhr({url:j.replace(this.serviceUrl.getEditorProperties.uri,{name:encodeURIComponent(aj),entityClass:encodeURIComponent(ak!=null?"types":"aspects"),entityName:encodeURIComponent(ak||al)}),method:this.serviceUrl.getEditorProperties.method,successCallback:function(at){var ar=j.getObject("entry.properties",false,at),au={items:[]};if(ak){this.standardProperties.forEach(j.hitch(this,function(ax){var av=ax.dataType.replace("d:","");var aw={type:["property"],label:this.message(ax.label)+" ["+ax.id+"]",iconClass:"editor-"+av,value:{pseudonym:"cmm/editor/property/"+av,id:ax.id,elementconfig:{infoname:ax.id,infolabel:this.message(ax.label),infotype:ax.dataType}}};if(ax.config){if(ax.config["for-mode"]){aw.value.elementconfig["for-mode"]=ax.config["for-mode"]}if(ax.config.force){aw.value.elementconfig.force=ax.config.force}if(ax.config.controlType){aw.value.elementconfig.controltype=ax.config.controlType}}au.items.push(aw)}))}k.forEach(ar,j.hitch(this,function(ax,aw){if(!this.blackListProperties[ax.prefixedName]){var av=ax.dataType.replace("d:","");au.items.push({type:["property"],label:ax.title?(ax.title+" ["+ax.name+"]"):ax.name,iconClass:"editor-"+av,value:{pseudonym:"cmm/editor/property/"+av,id:ax.prefixedName,elementconfig:{infoname:ax.name,infolabel:ax.title?ax.title:ax.name,infotype:ax.dataType}}})}}));var aq=am.alfResponseTopic||am.responseTopic;if(aq!=null){this.alfPublish(aq+"_SUCCESS",au)}}})}})}else{this.alfLog("warn","A request was made to get editor properties but no model 'name' or 'type' or 'propertygroup' attributes were provided",am,this)}},createProperty:function ae(an){var aj=j.getObject("model_name",false,an),ak=j.getObject("type_name",false,an),am=j.getObject("propertygroup_name",false,an);if(aj!=null&&(ak!=null||am!=null)){var al={name:ak||am,properties:[{name:an.name,title:an.title,description:an.description,multiValued:an.multiple,mandatory:an.mandatory!=="optional",mandatoryEnforced:false,defaultValue:an.defaultValue,dataType:an.datatype}]};if(constraintPayload=this._processPropertyConstraint(an)){al.properties[0].constraints=[constraintPayload]}if(indexingPayload=this._processPropertyIndexing(an)){al.properties[0].indexed=indexingPayload.indexed;al.properties[0].facetable=indexingPayload.facetable;al.properties[0].indexTokenisationMode=indexingPayload.indexTokenisationMode}this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"PUT",data:{modelName:aj,operation:"createProperty",data:al,arguments:{name:aj,entityClass:ak!=null?"types":"aspects",entityName:ak||am}},handleAs:this.errorResponse.handler,successCallback:function(ao){this.alfPublish(X.CREATE_PROPERTY+"_SUCCESS");this._reloadPropertiesList();this._reloadFormEditorProperties()},failureCallback:function(ao){console.log("FAILURE: "+ao);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,ao))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to create a property but no model 'name' or 'type' or 'propertygroup' attributes were provided",an,this)}},editProperty:function V(ao){var aj=j.getObject("model_name",false,ao),al=j.getObject("type_name",false,ao),an=j.getObject("propertygroup_name",false,ao),ak=j.getObject("name",false,ao);if(aj!=null&&(al!=null||an!=null)&&ak!=null){var am={name:al||an,properties:[{name:ao.name,title:ao.title,description:ao.description,multiValued:ao.multiple,mandatory:ao.mandatory!=="optional",mandatoryEnforced:false,defaultValue:ao.defaultValue,dataType:ao.datatype}]};if(constraintPayload=this._processPropertyConstraint(ao)){am.properties[0].constraints=[constraintPayload]}if(indexingPayload=this._processPropertyIndexing(ao)){am.properties[0].indexed=indexingPayload.indexed;am.properties[0].facetable=indexingPayload.facetable;am.properties[0].indexTokenisationMode=indexingPayload.indexTokenisationMode}this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"PUT",data:{modelName:aj,operation:"editProperty",data:am,arguments:{name:aj,entityClass:al!=null?"types":"aspects",entityName:al||an,propertyName:ak}},handleAs:this.errorResponse.handler,successCallback:function(ap){this.alfPublish(X.EDIT_PROPERTY+"_SUCCESS");this._reloadPropertiesList()},failureCallback:function(ap){console.log("FAILURE: "+ap);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,ap))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to edit a property but no model 'name' or 'type' or 'propertygroup' or property 'name' attributes were provided",ao,this)}},deletePropertyAction:function t(al){var aj=j.getObject("name",false,al);if(aj!=null){var ak=this.generateUuid();this._deleteHandle=this.alfSubscribe(ak,j.hitch(this,this.deleteProperty));this.alfPublish("ALF_CREATE_DIALOG_REQUEST",{dialogId:"CMM_DELETE_PROPERTY_DIALOG",dialogTitle:this.message("cmm.property.delete-title"),textContent:this.message("cmm.property.delete-message",{"0":aj}),widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.model.delete-button.confirm-label"),publishTopic:this.pubSubScope+ak,publishPayload:al}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.model.delete-button.cancel-label"),publishTopic:"close"}}]})}else{this.alfLog("warn","A request was made to delete a property but no 'name' attribute was provided",al,this)}},deleteProperty:function f(ao){var ak=j.getObject("name",false,ao),aj=j.getObject("modelName",false,ao),al=j.getObject("type_name",false,ao),an=j.getObject("propertygroup_name",false,ao);if(ak!=null&&aj!=null&&(al!=null||an!=null)){var am={name:al||an};this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"PUT",data:{modelName:aj,operation:"deleteProperty",data:am,arguments:{name:aj,entityClass:al!=null?"types":"aspects",entityName:al||an,propertyName:ak}},handleAs:this.errorResponse.handler,alfTopic:ao.alfResponseTopic||ao.responseTopic,successCallback:function(ap){var aq=j.getObject("requestConfig.subscriptionHandle",false,ao);if(aq!=null){this.alfUnsubscribe(aq)}this._reloadPropertiesList()},failureCallback:function(ap){console.log("FAILURE: "+ap);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,ap))||this.message("cmm.message.unknown-error")})},callbackScope:this})}else{this.alfLog("warn","A request was made to delete a property but a 'name', 'model_name', 'type_name' or 'propertygroup_name' attribute was missing",ao,this)}},canvasValueChanged:function ah(aj){if(aj.value&&aj.value.length!==0){k.forEach(ad(".speech-bubble","FORM_EDITOR_CONSOLE"),function(ak){B.add(ak,"hidden")},this)}else{k.forEach(ad(".speech-bubble","FORM_EDITOR_CONSOLE"),function(ak){B.remove(ak,"hidden")},this)}},saveFormAction:function S(ao){var aj=j.getObject("model",false,ao),ak=j.getObject("type",false,ao),am=j.getObject("propertygroup",false,ao);var an=j.getObject("formData",false,ao);if(an){if(!an||an.length===0){var al="";var ap="Delete"}else{var al=o.stringify(an);var ap="Update"}this.serviceXhr({url:this.serviceUrl.modelServiceUri,method:"POST",data:{modelName:aj,entity:ak||am,form:al,formOperation:ap},handleAs:this.errorResponse.handler,alfTopic:ao.alfResponseTopic||ao.responseTopic,successCallback:function(aq){this.alfPublish(X.NOTIFICATION_TOPIC,{message:this.message("cmm.form-editor.message.saved.success")});this._reloadPropertiesList()},failureCallback:function(aq){console.log("FAILURE: "+aq);this.alfPublish(X.NOTIFICATION_TOPIC,{message:this._cleanError(j.getObject(this.errorResponse.msgKey,false,aq))||this.message("cmm.message.unknown-error")})},callbackScope:this})}},getEditorValue:function C(am){var aj=j.getObject("model",false,am),ak=j.getObject("type",false,am),al=j.getObject("propertygroup",false,am);if(aj!=null&&(ak!=null||al!=null)){this.serviceXhr({url:j.replace(this.serviceUrl.getEditorData.uri,{name:encodeURIComponent(aj),entityName:encodeURIComponent(ak||al)}),method:this.serviceUrl.getEditorData.method,successCallback:function(ap){var ao={formData:ap.form};var an=am.alfResponseTopic||am.responseTopic;if(an!=null){this.alfPublish(an+"_SUCCESS",ao)}}})}else{this.alfLog("warn","A request was made to get editor form data but no model 'name' or 'type' or 'propertygroup' attributes were provided",am,this)}},_processPropertyConstraint:function L(ap){var ao=j.getObject("constraint",false,ap),aj;if(ao==="REGEX"&&(constraintExpression=j.getObject("constraintExpression",false,ap))!=null){aj={name:"REGEX_"+n.generateRandomUuid(),type:"REGEX",parameters:[{name:"expression",simpleValue:constraintExpression},{name:"requiresMatch",simpleValue:true}]}}else{if(ao==="LENGTH"&&(constraintMinLength=j.getObject("constraintMinLength",false,ap))!=null&&(constraintMaxLength=j.getObject("constraintMaxLength",false,ap))!=null){aj={name:"LENGTH_"+n.generateRandomUuid(),type:"LENGTH",parameters:[{name:"minLength",simpleValue:constraintMinLength},{name:"maxLength",simpleValue:constraintMaxLength}]}}else{if(ao==="MINMAX"&&(constraintMinValue=j.getObject("constraintMinValue",false,ap))!=null&&(constraintMaxValue=j.getObject("constraintMaxValue",false,ap))!=null){aj={name:"MINMAX_"+n.generateRandomUuid(),type:"MINMAX",parameters:[{name:"minValue",simpleValue:constraintMinValue},{name:"maxValue",simpleValue:constraintMaxValue}]}}else{if(ao==="LIST"&&(constraintAllowedValues=j.getObject("constraintAllowedValues",false,ap))!=null&&(constraintSorted=j.getObject("constraintSorted",false,ap))!=null){var am=constraintAllowedValues.split(/\r*\n\r*/),al=new Array();for(var ak=0;ak<am.length;ak++){var an=am[ak];if(an!=undefined&&an!==""){al.push(an)}}aj={name:"LIST_"+n.generateRandomUuid(),type:"LIST",parameters:[{name:"allowedValues",listValue:al},{name:"sorted",simpleValue:constraintSorted}]}}else{if(ao==="CLASS"&&(constraintClass=j.getObject("constraintClass",false,ap))!=null){aj={name:"CLASS_"+n.generateRandomUuid(),type:constraintClass}}}}}}return aj},_processPropertyIndexing:function R(ak){if(ak.datatype==="d:text"||ak.datatype==="d:mltext"||ak.datatype==="d:content"){ak.indexing=ak.indexing_txt}else{if(ak.datatype==="d:boolean"){ak.indexing=ak.indexing_boolean}else{ak.indexing=ak.indexing_nontxt}}if(!ak.indexing){return null}else{var aj=j.getObject(ak.indexing,false,this.propertyIndexingOptions);return{indexed:aj.indexed,facetable:aj.facetable,indexTokenisationMode:aj.indexTokenisationMode}}},_parsePropertyIndexing:function aa(aq){var aj="nontxt",ak=aq.indexed,an=aq.facetable,ap=aq.indexTokenisationMode,al="txt-standard",am="nontxt-standard",ar="boolean-standard";if(aq.dataType==="d:text"||aq.dataType==="d:mltext"||aq.dataType==="d:content"){aj="txt"}else{if(aq.dataType==="d:boolean"){aj="boolean"}}for(var ao in this.propertyIndexingOptions){if(this.propertyIndexingOptions.hasOwnProperty(ao)){var at=this.propertyIndexingOptions[ao];if(at.type===aj&&at.indexed==ak&&at.facetable==an&&at.indexTokenisationMode==ap){if(aj==="txt"){al=ao}else{if(aj==="boolean"){ar=ao}else{am=ao}}break}}}return{idxtxt:al,idxnontxt:am,idxboolean:ar}},clearToPaletteAction:function h(){var aj=this.generateUuid();this._clearToPaletteHandle=this.alfSubscribe(aj,j.hitch(this,this.clearToPalette));this.alfPublish("ALF_CREATE_DIALOG_REQUEST",{dialogId:"CMM_EDITOR_CLEAR_DIALOG",dialogTitle:this.message("cmm.form-editor.clear-title"),textContent:this.message("cmm.form-editor.clear-message"),widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.form-editor.clear-button.confirm-label"),publishTopic:this.pubSubScope+aj}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.form-editor.clear-button.cancel-label"),publishTopic:"close"}}]})},clearToPalette:function w(ak){var aj=j.getObject("requestConfig.subscriptionHandle",false,ak);if(aj!=null){this.alfUnsubscribe(aj)}this.alfPublish(X.FORM_EDITOR_CLEAR_TO_PALETTE)},defaultLayoutAction:function q(ak){var aj=this.generateUuid();this._defaultLayoutDataHandle=this.alfSubscribe(aj,j.hitch(this,this.defaultLayoutData));this.alfPublish("ALF_CREATE_DIALOG_REQUEST",{dialogId:"CMM_EDITOR_DEFAULT_LAYOUT_DIALOG",dialogTitle:this.message("cmm.form-editor.default-layout-title"),textContent:this.message("cmm.form-editor.default-layout-message"),widgetsButtons:[{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.form-editor.default-layout-button.confirm-label"),publishTopic:this.pubSubScope+aj,publishPayload:ak}},{name:"alfresco/buttons/AlfButton",config:{label:this.message("cmm.form-editor.default-layout-button.cancel-label"),publishTopic:"close"}}]})},defaultLayoutData:function ac(an){var aj=this.generateUuid();this._defaultLayoutProcessHandle=this.alfSubscribe(aj,j.hitch(this,this.defaultLayoutProcess));var ak=j.getObject("model",false,an),al=j.getObject("type",false,an),am=j.getObject("propertygroup",false,an);if(ak!=null&&(al!=null||am!=null)){this.serviceXhr({url:j.replace(this.serviceUrl.getEditorProperties.uri,{name:encodeURIComponent(ak),entityClass:encodeURIComponent(al?"types":"aspects"),entityName:encodeURIComponent(al||am)}),method:this.serviceUrl.getEditorProperties.method,successCallback:function(ap){var ao=j.getObject("entry.properties",false,ap),aq={items:[]};if(al){this.standardProperties.forEach(j.hitch(this,function(au){var ar=au.dataType.replace("d:","");var at={pseudonym:"cmm/editor/property/"+ar,id:au.id,elementconfig:{infoname:au.id,infolabel:this.message(au.label),infotype:au.dataType},label:this.message(au.label)+" ["+au.id+"]",type:["property"]};if(au.config){if(au.config["for-mode"]){at.elementconfig["for-mode"]=au.config["for-mode"]}if(au.config.force){at.elementconfig.force=au.config.force}if(au.config.controlType){at.elementconfig.controltype=au.config.controlType}}aq.items.push(at)}))}k.forEach(ao,j.hitch(this,function(au,at){if(!this.blackListProperties[au.prefixedName]){var ar=au.dataType.replace("d:","");aq.items.push({pseudonym:"cmm/editor/property/"+ar,id:au.prefixedName,elementconfig:{infoname:au.name,infolabel:au.title?au.title:au.name,infotype:au.dataType},label:au.title?(au.title+" ["+au.name+"]"):au.name,type:["property"]})}}));this.alfPublish(this.pubSubScope+aj,aq)}})}else{this.alfLog("warn","A request was made to apply a default layout but no model 'name' or 'type' or 'propertygroup' attributes were provided",an,this)}},defaultLayoutProcess:function d(al){var ak=j.getObject("requestConfig.subscriptionHandle",false,al);if(ak!=null){this.alfUnsubscribe(ak)}var aj={formData:[{elementconfig:{label:"",appearance:"title"},pseudonym:"cmm/editor/layout/1cols",label:"cmm.form-editor.palette.one-column",column:al.items}]};this.alfPublish(X.FORM_EDITOR_CLEAR);this.alfPublish(X.FORM_EDITOR_GET_VALUE+"_SUCCESS",aj);this._reloadFormEditorProperties()},_cleanError:function E(aj){return aj.replace(/[0-9]{8}(\s[0-9]{8})?/g,"")},_reloadModelList:function l(){this.alfPublish(X.MODELS_LIST_SCOPE+X.MODEL_LIST_RELOAD,{})},_reloadTypesList:function c(){this.alfPublish(X.TYPES_LIST_SCOPE+X.TYPE_LIST_RELOAD,{})},_reloadPropertyGroupsList:function M(){this.alfPublish(X.PROPERTYGROUPS_LIST_SCOPE+X.PROPERTYGROUP_LIST_RELOAD,{})},_reloadPropertiesList:function I(){this.alfPublish(X.PROPERTIES_LIST_SCOPE+X.PROPERTIES_LIST_RELOAD,{})},_reloadFormEditorProperties:function H(){this.alfPublish(X.FORM_EDITOR_SCOPE+X.FORM_EDITOR_PROPERTIES_RELOAD,{})}})});Number.prototype.noExponents=function(){var c=String(this).split(/[eE]/);if(c.length==1){return c[0]}var e="",a=this<0?"-":"",d=c[0].replace(".",""),b=Number(c[1])+1;if(b<0){e=a+"0.";while(b++){e+="0"}return e+d.replace(/^\-/,"")}b-=d.length;while(b--){e+="0"}return d+e};