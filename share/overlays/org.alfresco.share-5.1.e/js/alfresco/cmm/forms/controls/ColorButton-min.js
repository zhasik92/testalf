define(["alfresco/buttons/AlfButton","dojo/_base/declare","dojox/widget/ColorPicker","dijit/_HasDropDown","cmm/forms/controls/ColorPickerDropDown","dojo/_base/lang","dojo/dom-class","dojo/dom-style","dojo/dom-construct","dojo/on"],function(k,e,f,m,j,b,l,g,d,i){return e([k,m],{cssRequirements:[{cssFile:"./css/ColorButton.css"}],postCreate:function c(){l.add(this.domNode,"cmm-forms-controls-ColorButton"+(this.additionalCssClasses?" "+this.additionalCssClasses:""));this.colorBall=dojo.create("div",{className:"colorBall",style:{visibility:"hidden"}},this.domNode,"first");i(this._buttonNode,"click",this.openDropDown);this.watch("value",b.hitch(this,function(n,o,p){if(p===""){g.set(this.colorBall,"visibility","hidden");this.onChange(p)}else{if(p.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)){g.set(this.colorBall,"visibility","visible");g.set(this.colorBall,"borderColor",p+" transparent");this.onChange(p)}}}));this.inherited(arguments)},openDropDown:function h(n){if(this.dropDown&&typeof this.dropDown.destroyRecursive==="function"){this.dropDown.destroyRecursive()}this.curVal=this.value!=null?this.value:"";this.dropDown=new j({parent:this,value:this.curVal,onSelect:b.hitch(this.dropDown,function(){this.parent.set("value",this.picker.get("value"));this.parent.closeDropDown()}),onCancel:b.hitch(this.dropDown,function(){this.parent.set("value",this.parent.curVal);this.parent.closeDropDown()}),onClear:b.hitch(this.dropDown,function(){this.parent.set("value","");this.parent.closeDropDown()})});if(typeof this.inherited==="function"){this.inherited(arguments)}},closeDropDown:function a(){this.inherited(arguments);if(this.dropDown){this.dropDown.destroy();this.dropDown=null}}})});